<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wonderful-sea-04900b000.6.azurestaticapps.net","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Shawn Lin&#39;s Blog">
<meta property="og:url" content="https://wonderful-sea-04900b000.6.azurestaticapps.net/page/2/index.html">
<meta property="og:site_name" content="Shawn Lin&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Xiao Lin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Shawn Lin's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Shawn Lin's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2025/03/02/modulepacking-a-top-down-generative-design-approach-for-modular-key-plans/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/02/modulepacking-a-top-down-generative-design-approach-for-modular-key-plans/" class="post-title-link" itemprop="url">ModulePacking: A Top-Down Generative Design Approach for Modular Key Plans</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-03-02 14:58:27" itemprop="dateCreated datePublished" datetime="2025-03-02T14:58:27+08:00">2025-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Publications/" itemprop="url" rel="index"><span itemprop="name">Publications</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Modular construction is increasingly recognized for its efficiency in production and assembly. Modularization, the design process that segments floor plans into discrete modular units to create a modular key plan, has been identified as being crucial for creating an economical modular construction plan. However, solving the modularization problem is often daunting, requiring extensive trial-and-error to navigate the cast array of possible configurations. To address this challenge, this study introduces ModulePacking, a top-down generative design approach aimed specifically at the modularization problem. A hierarchical design methodology is proposed, encompassing a twofold process: partition and merging, where the optimized modular key plan is merged from the partition result. A genetic algorithm is utilized to accelerate the optimization process. In the case study, ModulePacking can generate modular key plans that rival those created by human designers as well as satisfactory results for large-scale buildings where human designers might struggle. ModulePacking showcases considerable potential in assisting designers and manufacturers in optimizing the modular construction plan, ultimately contributing to the advancement of modular construction.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2023/12/12/%E6%BF%80%E5%85%89%E9%9B%B7%E8%BE%BE%E4%B8%8E%E7%9B%B8%E6%9C%BA%E8%81%94%E5%90%88%E6%A0%87%E5%AE%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/12/%E6%BF%80%E5%85%89%E9%9B%B7%E8%BE%BE%E4%B8%8E%E7%9B%B8%E6%9C%BA%E8%81%94%E5%90%88%E6%A0%87%E5%AE%9A/" class="post-title-link" itemprop="url">激光雷达与相机联合标定</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-12-12 23:36:15" itemprop="dateCreated datePublished" datetime="2023-12-12T23:36:15+08:00">2023-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><p>MatLab2022及以后版本，ROS2.</p>
<p>之前很少用Matlab，但是这次标定发现matlab真的是一个非常reliable的工具箱。不会出奇奇怪怪的问题，开箱即用，维护世界一流，教程详实。对ROS也有很好的支持。说两句题外话，在用matlab标定前，我还用过hk mars实验室的标定工具，还有一些手动标定工具。最后发现，最传统的方法+算法，配合上最稳定的工具，就是最省心的方法。想要走捷径，就免不了掉坑里。</p>
<h1 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h1><p>使用ros2 bag来采集数据。我使用的是livox mid360+一般的usb相机。命令为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 bag record /livox/lidar /usb_cam1/image_raw -o cam1</span><br></pre></td></tr></table></figure>

<p>录制好ros2bag后拷到安装了Matlab的电脑下进行处理。</p>
<p>坑1：有的时候拷贝ros2bag会造成数据损坏。原因不明，甚至有的时候拷到U盘都还行，U盘插到第二台机子上就不行了。解决方法是直接在U盘的工作路径下进行ros2bag录制。</p>
<h1 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h1><p>主要步骤：</p>
<ol>
<li>用matlab读取数据</li>
<li>抽取点云和图像的topic</li>
<li>同步点云和图像时间戳</li>
<li>输出同步的点云和图像对</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">bagReader = ros2bagreader(&quot;cam1_6&quot;)</span><br><span class="line">pcBag = select(bagReader, &#x27;Topic&#x27;, &#x27;/livox/lidar&#x27;)</span><br><span class="line">imageBag = select(bagReader, &#x27;Topic&#x27;, &#x27;/usb_cam_1/image_raw&#x27;)</span><br><span class="line">pcMsgs = readMessages(pcBag);</span><br><span class="line">imageMsgs = readMessages(imageBag);</span><br><span class="line">//-------------抽取时间戳</span><br><span class="line">t1 = double(pcBag.MessageList.Time)</span><br><span class="line">t2 = double(imageBag.MessageList.Time)</span><br><span class="line">//-------------同步时间戳</span><br><span class="line">k = 1;</span><br><span class="line">if size(t2,1) &gt; size(t1,1)</span><br><span class="line">    for i = 1:size(t1,1)</span><br><span class="line">        [val,indx] = min(abs(t1(i) - t2));</span><br><span class="line">        if val &lt;= 1e7</span><br><span class="line">            idx(k,:) = [i indx];</span><br><span class="line">            k = k + 1;</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">else</span><br><span class="line">    for i = 1:size(t2,1)</span><br><span class="line">        [val,indx] = min(abs(t2(i) - t1));</span><br><span class="line">        if val &lt;= 1e7</span><br><span class="line">            idx(k,:) = [indx i];</span><br><span class="line">            k = k + 1;</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//-------------创建路径</span><br><span class="line">pcFilesPath = fullfile(pwd,&#x27;PointClouds&#x27;);</span><br><span class="line">imageFilesPath = fullfile(pwd,&#x27;Images&#x27;);</span><br><span class="line">if ~exist(imageFilesPath,&#x27;dir&#x27;)</span><br><span class="line">    mkdir(imageFilesPath);</span><br><span class="line">end</span><br><span class="line">if ~exist(pcFilesPath,&#x27;dir&#x27;)</span><br><span class="line">    mkdir(pcFilesPath);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">//-------------输出文件</span><br><span class="line">for i = 1:6:length(idx) //中间值可修改以实现下采样，输出20左右对数据为宜</span><br><span class="line">    I = rosReadImage(imageMsgs&#123;idx(i,2)&#125;);</span><br><span class="line">    pc = pointCloud(rosReadXYZ(pcMsgs&#123;idx(i,1)&#125;));</span><br><span class="line">    n_strPadded = sprintf(&#x27;%04d&#x27;,i) ;</span><br><span class="line">    pcFileName = strcat(pcFilesPath,&#x27;/&#x27;,n_strPadded,&#x27;.pcd&#x27;);</span><br><span class="line">    imageFileName = strcat(imageFilesPath,&#x27;/&#x27;,n_strPadded,&#x27;.png&#x27;);</span><br><span class="line">    imwrite(I,imageFileName);</span><br><span class="line">    pcwrite(pc,pcFileName);</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>由于mid360的点云是360度的，容易有距离很远的点云造成干扰。所以用一个脚本截取ROI。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">save_path = pwd;</span><br><span class="line">imageFilesPath = fullfile(save_path,&#x27;Images&#x27;);</span><br><span class="line">rawPcFilesPath = fullfile(save_path,&#x27;PointClouds&#x27;);</span><br><span class="line">cropPcFilesPath = fullfile(save_path, &#x27;CropPointClouds&#x27;);</span><br><span class="line">if ~exist(cropPcFilesPath,&#x27;dir&#x27;)</span><br><span class="line">    mkdir(cropPcFilesPath);</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">%pcshow an example pointcloud to decide the roi</span><br><span class="line">ptCloud = pcread(fullfile(rawPcFilesPath, &#x27;0001.pcd&#x27;))</span><br><span class="line">pcshow(ptCloud);</span><br><span class="line">xlabel(&#x27;X&#x27;);</span><br><span class="line">ylabel(&#x27;Y&#x27;);</span><br><span class="line">zlabel(&#x27;Z&#x27;);</span><br><span class="line">%x y z</span><br><span class="line">% roi = [0.5 6 -6 1 -0.4 2]; %front lidar</span><br><span class="line">% roi = [-6 6 -6 6 -1 1.6];    %bp_r</span><br><span class="line">roi = [-6 6 -6 6 -1 1.6];    %bp_f</span><br><span class="line">indices = findPointsInROI(ptCloud,roi);</span><br><span class="line">ptCloudB = select(ptCloud,indices);</span><br><span class="line"></span><br><span class="line">figure</span><br><span class="line">pcshow(ptCloud.Location,[0.5 0.5 0.5])</span><br><span class="line">hold on</span><br><span class="line">pcshow(ptCloudB.Location,&#x27;r&#x27;);</span><br><span class="line">legend(&#x27;Point Cloud&#x27;,&#x27;Points within ROI&#x27;,&#x27;Location&#x27;,&#x27;southoutside&#x27;,&#x27;Color&#x27;,[1 1 1])</span><br><span class="line">hold off</span><br><span class="line"></span><br><span class="line">% Get a list of all files in the source folder</span><br><span class="line">file_list = dir(fullfile(imageFilesPath, &#x27;*.png&#x27;)); </span><br><span class="line"></span><br><span class="line">% Loop through each image file in the source folder</span><br><span class="line">for i = 1:length(file_list)</span><br><span class="line">    % Get the filename</span><br><span class="line">    filename = file_list(i).name;</span><br><span class="line">    splitnames = strsplit(filename, &#x27;.&#x27;);</span><br><span class="line">    iname = splitnames(1);</span><br><span class="line">    pcfilename = strcat(iname&#123;1&#125;, &#x27;.pcd&#x27;);</span><br><span class="line"></span><br><span class="line">    rawfilepath = fullfile(rawPcFilesPath, pcfilename);</span><br><span class="line">    cropfilepath = fullfile(cropPcFilesPath, pcfilename);</span><br><span class="line">    </span><br><span class="line">    % load the pc</span><br><span class="line">    rawpc = pcread(rawfilepath);</span><br><span class="line">    indices = findPointsInROI(rawpc,roi);</span><br><span class="line">    croppc = select(rawpc,indices);</span><br><span class="line">    pcwrite(croppc,cropfilepath);</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>最终输出images、pointclouds、croppointclouds三个文件夹。</p>
<h1 id="标定"><a href="#标定" class="headerlink" title="标定"></a>标定</h1><p>打开lidar camera calibrator，导入images，croppointclouds。如果calibrator能检测到棋盘格的话，就会列在accept data里。但是mid360的点云单帧分布不均匀，很多时候都捕捉不到，就需要手动选择棋盘格的点云。</p>
<p>有十张左右标定好的数据对就可以进行标定了，如果激光雷达的x轴和相机的z轴不平行的话，一般要输入initial matrix才能使得标定结果收敛。虽然说教程里讲的是for better result，实际上不指定无法收敛。所以要自己大概估计一下initial matrix，最重要的是旋转矩阵。</p>
<p>旋转矩阵通过欧拉角得到，欧拉角的定义是依次绕z y x旋转：【z,x,y】</p>
<h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><h2 id="点云投射"><a href="#点云投射" class="headerlink" title="点云投射"></a>点云投射</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ptCloud = pcread(&#x27;C:\Users\user\Documents\MATLAB\CropPointClouds\0001.pcd&#x27;)</span><br><span class="line">img = imread(&#x27;C:\Users\user\Documents\MATLAB\Images\0001.png&#x27;)imPts = projectLidarPointsOnImage(ptCloud, cameraParams.Intrinsics, tform)</span><br><span class="line">figure</span><br><span class="line">imshow(img)</span><br><span class="line">hold on</span><br><span class="line">plot(imPts(:,1),imPts(:,2),&#x27;.&#x27;,&#x27;Color&#x27;,&#x27;r&#x27;)</span><br><span class="line">hold off</span><br></pre></td></tr></table></figure>

<h2 id="点云上色"><a href="#点云上色" class="headerlink" title="点云上色"></a>点云上色</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ptCloud = pcread(&#x27;C:\Users\user\Documents\MATLAB\CropPointClouds\0001.pcd&#x27;)</span><br><span class="line">img = imread(&#x27;C:\Users\user\Documents\MATLAB\Images\0001.png&#x27;)</span><br><span class="line">ptCloudOut = fuseCameraToLidar(img, ptCloud, cameraParams.Intrinsics, tform)</span><br><span class="line">pcshow(ptCloudOut)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2023/12/02/livox-driver%E5%9C%A8nx%E4%B8%8B%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/02/livox-driver%E5%9C%A8nx%E4%B8%8B%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">livox driver在nx下安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-12-02 22:26:16" itemprop="dateCreated datePublished" datetime="2023-12-02T22:26:16+08:00">2023-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/Robotics/" itemprop="url" rel="index"><span itemprop="name">Robotics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>找不到so文件，修改ip的方法（改完之后重新colcon build）</p>
<p>zardforever123 134219903</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2023/11/26/%E7%A7%91%E7%A0%94%E5%90%90%E6%A7%BD%EF%BC%88%E4%B8%89%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/26/%E7%A7%91%E7%A0%94%E5%90%90%E6%A7%BD%EF%BC%88%E4%B8%89%EF%BC%89/" class="post-title-link" itemprop="url">科研吐槽（三）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-26 19:04:08" itemprop="dateCreated datePublished" datetime="2023-11-26T19:04:08+08:00">2023-11-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/thought/" itemprop="url" rel="index"><span itemprop="name">thought</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/thought/%E7%A7%91%E7%A0%94%E4%BA%8C%E4%B8%89%E4%BA%8B/" itemprop="url" rel="index"><span itemprop="name">科研二三事</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>王总在大谈人满足了生存繁衍后到底需要什么，显然他已经忘了硬化路面旁边在冷风中蹲着吃盒饭的农民工了。</p>
<p>chatgpt显然给在座的各位都带来不小的震撼并引发了对人类未来的遐想，不过各位似乎都忘了没有vpn根本用不了gpt，所以你大可以相信约翰康纳未来会出自网信办。</p>
<p>不得不说华子出来的还有点浪漫情节，王总开始遐想自己想去月球和金星，一洗工地上的风尘。并且这似乎是第三次他提起人类简史这本书了。</p>
<p>导师一转话锋，说起人工智能过度发展后人该怎么办。我想做文书工作的多少有这种焦虑。</p>
<p>再说起“那些年”的八卦，王总的脸上添上了一抹不易觉察的微笑，这是来自当你省状元的自信。</p>
<p>导师说“每次拿到一个很特殊的项目都很开心”。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2023/11/17/%E7%A7%91%E7%A0%94%E5%90%90%E6%A7%BD%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/17/%E7%A7%91%E7%A0%94%E5%90%90%E6%A7%BD%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">科研吐槽（二）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-17 13:43:19" itemprop="dateCreated datePublished" datetime="2023-11-17T13:43:19+08:00">2023-11-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/thought/" itemprop="url" rel="index"><span itemprop="name">thought</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/thought/%E7%A7%91%E7%A0%94%E4%BA%8C%E4%B8%89%E4%BA%8B/" itemprop="url" rel="index"><span itemprop="name">科研二三事</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我时常反省自己，拿着国家的钱，啥有用的都没做出来，是不是浪费纳税人的钱？老板的钱倒是拿的心安理得，毕竟做项目的就是在帮老板赚钱，虽说项目做的也没什么大用，而且大多是和国企合作，归根结底最后还是拿着纳税人的钱做没用的东西，但毕竟中间转了两手，转到自己手上的时候拿起来也心安理得了。唯有国家的每月补助，拿起来确实有些汗颜。</p>
<p>一般来说，对自己道德标准要求太高会过的很辛苦。学术有学术道德，不过是不能抄袭，不能造假罢了，学术道德当然不反对拿着纳税人的钱做没用的真东西。相反，学术界总鼓励做一些”大而无用“的东西。我倒不是在反对基础理论研究，相反基础理论研究特别重要；只是觉得自己做的东西实在无用，什么智能安全，智能管理，属实是一些哄骗不懂行人的玩意。然而又有学术道德在前，要求不能造假，那只能”包装“一下，用一些是是而非的春秋笔法（天哪，这居然也不在学术道德的范围之内），让成果穿着皇帝的新衣登上大雅之堂。</p>
<p>如果要学习双重思想，那你必须得来学术圈看一看。昨天大谈社会主义核心价值观的纪委书记，第二天凌晨因嫖娼被抓获，这也不是什么新鲜事。当然这已经是位高权重的核心领导们，我们所做的双重思想不过是一方面认识到自己做的东西没用，另一方面认识到如果承认自己做的东西没用那他就真的没用了，所以绝不能承认自己做的东西没用。所有人都保持着一种尴尬的默契，互相赞叹对方的东西开创了xx先河，实际上把裤子一脱里面赫然是十年前其他人穿剩下的内裤。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2023/11/16/%E7%A7%91%E7%A0%94%E5%90%90%E6%A7%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/16/%E7%A7%91%E7%A0%94%E5%90%90%E6%A7%BD/" class="post-title-link" itemprop="url">科研吐槽（1）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-16 15:38:13" itemprop="dateCreated datePublished" datetime="2023-11-16T15:38:13+08:00">2023-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/thought/" itemprop="url" rel="index"><span itemprop="name">thought</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/thought/%E7%A7%91%E7%A0%94%E4%BA%8C%E4%B8%89%E4%BA%8B/" itemprop="url" rel="index"><span itemprop="name">科研二三事</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>写开题报告写的相思…原本想着抄师兄师姐们的格式就可以过关了，么想到导提出了更新更高的要求，要求每节综述后面要加一个小结，又要求单开一章写科学问题，原来我问师兄师姐的时候他们都说开题的时候不用讲科学问题啊？？被导轰炸了十几条60s的语音后颤颤巍巍打开返回来的文稿，却发现改动加起来不超过一百个字。算是理解了为什么要抄出新意，因为有些时候正不正确不重要，有没有被见过很重要。</p>
<p>写综述的时候有一些是单纯的对现有研究的总结，说也不行。综述应该暴露问题呀？问题自然是有了，那就是没被人在这个领域做过。这也不行，这不是科学问题，科学问题是这个领域的什么特性让他变得special。如果要一个个回答下去，恐怕要触及一个事实了：没有那么多问题，也没有那么多创新，不过是大家在不停创造问题再解决罢了。有人说这就是科研的本质呀？牛顿不就是提出了苹果为什么会落地再解决的。是啊如果有这么多牛顿的话我今天来学校骑得就不是电动车应该是喷气背包了。实际上大多数人不过是在想这个苹果除了用牙啃还有没有别的吃法。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2023/08/24/mqtt%E5%88%9D%E6%AD%A5%E5%B0%9D%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/24/mqtt%E5%88%9D%E6%AD%A5%E5%B0%9D%E8%AF%95/" class="post-title-link" itemprop="url">MQTT初步尝试</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-08-24 16:16:51" itemprop="dateCreated datePublished" datetime="2023-08-24T16:16:51+08:00">2023-08-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E8%B4%B4/" itemprop="url" rel="index"><span itemprop="name">技术贴</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>MQTT是和http同级对标的一种协议，适用于数据传输。首先，需要一台MQTT服务器，任意的Linux服务器都可以。这里使用EMQX的MQTT解决方案。</p>
<h2 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h2><p>wget <a target="_blank" rel="noopener" href="https://www.emqx.com/en/downloads/broker/5.1.4/emqx-5.1.4-ubuntu20.04-amd64.deb">https://www.emqx.com/en/downloads/broker/5.1.4/emqx-5.1.4-ubuntu20.04-amd64.deb</a><br>sudo apt install .&#x2F;emqx-5.1.4-ubuntu20.04-amd64.deb</p>
<p>安装完毕后启动EMQX服务：</p>
<p>sudo systemctl start emqx<br>sudo emqx ctl admins add [用户名][密码]</p>
<p>访问服务器ip地址+18083端口即可看到EMQX的dashboard。</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2023/08/image.png"><img src="http://www.lxshaw.com/wp-content/uploads/2023/08/image-1024x516.png"></a></p>
<p>这就完了。MQTT服务器就这么简单。下面实现客户端的消息发送和订阅。</p>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p>import paho.mqtt.client as mqtt<br>import threading<br>import random<br>import time</p>
<h1 id="连接成功回调"><a href="#连接成功回调" class="headerlink" title="连接成功回调"></a>连接成功回调</h1><p>class Mqtt_Publisher:<br>    ‘’’<br>        mqtt消息通讯接口<br>    ‘’’<br>    def __init__(self,central_ip&#x3D;’172.24.188.162’,port&#x3D;1883,node_name&#x3D;’bci_‘,anonymous&#x3D;True,timeout&#x3D;60):<br>        ‘’’<br>        :param central_ip: Broker的地址<br>        :param port:  端口号<br>        :param timeout:  连接延时<br>        :param node_name: 节点名称<br>        :param anonymous: 是否同时允许多个节点<br>        ‘’’<br>        self.broker_ip&#x3D;central_ip<br>        self.broker_port&#x3D;port<br>        self.timeout&#x3D;timeout<br>        self.connected&#x3D;False<br>        self.node_name&#x3D;node_name<br>        if anonymous:<br>            self.node_name&#x3D;self.node_name+str(random.randint(100000,999999))<br>        self.Start()<br>    def Start(self):<br>        ‘’’<br>        开启publisher<br>        :return:<br>        ‘’’<br>        self.client &#x3D; mqtt.Client(self.node_name)     #创建客户端<br>        self.client.on_connect &#x3D; self.on_connect  # 指定回调函数<br>        self.client.connect(self.broker_ip, self.broker_port, self.timeout)     #开始连接<br>        self.client.loop_start()    #开启一个独立的循环通讯线程。<br>    def Publish(self,topic,payload,qos&#x3D;0,retain&#x3D;False):<br>        ‘’’<br>            发送一个mqtt消息<br>            :param topic: 消息名称，string类型<br>            :param payload: 消息内容，string类型<br>            :param qos: 消息等级<br>            :retain: 状态机消息<br>            :return:<br>        ‘’’<br>        if self.connected:<br>            return self.client.publish(topic,payload&#x3D;payload,qos&#x3D;qos,retain&#x3D;retain)<br>        else:<br>            raise Exception(“mqtt server not connected! you may use .Start() function to connect to server firstly.”)</p>
<pre><code>&#39;&#39;&#39;
            回调函数
&#39;&#39;&#39;
def on\_connect(self,client, userdata, flags, rc):
    &#39;&#39;&#39;
        连接到broker的回调函数
    &#39;&#39;&#39;
    if rc==0:
        self.connected=True

    else:
        raise Exception(&quot;Failed to connect mqtt server.&quot;)
</code></pre>
<p>if __name__&#x3D;&#x3D;’__main__‘:<br>    p&#x3D;Mqtt_Publisher()<br>    while not p.connected:<br>        pass<br>    while True:<br>        p.Publish(‘test’,’this is a test message’)<br>        p.Publish(‘test_2’,’this is test 2’)<br>        time.sleep(1)</p>
<h3 id="订阅端"><a href="#订阅端" class="headerlink" title="订阅端"></a>订阅端</h3><p>import paho.mqtt.client as mqtt<br>import threading<br>import random<br>import time</p>
<h1 id="连接成功回调-1"><a href="#连接成功回调-1" class="headerlink" title="连接成功回调"></a>连接成功回调</h1><p>class Mqtt_Subscriber:<br>    ‘’’<br>        mqtt消息通讯接口<br>    ‘’’<br>    def __init__(self,central_ip&#x3D;’172.24.188.162’,port&#x3D;1883,<br>                 topic_name&#x3D;’test_2’,callback_func&#x3D;None,<br>                 node_name&#x3D;’bci_‘,anonymous&#x3D;True,timeout&#x3D;60):<br>        ‘’’<br>            :param central_ip: Broker的地址<br>            :param port:  端口号<br>            :param topic_name: 接收的消息名称<br>            :param callback_func: 指定回调函数<br>            :param timeout:  连接延时<br>            :param node_name: 节点名称<br>            :param anonymous: 是否同时允许多个节点<br>        ‘’’<br>        self.topic&#x3D;topic_name<br>        self.callback&#x3D;callback_func<br>        self.broker_ip&#x3D;central_ip<br>        self.broker_port&#x3D;port<br>        self.timeout&#x3D;timeout<br>        self.connected&#x3D;False<br>        self.node_name&#x3D;node_name<br>        if anonymous:<br>            self.node_name&#x3D;self.node_name+str(random.randint(100000,999999))<br>        self.Start()<br>    def Start(self):<br>        ‘’’<br>        开启publisher<br>        :return:<br>        ‘’’<br>        self.client &#x3D; mqtt.Client(self.node_name)     #创建客户端<br>        self.client.on_connect &#x3D; self.on_connect  # 指定回调函数<br>        self.client.on_message&#x3D;self.default_on_message<br>        self.client.connect(self.broker_ip, self.broker_port, self.timeout)     #开始连接<br>        self.client.subscribe(self.topic)<br>        self.client.loop_start()    #开启一个独立的循环通讯线程。</p>
<pre><code>&#39;&#39;&#39;
            回调函数
&#39;&#39;&#39;
def default\_on\_message(self,client, userdata, msg):
    &#39;&#39;&#39;
        默认回调函数
    &#39;&#39;&#39;
    print(msg.payload.decode(&#39;utf-8&#39;))

def on\_connect(self,client, userdata, flags, rc):
    &#39;&#39;&#39;
        连接到broker的回调函数
    &#39;&#39;&#39;
    if rc==0:
        self.connected=True

    else:
        raise Exception(&quot;Failed to connect mqtt server.&quot;)
</code></pre>
<p>if __name__&#x3D;&#x3D;’__main__‘:<br>    p&#x3D;Mqtt_Subscriber()<br>    while not p.connected:<br>        pass<br>    while True:<br>        time.sleep(1)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2023/08/24/%E5%B7%A5%E5%9C%B0%E4%B8%8A%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/24/%E5%B7%A5%E5%9C%B0%E4%B8%8A%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91/" class="post-title-link" itemprop="url">工地上的物联网</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-08-24 14:57:02" itemprop="dateCreated datePublished" datetime="2023-08-24T14:57:02+08:00">2023-08-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/embedded/" itemprop="url" rel="index"><span itemprop="name">embedded</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E8%B4%B4/" itemprop="url" rel="index"><span itemprop="name">技术贴</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/embedded/%E6%A0%91%E8%8E%93%E6%B4%BE/" itemprop="url" rel="index"><span itemprop="name">树莓派</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这是一篇偏常识科普类的文章，以快速区分工地上物联网应用的一些技术。首先，将会从物联网的架构出发。然后，本文将重点介绍工地物联网中的网络问题。工地的物联网应用中网络组织是一大难点，因为工地很少有足够的条件支持搭建无线网或有线网，这种限制可能是来自场地、电源、信号干扰等等。然而，应用物联网的需求又是真实的，搜一下有多少试图在工地上用传感器的研究就知道了。注意我们讨论的不是工地上网的问题——使用LTE、卫星数据、或者市面上可见的LTE热点&#x2F;Wi-Fi都可以实现，也很方便；我们讨论的是将工地上各类有上网需求的设备通过某种方式联系到一起，从而实现数据的共享，这也是物联网的立意。从这一点出发我们将讨论我们可以使用哪些工具和协议，并且最适合工地环境的最佳实践可能是什么。</p>
<h2 id="物联网的架构"><a href="#物联网的架构" class="headerlink" title="物联网的架构"></a>物联网的架构</h2><p>物联网分为感知层、网络层、平台层和应用层。感知层包括了各类传感器进行感知活动。网络层是这篇文章的重点，是数据采集和传输活动的基础。平台层和应用层主要对数据进行管理，建立统一的接口，然后在接口上面做引用。</p>
<h2 id="我们熟知的网络架构"><a href="#我们熟知的网络架构" class="headerlink" title="我们熟知的网络架构"></a>我们熟知的网络架构</h2><p>我们每天都在用互联网，或者严谨一些，叫做万维网。这是我们熟知的接触网络的方式：我们连上wifi，打开一个网页，浏览上面的内容。这很好，非常直观——但是背后到底发生了什么？首先，需要用最简单明了但是完整的方式描述这一过程：</p>
<p>我们首先连接上路由器，使得我们的终端和路由器之间建立起了基于Wi-Fi协议的链接，这种链接使得我们的终端和路由器之间可以进行数据传输。然后我们通过tcp&#x2F;ip协议链接目标服务器，然后用http协议向目标服务器发起网页内容的请求（或者说请求是包装在http协议中的），服务器接收后，同样通过http协议返回内容，而在http协议的下层是tcp&#x2F;ip管道在支撑终端和服务器之间传输数据。</p>
<p>总结一下，从外行人的角度来看，Wi-Fi的本质是无线电波，这是数据传输的一种介质（和光纤是同类的）；tcp&#x2F;ip是一类底层协议，作用是在两者之间建立起数据通路；http是一类高级协议，能够传输更加丰富的数据。</p>
<p>我们可以在这个网络架构上构建初级的物联网平台：传感器通过Wi-Fi传输数据，基于tcp&#x2F;ip和http协议将数据上传到服务器。其他终端应用，可以通过相同的方式访问服务器以获取传感器数据或这通过服务器转发控制命令。然而，是否有更好的方法呢？答案是肯定的。接下来就会从介质和协议两个方面介绍其他的物联网方案。</p>
<h2 id="传输介质"><a href="#传输介质" class="headerlink" title="传输介质"></a>传输介质</h2><p>在物联网场景下，无线介质一般是主流，因为它能够拜托有线传输带来的额外场地需求和安装需求。除了Wi-Fi，其他在物联网中使用的传输介质包括LTE、Zigbee、蓝牙、LoRa、UWB。从原理上说，他们都是无线电波，但是是不同波段的，这赋予了他们不同的通信特性与能力。</p>
<ul>
<li>Wi-Fi：遵循IEEE 802.11标准，工作频率在2.4G和5G。优点是非常通行，传输速度可以很快。缺点是功耗大（相比而言，手机不都是wifi吗），覆盖范围有限，而且受到建筑物等物理障碍的影响更加明显</li>
<li>蓝牙：遵循IEEE 802.15.1标注，工作频率在2.4G。注意蓝牙的通行协议并不是基于tcp&#x2F;ip的，这意味着蓝牙接入www并不是那么方便（并不是不行），所以一般用于组建局域网，通过网关将数据基于tcp&#x2F;ip上云。</li>
<li>Zigbee：遵循IEEE 802.15.4标准，工作频率在2.4G。和蓝牙相似，也是短距通信技术，使用Zigbee的设备也要接入网关后才能上云。Zigbee很省电，但是传输速度低，协议很复杂。</li>
<li>LoRa：LoRa属于一种私有协议，工作频段在433MHz、868MHz和915MHz等低频段。由于频段很低，所以波长很长，这意味着LoRa的绕障能力很强，传输距离很远，但也意味着传输速率很慢。此外LoRa因为属于私有协议，搭建LoRa网络的难度是比较高的。LoRa也需要通过网关（LoRaWAN）上云。</li>
<li>UWB：UWB的工作频率在3.1 - 10.6GHz，远远高于以上任何无线介质。这意味着UWB的传输速度非常快；而且由于波长很小，可以穿墙；此外工作频段和其他介质不同，因此抗干扰能力也比较好。由于UWB是间歇性工作的，耗电量也比较低。但是如果把UWB用作数据传输的话，网上是众说纷纭，有人说功耗大，有人说功耗低，有人说穿透性好，有人说遮挡影响大，有人说传输距离小，有人说传输距离长。这是一个有很大争议的技术，暂时搁置不谈。</li>
<li>LTE：LTE支撑了移动通信技术，只要终端具备LTE能力，在有LTE覆盖的范围内就可以进行通信。LTE一般基于TCP&#x2F;IP进行通信。</li>
</ul>
<p>如果要对上述介质进行分类的话，可以这么分：</p>
<ul>
<li>短距通信：蓝牙、Zigbee、UWB</li>
<li>长距通信：Wi-Fi、LoRa</li>
<li>无网关通信：LTE</li>
</ul>
<h2 id="传输协议（MQTT）"><a href="#传输协议（MQTT）" class="headerlink" title="传输协议（MQTT）"></a>传输协议（MQTT）</h2><p>除了TCP&#x2F;IP协议以外，另一个广为人知的协议是UDP。不过UDP更多应用在流式传输中，在物联网领域，一般还是数据和控制信号的准确性为有限，TCP的含义就是对数据传输的正确性进行评估，因此基于TCP&#x2F;IP的协议应用比较广。在这个基础上，我们就不再深究那些基于UDP的协议了，而是看看有哪些基于TCP&#x2F;IP的协议。此外，Zigbee、蓝牙、LoRa都有自己的协议，不过一般来说都会有一个网关将数据重新封装到TCP&#x2F;IP协议中。这里主要就介绍http和mqtt协议——事实上，为什么要介绍http协议呢？大家都很清楚http协议。我们就直接说mqtt协议吧。</p>
<p>MQTT协议使用的是发布&#x2F;订阅机制，终端通过MQTT协议把数据发布到MQTT服务器的topic上，其他终端订阅该topic就可以获取实时数据。这种数据传输方式有一些像管道，一方往里灌水，另一方取水。是的，就这么简单。它相比http的优势在于实现简单，适用于不太可靠的网络环境下，因为发布者并不需要提前知道订阅者，所以可以实现不可靠网络环境下的端到端通信。相比服务-客户的CS结构，由于mqtt的协议复杂度比http低，所以速度也更快一些（也许吧）。这些因素让mqtt成为了物联网最常使用的（其实也不一定）的传输协议。</p>
<h2 id="工地上的Best-Practice？"><a href="#工地上的Best-Practice？" class="headerlink" title="工地上的Best Practice？"></a>工地上的Best Practice？</h2><h3 id="传输介质-1"><a href="#传输介质-1" class="headerlink" title="传输介质"></a>传输介质</h3><p>首先我们看传输介质。目前而言LoRa在建筑工地中的传输应用兴趣很浓。Minglong Zhang等人在《A construction accident prevention system based on the Internet of Things (IoT)》中如此报道：</p>
<blockquote>
<p>连接到 LoRa 设备 LoRa 6103pro 的计算机作为服务器被放置在建筑物 A 的底层.然后将连接到RFID读取器的LoRa发射器放置在不同的位置， 包括建筑物A和室外建筑工地的不同楼层.</p>
</blockquote>
<p>似乎这说明LoRa具有良好的穿透性，这和一些结论并不符合。</p>
<p>在J. Teizer等人的《Construction resource efficiency improvement by Long Range Wide Area Network tracking and monitoring》，一个LoRa网关被安装在10m的高架上，在目视环境下，能够采集大范围场地内的LoRa信号。LoRa在目视无遮挡的情况下，通信的距离是能够得到保障的，这也是LoRa公认的优势。</p>
<p><a target="_blank" rel="noopener" href="https://link-springer-com.eproxy.lib.hku.hk/article/10.1007/s41693-021-00059-8#auth-Rushi-Dai-Aff1">Rushi Dai</a>等人在《Improving data communication on construction sites via LoRaWAN》测试了长视距下的数据传输。使用了LoRa网关，和树莓派4搭载LoRaWAN协议以和web通信并实现web应用。场景是在野外环境下进行的，在不足中，作者报告了在障碍物下较高的丢包率、LoRA终端无法自动重新加入LoRaWAN等情况。</p>
<p>Linlin Zhao的文章《Development of Intelligent Prefabs Using IoT Technology to Improve the Performance of Prefabricated Construction Projects》在250m*150m的工地上测试了LoRa。特别的他们指出在中国LoRa是在470&#x2F;510MHz工作的，传输速度在0.37-46.9kbps。不过这篇文章也没有涉及到室内的应用。</p>
<p>关于室内LoRa的效果我找到了<a target="_blank" rel="noopener" href="https://ieeexplore-ieee-org.eproxy.lib.hku.hk/author/37085725987">Jetmir Haxhibeqiri</a>的《LoRa indoor coverage and performance in an industrial environment: Case study》作为参考。报告称网关附近的节点在上行链路中平均可以发送2kibt&#x2F;s的数据——一个非常低的数据。研究是在真实的室内工业环境中的，结果指出大多数时候网关和终端之间的通信会被金属材质的运输车阻塞。这点不太乐观，因为建筑工地上的金属部件只会更多，比如临时支撑和脚手架。</p>
<p>总结而言，LoRa在室外工地环境上的应用还是值得期许的，但是在室内环境下的效果不容乐观，但是也暂时没有确切的证据证明不行。Minglong Zhang的研究结果似乎指向了比较好的结果。此外，LoRa的数据传输速度也不容乐观。太小的带宽可能传输不了太多的信息，大多数情况下可能只能传输“必要”的信息。</p>
<p>对于LTE的主要批判是价格太贵。关于这一点，国内电信的物联卡参考标准是10元&#x2F;月，可以使用1GB的流量。如果仅仅是发送数据的话，假设每次发送的数据量是5kb，那么大概能够支撑1个月内连续不断地分钟发送5次消息。此外，LTE可能在一些地方没有覆盖——这一点在中国大陆可能不太存在，喜马拉雅上山都有5G信号。相比之下，似乎在中国大陆使用LTE方案也是值得探究的。LoRa的带宽、干扰问题能够得到很好的解决，相比之下的成本，LoRa的单个模块要比LTE模块便宜，但是要额外的网关成本，半斤八两。如果设备量不大的话，可能LTE方案反而更加省钱。</p>
<p>这里不提WiFi和短距离通信技术，因为我们的目标是整个建筑场地。根据之前已有的实践，WiFi一般需要配合网桥使用，对收发角度很有要求，才能覆盖大面积。一般这种方案会用在无线监控上。另外，短距离通信技术的应用过于受限了，很难组建覆盖整个工地的网络。</p>
<h3 id="传输协议"><a href="#传输协议" class="headerlink" title="传输协议"></a>传输协议</h3><p>不管是使用LoRa还是LTE，都有两个协议可供选择：Http和MQTT。考虑到lora的带宽实在太低，MQTT更常用一些。如果是使用MQTT，则对边缘设备的处理要求可能更高，毕竟服务器只是消息中转。如果有大运算要求，则可能使用http会更合适。例如，如果要针对性地查询一些东西，就需要使用CS架构+http协议了。如果运算都在终端设备上，终端收集完信息后再做运算，mqtt协议会比较适合。这和实际的控制需求相关。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2023/06/14/steamdeck%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%8A%98%E8%85%BE%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/14/steamdeck%E5%8F%8C%E7%B3%BB%E7%BB%9F%E6%8A%98%E8%85%BE%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">SteamDeck双系统折腾指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-14 17:04:45" itemprop="dateCreated datePublished" datetime="2023-06-14T17:04:45+08:00">2023-06-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/thought/" itemprop="url" rel="index"><span itemprop="name">thought</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/thought/%E6%96%B0%E9%B2%9C%E4%BA%8B/" itemprop="url" rel="index"><span itemprop="name">新鲜事</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="所需材料"><a href="#所需材料" class="headerlink" title="所需材料"></a>所需材料</h2><p>SteamDeck一台</p>
<p>TypeC U盘一个</p>
<h2 id="所需软件"><a href="#所需软件" class="headerlink" title="所需软件"></a>所需软件</h2><p><a target="_blank" rel="noopener" href="https://www.ventoy.net/cn/download.html">ventoy</a>：用于从U盘启动ISO镜像</p>
<p><a target="_blank" rel="noopener" href="https://gparted.org/download.php">gparted iso 镜像</a>：用于在只有SteamOS系统的情况下进行分区</p>
<p><a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/software-download/windows11">windows11 iso 镜像</a> - 这是官方的下载地址，下载出来的 ISO 为当前最新的 <strong>22H2</strong> 版本</p>
<p><a target="_blank" rel="noopener" href="https://help.steampowered.com/en/faqs/view/6121-ECCD-D643-BAA8">SteamDeck windows 相关驱动</a> ：包括显卡、无线、蓝牙等</p>
<p>手持伴侣：<a target="_blank" rel="noopener" href="https://github.com/Valkirie/HandheldCompanion">Valkirie&#x2F;HandheldCompanion: ControllerService (github.com)</a>：在Windows上添加必要的按键映射，以及便捷功能</p>
<h2 id="优化体验软件"><a href="#优化体验软件" class="headerlink" title="优化体验软件"></a>优化体验软件</h2><p>双系统启动美化：<a target="_blank" rel="noopener" href="https://github.com/jlobue10/SteamDeck_rEFInd">jlobue10&#x2F;SteamDeck_rEFInd: Simple rEFInd install script for the Steam Deck (with GUI customization) (github.com)</a></p>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><ol>
<li>解压Ventoy，将U盘制作为启动盘，将gparted iso和windows 11 iso放入U盘</li>
<li>启动项选择Ventoy，进入gparted，将磁盘分出一块区域格式化为NTFS作为Windows系统的搭载盘<ul>
<li>我不建议制作互通盘，一方面安装Windows的原因就是玩SteamOS不能玩或体验不好的游戏，没有道理在windows上玩SteamOS体验好的游戏，也没有道理在SteamOS上玩Windows上体验好的游戏。另一方面互通盘可能导致读写BUG。</li>
</ul>
</li>
<li>分区后重新启动SD，再次选择Ventoy，进入Windows 11进行安装，选择专业版即可。安装完成后，安装windows相关驱动。触控板是直接支持的，实体按键也应该直接支持，但是没有按键映射。</li>
<li>安装HandheldCompanion。<ul>
<li>默认下HC不开启Desktop mode，也就是说当HC服务开启后，触控板和扳机就不能当鼠标键盘来使用了。可以在Controller中的Non-game controller layouts中开启Desktop layout。</li>
<li>热键中可以设定快捷命令，例如开启虚拟键盘，任务管理器，quick-tool等。</li>
</ul>
</li>
<li>可以开始游玩了！如果想切换系统，则每次开机后需要先进入启动项选择界面后选择相应的系统。</li>
</ol>
<h2 id="Boot美化"><a href="#Boot美化" class="headerlink" title="Boot美化"></a>Boot美化</h2><p>不喜欢Geek的启动界面？试试Boot美化。在SteamOS中，进入桌面模式，然后安装rEFInd。推荐使用GUI方式安装，方法见[README](<a target="_blank" rel="noopener" href="http://jlobue10/SteamDeck_rEFInd">http://jlobue10/SteamDeck_rEFInd</a>: Simple rEFInd install script for the Steam Deck (with GUI customization) (github.com))。</p>
<p>在安装前，确保以下事项：</p>
<ol>
<li>双系统的EFI安装无误。为了确认这一点，可以使用ls &#x2F;esp&#x2F;efi查看是否存在SteamOS和Microsoft两个文件夹。<ul>
<li>为了查看还需要获取权限。由于SD不为用户预设密码，需要在Konsole中使用passwd命令设置用户密码。设置不会影响到之后的登录（默认直接进入）。</li>
</ul>
</li>
<li>点击桌面的rEFIndGUI图标，查看配置是否正确。如果正确，点击install rEFInd，安装Boot；然后再点击install configuration，以为启动界面提供背景和图标。</li>
<li>开机后则可以看到启动选择界面。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2023/03/28/pythonopencv%E6%89%8B%E7%9C%BC%E6%A0%87%E5%AE%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/28/pythonopencv%E6%89%8B%E7%9C%BC%E6%A0%87%E5%AE%9A/" class="post-title-link" itemprop="url">Python+Opencv手眼标定</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-28 21:47:59" itemprop="dateCreated datePublished" datetime="2023-03-28T21:47:59+08:00">2023-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E8%B4%B4/" itemprop="url" rel="index"><span itemprop="name">技术贴</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>之前用过一个ROS的包进行手眼标定，实际上，手眼标定本身原理也不复杂。刚好一个课程要求在windows上进行手眼标定，机械臂还没有太方便的数据读取方式，所以就手写一个Python程序来进行标定。</p>
<p>主要流程依然是检测Aruco码，获得位姿，然后标定。首先是检测Aruco码，使用了Realsense相机，因为不需要标定内参。这里需要安装Python3.10和Realsense SDK 2.0才能正常使用pyrealsense2包。</p>
<p>import pyrealsense2 as rs<br>import numpy as np<br>import cv2</p>
<h1 id="定义-OpenCV-支持的每个可能的-ArUco-标签的名称"><a href="#定义-OpenCV-支持的每个可能的-ArUco-标签的名称" class="headerlink" title="定义 OpenCV 支持的每个可能的 ArUco 标签的名称"></a>定义 OpenCV 支持的每个可能的 ArUco 标签的名称</h1><p>ARUCO_DICT &#x3D; {“DICT_4X4_50”: cv2.aruco.DICT_4X4_50, “DICT_4X4_100”: cv2.aruco.DICT_4X4_100,<br>              “DICT_4X4_250”: cv2.aruco.DICT_4X4_250, “DICT_4X4_1000”: cv2.aruco.DICT_4X4_1000,<br>              “DICT_5X5_50”: cv2.aruco.DICT_5X5_50, “DICT_5X5_100”: cv2.aruco.DICT_5X5_100,<br>              “DICT_5X5_250”: cv2.aruco.DICT_5X5_250, “DICT_5X5_1000”: cv2.aruco.DICT_5X5_1000,<br>              “DICT_6X6_50”: cv2.aruco.DICT_6X6_50, “DICT_6X6_100”: cv2.aruco.DICT_6X6_100,<br>              “DICT_6X6_250”: cv2.aruco.DICT_6X6_250, “DICT_6X6_1000”: cv2.aruco.DICT_6X6_1000,<br>              “DICT_7X7_50”: cv2.aruco.DICT_7X7_50, “DICT_7X7_100”: cv2.aruco.DICT_7X7_100,<br>              “DICT_7X7_250”: cv2.aruco.DICT_7X7_250, “DICT_7X7_1000”: cv2.aruco.DICT_7X7_1000,<br>              “DICT_ARUCO_ORIGINAL”: cv2.aruco.DICT_ARUCO_ORIGINAL,<br>              “DICT_APRILTAG_16h5”: cv2.aruco.DICT_APRILTAG_16h5,<br>              “DICT_APRILTAG_25h9”: cv2.aruco.DICT_APRILTAG_25h9,<br>              “DICT_APRILTAG_36h10”: cv2.aruco.DICT_APRILTAG_36h10,<br>              “DICT_APRILTAG_36h11”: cv2.aruco.DICT_APRILTAG_36h11}</p>
<h1 id="相机的内参-检查一下参数位置，别写错了，不然debug半天都不知道在哪里"><a href="#相机的内参-检查一下参数位置，别写错了，不然debug半天都不知道在哪里" class="headerlink" title="相机的内参 检查一下参数位置，别写错了，不然debug半天都不知道在哪里"></a>相机的内参 检查一下参数位置，别写错了，不然debug半天都不知道在哪里</h1><p>dist &#x3D; np.array(([[0.0, 0.0, 0.0, 0.0, 0.0]]))<br>mtx &#x3D; np.array([<br> [1375.35, 0., 972.08],<br> [0., 1375.17, 549.164],<br> [0., 0., 1.]])</p>
<p>arucoDict &#x3D; cv2.aruco.Dictionary_get(ARUCO_DICT[“DICT_ARUCO_ORIGINAL”])<br>arucoParams &#x3D; cv2.aruco.DetectorParameters_create()</p>
<p>pipeline &#x3D; rs.pipeline()</p>
<h1 id="创建-config-对象："><a href="#创建-config-对象：" class="headerlink" title="创建 config 对象："></a>创建 config 对象：</h1><p>config &#x3D; rs.config()<br>config.enable_stream(rs.stream.color, 1920, 1080, rs.format.bgr8, 30)</p>
<p>pipeline.start(config)</p>
<p>while True:</p>
<pre><code># Wait for a coherent pair of frames（一对连贯的帧）: depth and color
frames = pipeline.wait\_for\_frames()
color\_frame = frames.get\_color\_frame()

if not color\_frame:
    continue

# Convert images to numpy arrays
color\_image = np.asanyarray(color\_frame.get\_data())

# detect ArucoMarker
(corners, ids, rejected) = cv2.aruco.detectMarkers(
    color\_image, arucoDict, parameters=arucoParams)

if len(corners) &gt; 0:
    # 展平 ArUCo ID 列表
    ids = ids.flatten()
    rvec, tvec, \_ = cv2.aruco.estimatePoseSingleMarkers(
        corners, 0.1, mtx, dist)
    # 循环检测到的 ArUCo 标记
    for i in range(rvec.shape\[0\]):
        cv2.aruco.drawDetectedMarkers(color\_image, corners)
        cv2.drawFrameAxes(color\_image, mtx, dist,
                          rvec\[i, :, :\], tvec\[i, :, :\], 0.03)

# Show images
cv2.namedWindow(&#39;RealSense&#39;, cv2.WINDOW\_AUTOSIZE)

cv2.imshow(&#39;RealSense&#39;, color\_image)

key = cv2.waitKey(24)

if key == ord(&#39;q&#39;):
    break
elif key == ord(&#39;c&#39;):
    print(&#39;rvec: &#39;, rvec, &#39;tvec: &#39;, tvec)
</code></pre>
<p>pipeline.stop()</p>
<p>cv2.aruco.estimatePoseSingleMarkers返回的是rvec，可以通过opencv的Rodrigues方法把它变为旋转矩阵：</p>
<p>R_target2cam1, _ &#x3D; cv2.Rodrigues(rvec1)</p>
<p>这样做的好处是不需要知道vec的定义了，反正cv2本身遵循一致的定义。另一方面，所使用的机械臂输出的却是四元数。所以也需要把四元数转化为旋转矩阵：</p>
<p>def quaternion_to_rotation_matrix(q):<br>    “””将四元数转化为旋转矩阵。</p>
<pre><code>Args:
    q: 4元素一维数组，表示四元数。

Returns:
    3x3的旋转矩阵。
&quot;&quot;&quot;
# 将四元数规范化
q\_norm = q / np.linalg.norm(q)
# 旋转矩阵的计算公式
R = np.array(\[
    \[1-2\*q\_norm\[2\]\*\*2-2\*q\_norm\[3\]\*\*2, 2\*q\_norm\[1\]\*q\_norm\[2\]-2\*q\_norm\[0\]\*q\_norm\[3\], 2\*q\_norm\[1\]\*q\_norm\[3\]+2\*q\_norm\[0\]\*q\_norm\[2\]\],
    \[2\*q\_norm\[1\]\*q\_norm\[2\]+2\*q\_norm\[0\]\*q\_norm\[3\], 1-2\*q\_norm\[1\]\*\*2-2\*q\_norm\[3\]\*\*2, 2\*q\_norm\[2\]\*q\_norm\[3\]-2\*q\_norm\[0\]\*q\_norm\[1\]\],
    \[2\*q\_norm\[1\]\*q\_norm\[3\]-2\*q\_norm\[0\]\*q\_norm\[2\], 2\*q\_norm\[2\]\*q\_norm\[3\]+2\*q\_norm\[0\]\*q\_norm\[1\], 1-2\*q\_norm\[1\]\*\*2-2\*q\_norm\[2\]\*\*2\]
\])
return R
</code></pre>
<p>具体的实验操作是，每移动机械臂到一个新位置，就采集Aruco的位姿信息，机械臂的姿态，然后转化为旋转矩阵和平移向量。使用Tsai法的话，至少要采集三组数据。然后，用calibrateHandEye方法进行校准。值得一提的是，calibrateHandEye的原参数是针对eyeonhand设计的，但是eyetohand也可以使用，需要微调一下参数，可以参照<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40016998/article/details/121099134">这篇文章</a>。</p>
<p>R_cam2base, T_cam2base &#x3D; cv2.calibrateHandEye(R_base2gripper, t_base2gripper, R_target2cam, t_target2cam, cv2.CALIB_HAND_EYE_TSAI)</p>
<p>print(f”R_cam2base:\n{R_cam2base}”)<br>print(f”T_cam2base:\n{T_cam2base}”)</p>
<p>以上就是使用Opencv和Python进行手眼标定的简单流程。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Xiao Lin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">162</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">分类</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/linxiaoshaw@foxmail.com" title="E-Mail → linxiaoshaw@foxmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xiao Lin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
