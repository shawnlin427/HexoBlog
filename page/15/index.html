<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wonderful-sea-04900b000.6.azurestaticapps.net","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Shawn Lin&#39;s Blog">
<meta property="og:url" content="https://wonderful-sea-04900b000.6.azurestaticapps.net/page/15/index.html">
<meta property="og:site_name" content="Shawn Lin&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Xiao Lin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/page/15/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Shawn Lin's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Shawn Lin's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/04/13/%E4%B8%93%E5%AE%B6%E7%B3%BB%E7%BB%9F%E9%87%8C%E7%9A%84%E6%8E%A8%E7%90%86%E6%9C%BA%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/13/%E4%B8%93%E5%AE%B6%E7%B3%BB%E7%BB%9F%E9%87%8C%E7%9A%84%E6%8E%A8%E7%90%86%E6%9C%BA%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">专家系统里的推理机实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-13 17:06:50" itemprop="dateCreated datePublished" datetime="2021-04-13T17:06:50+08:00">2021-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bim/" itemprop="url" rel="index"><span itemprop="name">bim</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bim/%E6%9C%AC%E4%BD%93/" itemprop="url" rel="index"><span itemprop="name">本体</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="专家系统"><a href="#专家系统" class="headerlink" title="专家系统"></a>专家系统</h1><p>专家系统：模仿人类专家的思维方式进行决策的人工智能算法，算法核心是“知识库（knowledge base）”和“推理机（inference engine）”。专家系统通常包括6个部分：人机交互界面、知识库、综合数据库、推理机、解释器、知识获取。</p>
<ul>
<li>知识库：包含解决问题相关的领域知识。在基于规则的专家系统中，<strong>知识用一组规则</strong>来表达。其具有IF（条件）THEN（行为）结构，当规则的条件被满足时，触发规则，继而执行行为。</li>
<li>数据库：包含一组<strong>事实</strong>，用于匹配知识库中的IF（条件）。</li>
<li>推理机：<strong>执行</strong>推理，专家系统由此找到解决方案。推理引擎链接知识库中的规则和数据库中的事实。</li>
<li>解释器：用户使用解释器查看专家系统怎样得出解决方案的过程。</li>
<li>人机交互界面：人机交互界面是实现用户（查询问题解决方案）和专家系统之间交流的途径。</li>
</ul>
<p>一个完整的专家系统图示如下：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/9861E122-6FDC-4D39-AEB3-8AD4D10495EA.png"></p>
<h1 id="推理机"><a href="#推理机" class="headerlink" title="推理机"></a>推理机</h1><p>“推理机”根据“知识库”对“数据库”做出决策的基本原理图如下：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/72B3B600-6C96-4073-84DA-C4F7970AAAC4.png"></p>
<p>CLIPS（C Language Integrated Production System）是一类推理机，原则上可以处理各种领域的推理任务，只要系统能够为CLIPS提供这个领域的特有领域规则(知识库)和事实信息(数据库)。</p>
<h2 id="Jess"><a href="#Jess" class="headerlink" title="Jess"></a>Jess</h2><p>Jess(Java Expert Shell System)是基于Java语言的CLISP推理机。Jess(CLIPS)的优点是：推理机是开放的，用户提供不同的规则系统，就可以进行不同领域的推理工作，用户可以对推理机的推理能力进行扩展。但，作为前向推理系统，Jess用空间换时间，推理会产生大量的中间数据，空间效率很低；同时，由于Jess(CLIPS)是通用推理引擎，不可能提供针对各种具体领域的优化能力，使得这种推理机制的效率很难优化。</p>
<h1 id="针对本体的几类推理机"><a href="#针对本体的几类推理机" class="headerlink" title="针对本体的几类推理机"></a>针对本体的几类推理机</h1><p>针对本体的推理一般集中在集中标准的本体语言上，如OWL、RDFS&#x2F;RDF、DAML等。针对本体的推理机，如Jena、Pellet、FaCT、RACER等，效率较高，但推理能力局限在以上的本体语言中。</p>
<h2 id="Jena"><a href="#Jena" class="headerlink" title="Jena"></a>Jena</h2><p>Jena是面向语义Web的应用开发包，包含的内容比较全面，推理机只是其中一部分。但Jena本身并不是‘推理机设计专家’，它自身包含的推理机基本上就是一种CLIPS配合本体领域产生式规则的前向推理系统。因此，它的运行效率不是很高。好在现在有DIG接口，DIG有点象数据库中的ODBC，允许前端挂接到后台不同的推理引擎上。</p>
<h2 id="Pellet"><a href="#Pellet" class="headerlink" title="Pellet"></a>Pellet</h2><p>Pellet是一个较为“专业”的推理机，由美国马里兰大学（College Park分校）的MindSwap实验室开发。Pellet是基于Java的开放源码系统。Pellet效率较高，但是缺乏对本体规则语言SWRL的支持并且支持的查询语言不够全面，一般只是进行A-Box推理的时候使用Pellet，如果牵涉到T-Box则推荐使用Racer。</p>
<h2 id="RACER"><a href="#RACER" class="headerlink" title="RACER"></a>RACER</h2><p>Racer由德国汉堡大学开发，采用Tableaux算法。给定一个Tbox后，Racer可以完成各种查询服务，在Tbox方面推理能力较强，对大本体文件支持良好。但是Racer不支持对枚举类和用户自定义数据类型的推理。</p>
<h2 id="FaCT"><a href="#FaCT" class="headerlink" title="FaCT++"></a>FaCT++</h2><p>FaCT++是FaCT的新一代产品，由英国曼城斯特大学开发，采用Tableaux算法。Fact++采用了c++语言，但是没有提供OWL接口，不支持对实例的查询。</p>
<h2 id="Hermit"><a href="#Hermit" class="headerlink" title="Hermit"></a>Hermit</h2><p>HermiT支持OWL2本体语言的所有特性，包括OWL 2的所有数据类型，并且它正确地执行对象和数据属性分类，其中有些推理任务并不完全由其他OWL推理器支持。</p>
<p>在Protege中，常用的OWL推理机主要包括HermiT、FaCT、Pellet。</p>
<p>[1] 潘超, 古辉. 本体推理机及应用[J]. 计算机系统应用, 2010, 19(009):163-167.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/04/13/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%B9%9D%EF%BC%89%EF%BC%9Agazebo%E7%AE%80%E4%BB%8B%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/13/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%B9%9D%EF%BC%89%EF%BC%9Agazebo%E7%AE%80%E4%BB%8B%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">无人机编程入门（九）：Gazebo简介、安装与测试</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-13 10:44:20" itemprop="dateCreated datePublished" datetime="2021-04-13T10:44:20+08:00">2021-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/%E6%97%A0%E4%BA%BA%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">无人机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>至今为止，我们都没有见过实体化的无人机，除了地面站中简单地标出了无人机的位置和飞行姿态。一直没能看着自己的无人机真正升空，实在是有一点遗憾。在你尝试在真实的无人机上实验之前，还有一个选择：无人机仿真。如果你只是想让无人机飞到一个地方再飞回来，那么前面的教程就足够你参考了；但是如果你想让无人机进行一些更为精细的操作的话，无人机仿真是很有必要的。</p>
<p>Gazebo是一个很有效的仿真工具，可以用来测试算法、设计机器人、进行测试，提供一个三维视窗来让你观察机器人的表现。在这一章，我们会安装gazebo并进行简单的测试。</p>
<h2 id="安装Gazebo"><a href="#安装Gazebo" class="headerlink" title="安装Gazebo"></a>安装Gazebo</h2><p>安装之前，我们需要对环境变量进行一下设置。Gazebo对虚拟机的3D硬件加速支持有BUG，会出现闪退的情形。因此我们先关闭硬件加速：</p>
<p>echo “ export SVGA_VGPU10&#x3D;0” &gt;&gt; ~&#x2F;.bashrc<br>source ~&#x2F;.bashrc</p>
<p>然后我们将 <a target="_blank" rel="noopener" href="http://packages.osrfoundation.org/">http://packages.osrfoundation.org</a>加入到系统的源列表里，这样我们用apt install就可以安装Gazebo了。：</p>
<p>sudo sh -c ‘echo “deb <a target="_blank" rel="noopener" href="http://packages.osrfoundation.org/gazebo/ubuntu-stable">http://packages.osrfoundation.org/gazebo/ubuntu-stable</a> `lsb_release -cs` main” &gt; &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;gazebo-stable.list’<br>wget <a target="_blank" rel="noopener" href="http://packages.osrfoundation.org/gazebo.key">http://packages.osrfoundation.org/gazebo.key</a> -O -  sudo apt-key add -<br>sudo apt update</p>
<p>接下来安装gazebo9：</p>
<p>sudo apt install gazebo9 libgazebo9-dev</p>
<p>我们打开Gazebo的界面看看安装是否成功：</p>
<p>gazebo –verbose</p>
<p>如果界面能成功打开，并且没有闪退，说明安装没有问题。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-31-1024x970.png"></p>
<h2 id="安装Ardupilot-gazebo插件"><a href="#安装Ardupilot-gazebo插件" class="headerlink" title="安装Ardupilot-gazebo插件"></a>安装Ardupilot-gazebo插件</h2><p>这个插件允许你在Gazebo中对ArduPilot控制的无人机进行仿真，他也提供了一个无人机模型和场景用于观察。</p>
<p>cd $courseRoot<br>git clone <a target="_blank" rel="noopener" href="https://github.com/khancyr/ardupilot/_gazebo">https://github.com/khancyr/ardupilot\_gazebo</a><br>cd ardupilot_gazebo<br>mkdir build<br>cd build<br>cmake ..<br>make -j4<br>sudo make install<br>echo ‘source &#x2F;usr&#x2F;share&#x2F;gazebo&#x2F;setup.sh’ &gt;&gt; ~&#x2F;.bashrc</p>
<p>在这个过程中无人机的模型和默认场景也被下载下来，我们把模型和场景坐在的文件夹也加入环境变量，这样加载时不需要输入完整的模型路径名称。</p>
<p>echo ‘export GAZEBO_MODEL_PATH&#x3D;<del>&#x2F;courseRoot&#x2F;ardupilot_gazebo&#x2F;models’ &gt;&gt; ~&#x2F;.bashrc<br>echo ‘export GAZEBO_RESOURCE_PATH&#x3D;</del>&#x2F;courseRoot&#x2F;ardupilot_gazebo&#x2F;worlds:${GAZEBO_RESOURCE_PATH}’ &gt;&gt; ~&#x2F;.bashrc<br>source ~&#x2F;.bashrc</p>
<h2 id="Gazebo测试"><a href="#Gazebo测试" class="headerlink" title="Gazebo测试"></a>Gazebo测试</h2><p>安装完毕后，我们对Gazebo进行测试。首先，我们运行一个SITL：</p>
<p>sim_vehicle.py -v ArduCopter -f gazebo-iris –map –console</p>
<p>然后，我们运行gazebo：</p>
<p>gazebo –verbose worlds&#x2F;iris_arducopter_runway.world</p>
<p>这时候会卡很久一段时间（我是这样），这是因为gazebo正在下载模型，耐心等待即可，偶尔敲一敲空格（可能有用）。你应该可以看到这样的界面：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-32.png"></p>
<p>然后在控制台里控制无人机起飞，看看会发生什么吧：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-33.png"></p>
<p>芜湖起飞！下一章，我们来看看如何把Gazebo和我们之前学习的知识联系到一起。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/04/12/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89%EF%BC%9Adronekit%E4%BD%BF%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/12/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89%EF%BC%9Adronekit%E4%BD%BF%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">无人机编程入门（八）：DroneKit使用（二）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-12 17:19:34" itemprop="dateCreated datePublished" datetime="2021-04-12T17:19:34+08:00">2021-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/%E6%97%A0%E4%BA%BA%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">无人机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="使用DroneKit制作起飞python脚本"><a href="#使用DroneKit制作起飞python脚本" class="headerlink" title="使用DroneKit制作起飞python脚本"></a>使用DroneKit制作起飞python脚本</h2><p>在这一节中我们来看如何用DroneKit控制SITL起飞，进入dk文件夹，新建一个python文件，输入以下内容：</p>
<p>cd $courseRoot&#x2F;dk<br>gedit basic_template.py<br>—————————–输入以下内容<br>from dronekit import connect, VehicleMode, LocationGlobalRelative, APIException<br>import time<br>import socket<br>import exceptions<br>import math<br>import argparse</p>
<p>def connectMyCopter():</p>
<pre><code>parser = argparse.ArgumentParser(description=&#39;commands&#39;)
parser.add\_argument(&#39;--connect&#39;)
args = parser.parse\_args()

connection\_string = args.connect

if not connection\_string:
    import dronekit\_sitl
    sitl = dronekit\_sitl.start\_default()
    connection\_string = sitl.connection\_string()

vehicle = connect(connection\_string, wait\_ready=True)

return vehicle
</code></pre>
<p>def arm_and_takeoff(targetHeight):<br>while vehicle.is_armable!&#x3D;True:<br>    print(“Waiting for vehicle to become aramable”)<br>    time.sleep(1)<br>print(“Vehicle is now armable”)</p>
<p>vehicle.mode &#x3D; VehicleMode(“GUIDED”)</p>
<p>while vehicle.mode!&#x3D;”GUIDED”:<br>    print(“Waiting for drone to enter GUIDED flight mode”)<br>    time.sleep(1)<br>print(“Vehicle now in GUIDED MODE. Have fun!!”)</p>
<p>vehicle.armed &#x3D; True<br>while vehicle.armed&#x3D;&#x3D;False:<br>    print(“Waiting for drone to become armed”)<br>    time.sleep(1)<br>print(“Look out! Virtual props are spinning!”)</p>
<p>vehicle.simple_takeoff(targetHeight) ##meters</p>
<p>while True:<br>print(“Current Altitude:”, vehicle.location.global_relative_frame.alt)<br>if vehicle.location.global_relative_frame.alt&gt;&#x3D;.95*targetHeight:<br>break<br>time.sleep(1)<br>print(“Target altitude reached!!”)<br>return None</p>
<p>vehicle &#x3D; connectMyCopter()<br>arm_and_takeoff(10)</p>
<p>观察一下arm_and_takeoff这个函数，你会发现起飞是如何进行的：启动和飞行模式修改通过改变无人机的参数实现，起飞到固定高度则通过调用simple_takeoff方法实现。<strong>同时，每进行下一步操作前，都要确保无人机的状态已经满足操作要求，或者上一步操作已经完成。在虚拟环境下运行这个脚本</strong>，观察一下输出：</p>
<p>Starting copter simulator (SITL)<br>SITL already Downloaded and Extracted.<br>Ready to boot.</p>
<blockquote>
<blockquote>
<blockquote>
<p>APM:Copter V3.3 (d6053245)<br>Frame: QUAD<br>Calibrating barometer<br>Initialising APM…<br>barometer calibration complete<br>GROUND START<br>Waiting for vehicle to become aramable<br>Waiting for vehicle to become aramable<br>Waiting for vehicle to become aramable<br>Waiting for vehicle to become aramable<br>Waiting for vehicle to become aramable<br>Vehicle is now armable<br>Waiting for drone to enter GUIDED flight mode<br>Vehicle now in GUIDED MODE. Have fun!!<br>Waiting for drone to become armed<br>Waiting for drone to become armed<br>Waiting for drone to become armed<br>Waiting for drone to become armed</p>
<blockquote>
<blockquote>
<p>ARMING MOTORS<br>GROUND START<br>Waiting for drone to become armed</p>
<blockquote>
<blockquote>
<p>Link timeout, no heartbeat in last 5 seconds<br>…link restored.<br>Initialising APM…<br>Look out! Virtual props are spinning!<br>(‘Current Altitude:’, 0.0)<br>(‘Current Altitude:’, 0.0)<br>(‘Current Altitude:’, 0.34)<br>(‘Current Altitude:’, 1.73)<br>(‘Current Altitude:’, 3.62)<br>(‘Current Altitude:’, 5.71)<br>(‘Current Altitude:’, 7.78)<br>(‘Current Altitude:’, 9.19)<br>(‘Current Altitude:’, 9.69)<br>Target altitude reached!!</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h2 id="连接到外部SITL与QGC"><a href="#连接到外部SITL与QGC" class="headerlink" title="连接到外部SITL与QGC"></a>连接到外部SITL与QGC</h2><p>我们一直在使用dronekit自带的SITL进行测试，但是最终我们应当在外部SITL上进行测试，这样才能把代码更方便地迁移到真实无人机上。为了做到这一点，我们要做的事情包括：</p>
<ol>
<li>启动SITL</li>
<li>启动MAVProxy进行消息转发</li>
<li>启动地面站</li>
<li>启动python脚本</li>
</ol>
<p>如果每次测试都要手动去启动上面这么多程序，显然是比较麻烦的。我们可以写一个bash脚本，来自动完成上面这些操作。新建一个launchSITL文件，然后进行以下操作：</p>
<p>gedit launchSitl<br>—————————输入以下内容<br>#!&#x2F;bin&#x2F;bash</p>
<p>kill -9 $(ps -eF  grep QG  awk -F ‘ ‘ ‘{print $2}’)&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1<br>kill -9 $(ps -eF  grep ardu  awk -F ‘ ‘ ‘{print $2}’)&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1<br>kill -9 $(ps -eF  grep mav  awk -F ‘ ‘ ‘{print $2}’)&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1<br>kill -9 $(ps -eF  grep apm  awk -F ‘ ‘ ‘{print $2}’)&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</p>
<p>#########</p>
<h2 id="Launch-a-Sitl-drone"><a href="#Launch-a-Sitl-drone" class="headerlink" title="Launch a Sitl drone"></a>Launch a Sitl drone</h2><p>&#x2F;home&#x2F;shaw&#x2F;courseRoot&#x2F;apm&#x2F;ardupilot&#x2F;build&#x2F;sitl&#x2F;bin&#x2F;arducopter -S -I0 –home 44.501293,-88.062176,177,180 –model “+” –speedup 1 –defaults $apm&#x2F;ardupilot&#x2F;Tools&#x2F;autotest&#x2F;default_params&#x2F;copter.parm&amp;</p>
<p>sleep 5</p>
<h2 id="Launch-QGC"><a href="#Launch-QGC" class="headerlink" title="Launch QGC"></a>Launch QGC</h2><p>&#x2F;usr&#x2F;local&#x2F;bin&#x2F;QGC.AppImage 2&gt;&#x2F;dev&#x2F;null&amp;</p>
<p>sleep 5</p>
<h2 id="Start-MAVProxy"><a href="#Start-MAVProxy" class="headerlink" title="Start MAVProxy"></a>Start MAVProxy</h2><p>screen -dm mavproxy.py –master&#x3D;tcp:127.0.0.1:5760 –out&#x3D;127.0.0.1:14550 –out&#x3D;127.0.0.1:5762</p>
<p>##Launch the dronekit-python script<br>&#x2F;usr&#x2F;bin&#x2F;python “$1” –connect 127.0.0.1:5762</p>
<p>function finish {<br>kill -9 $(ps -eF  grep QG  awk -F ‘ ‘ ‘{print $2}’)&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1<br>kill -9 $(ps -eF  grep ardu  awk -F ‘ ‘ ‘{print $2}’)&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1<br>kill -9 $(ps -eF  grep mav  awk -F ‘ ‘ ‘{print $2}’)&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1<br>kill -9 $(ps -eF  grep apm  awk -F ‘ ‘ ‘{print $2}’)&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1<br>}</p>
<p>trap finish EXIT<br>——————————保存并退出<br>chmod +x launchSitl<br>sudo cp launchSitl &#x2F;usr&#x2F;local&#x2F;bin&#x2F;launchSitl</p>
<p>我们来看一看这段脚本做了什么：</p>
<ol>
<li>首先，文件开头声明了这是一个可以被bash执行的文件，运行这个文件时默认使用bash运行它；</li>
<li>杀死所有含有以下名字的程序：QG、ardu、mav、apm，保证这些应用不会被占用；</li>
<li>运行一个SITL，&amp;意味着运行过程放到后台，不会在当前控制台中打印输出；</li>
<li>运行QGC，如果有错误输出，把它扔到&#x2F;dev&#x2F;null里（也就是忽略），也在后台运行；</li>
<li>运行MAVProxy，与无人机进行双向通信，并且把消息转发到14550（QGC的端口）和5762（python使用的端口）</li>
<li>运行python脚本，<strong>$1</strong>是你给脚本传入的第一个参数，这个参数就是我们的python文件名</li>
<li>执行完成后，像2中那样杀死所有被脚本开启的进程</li>
<li>退出脚本</li>
</ol>
<p>我们把这个脚本复制到bin文件夹里，这样可以全局调用它。我们试着用这个脚本运行basic_template.py，来让外部SITL起飞（如果你还在虚拟环境里，现在可以退出来了），外部SITL的启动时间会比较长，耐心等待一段时间：</p>
<p>launchSitl basic_template.py</p>
<p>你应该能看到QGC里出现无人机的位置，并且上升到10m后程序结束，窗口全部关闭。</p>
<h2 id="控制SITL行进"><a href="#控制SITL行进" class="headerlink" title="控制SITL行进"></a>控制SITL行进</h2><p>我们先来看第一种行进方式，也就是让无人机飞到固定的经纬度。新建一个python文件，输入以下内容：</p>
<h2 id="cd-courseRoot-dkgedit-location-based-movement-py"><a href="#cd-courseRoot-dkgedit-location-based-movement-py" class="headerlink" title="cd $courseRoot&#x2F;dkgedit location_based_movement.py"></a>cd $courseRoot&#x2F;dk<br>gedit location_based_movement.py</h2><p>from dronekit import connect, VehicleMode, LocationGlobalRelative, APIException<br>import time<br>import socket<br>import exceptions<br>import math<br>import argparse</p>
<p>def connectMyCopter():</p>
<pre><code>parser = argparse.ArgumentParser(description=&#39;commands&#39;)
parser.add\_argument(&#39;--connect&#39;)
args = parser.parse\_args()

connection\_string = args.connect

if not connection\_string:
    import dronekit\_sitl
    sitl = dronekit\_sitl.start\_default()
    connection\_string = sitl.connection\_string()

vehicle = connect(connection\_string, wait\_ready=True)

return vehicle
</code></pre>
<p>def arm_and_takeoff(targetHeight):<br>while vehicle.is_armable!&#x3D;True:<br>    print(“Waiting for vehicle to become aramable”)<br>    time.sleep(1)<br>print(“Vehicle is now armable”)</p>
<p>vehicle.mode &#x3D; VehicleMode(“GUIDED”)</p>
<p>while vehicle.mode!&#x3D;”GUIDED”:<br>    print(“Waiting for drone to enter GUIDED flight mode”)<br>    time.sleep(1)<br>print(“Vehicle now in GUIDED MODE. Have fun!!”)</p>
<p>vehicle.armed &#x3D; True<br>while vehicle.armed&#x3D;&#x3D;False:<br>    print(“Waiting for drone to become armed”)<br>    time.sleep(1)<br>print(“Look out! Virtual props are spinning!”)</p>
<p>vehicle.simple_takeoff(targetHeight) ##meters</p>
<p>while True:<br>print(“Current Altitude:”, vehicle.location.global_relative_frame.alt)<br>if vehicle.location.global_relative_frame.alt&gt;&#x3D;.95*targetHeight:<br>break<br>time.sleep(1)<br>print(“Target altitude reached!!”)<br>return None</p>
<p>def get_distance_meters(targetLocation, currentLocation):<br>dLat &#x3D; targetLocation.lat - currentLocation.lat<br>dLon &#x3D; targetLocation.lon - currentLocation.lon</p>
<p>return math.sqrt((dLon*dLon)+(dLat*dLat))*1.113195e5</p>
<p>def goto(targetLocation):<br>distanceToTargetLocation &#x3D; get_distance_meters(targetLocation, vehicle.location.global_relative_frame)</p>
<p>vehicle.simple_goto(targetLocation)</p>
<p>while vehicle.mode.name &#x3D;&#x3D; “GUIDED”:<br>currentDistance &#x3D; get_distance_meters(targetLocation,vehicle.location.global_relative_frame)<br>if currentDistance &lt; distanceToTargetLocation*.01:<br>print(“Reached target waypoint”)<br>time.sleep(2)<br>break<br>time.sleep(1)<br>return None</p>
<p>wp1 &#x3D; LocationGlobalRelative(44.50202, -88.060316, 10)</p>
<p>vehicle &#x3D; connectMyCopter()<br>arm_and_takeoff(10)</p>
<p>goto(wp1)</p>
<p>vehicle.mode &#x3D; VehicleMode(“LAND”)<br>while vehicle.mode !&#x3D; ‘LAND’<br>print(“Waiting for drone to enter LAND mode”)<br>time.sleep(1)<br>print(“Vehicle in LAND mode”)</p>
<p>while True:<br>time.sleep(1)</p>
<p>首先来看get_distance_meters这个函数，这个函数计算了当前位置和指定位置的距离，距离是我们来用来判断是否继续执行下一步的准则。时刻记住，使用脚本对GUIDED模式的SITL进行操控时，上一步操作结束后才能进行下一步。</p>
<p>我们使用vehicle.simple_goto这个方法来操控无人机到达指定位置，在goto函数里，用距离来判断是否到达指定位置。</p>
<p>在main函数中，我们制定了一个目标位置，让无人机飞往指定位置后切换到LAND降落。运行这个python脚本，看看效果如何：</p>
<p>launchSitl location_based_movement.py</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-24.png"></p>
<h2 id="在AUTO模式下控制无人机"><a href="#在AUTO模式下控制无人机" class="headerlink" title="在AUTO模式下控制无人机"></a>在AUTO模式下控制无人机</h2><p>在GUIDED模式下操控无人机就像你在手控制无人机一样，需要你不断地向无人机发送指令来操控无人机。而在AUTO模式下，你可以直接将你的飞行计划上传到无人机（也是通过MAVLink），这样无人机可以持续执行飞行计划，而不需要一直发送信息。所以AUTO模式非常适合你要让无人机执行一些自动化任务时。而GUIDED模式比较适合你需要让无人机根据环境来改变飞行状态等动态性较高的任务，比如精准降落等。</p>
<p>简单来说在AUTO模式下，我们给无人机一个任务列表，无人机就会自动执行列表中的任务。这个任务列表是通过MAVLink发送的，如果你还有印象的话，MAVLink发送的数据包都遵循一定的组织格式。下面我们来看看如何用DroneKit来发送MAVLink命令。你可以在<a target="_blank" rel="noopener" href="http://ardupilot.org/copter/docs/common-mavlink-mission-command-messages-mav_cmd.html">这里找到更多的mavlink命令</a>。</p>
<p>我们使用dronekit.Command()这个命令来发送MAVLink。你可能还记得MAVLink中的long命令，其实Command()的效果和它基本一样，它包含以下参数：</p>
<p>Command(0,0,0,FrameOfReference, MAVLinkCommand,CurrentWP,AutoContinue,param1,param2,param3,param4,param5,param6,param7)</p>
<p>前面的三个0一般不变；FrameOfReference代表我们使用的坐标系；MAVLinkCommand就是它的字面意思，可以根据文档查看命令名称；CurrentWP一般是0；AutoContinue一般是0；下面的七个参数和MAVLink中的long命令用法是一样的。例如，如果我们要发送WAY_POINT命令，可以到文档里找到对应的参数：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-25-1024x993.png"></p>
<p>也就是说我们在param5\6\7中分别填入纬度、经度和高度，其他参数都填0（默认）.</p>
<p>了解了这些之后，我们来写一个自动飞行的脚本：</p>
<h2 id="cd-courseRoot-dkgedit-auto-mission-py"><a href="#cd-courseRoot-dkgedit-auto-mission-py" class="headerlink" title="cd $courseRoot&#x2F;dkgedit auto_mission.py"></a>cd $courseRoot&#x2F;dk<br>gedit auto_mission.py</h2><p>from dronekit import connect, VehicleMode, LocationGlobalRelative, APIException, Command<br>import time<br>import socket<br>import exceptions<br>import math<br>import argparse<br>from pymavlink import mavutil</p>
<p>def connectMyCopter():</p>
<pre><code>parser = argparse.ArgumentParser(description=&#39;commands&#39;)
parser.add\_argument(&#39;--connect&#39;)
args = parser.parse\_args()

connection\_string = args.connect

if not connection\_string:
    import dronekit\_sitl
    sitl = dronekit\_sitl.start\_default()
    connection\_string = sitl.connection\_string()

vehicle = connect(connection\_string, wait\_ready=True)

return vehicle
</code></pre>
<p>def arm_and_takeoff(targetHeight):<br>while vehicle.is_armable!&#x3D;True:<br>    print(“Waiting for vehicle to become aramable”)<br>    time.sleep(1)<br>print(“Vehicle is now armable”)</p>
<p>vehicle.mode &#x3D; VehicleMode(“GUIDED”)</p>
<p>while vehicle.mode!&#x3D;”GUIDED”:<br>    print(“Waiting for drone to enter GUIDED flight mode”)<br>    time.sleep(1)<br>print(“Vehicle now in GUIDED MODE. Have fun!!”)</p>
<p>vehicle.armed &#x3D; True<br>while vehicle.armed&#x3D;&#x3D;False:<br>    print(“Waiting for drone to become armed”)<br>    time.sleep(1)<br>print(“Look out! Virtual props are spinning!”)</p>
<p>vehicle.simple_takeoff(targetHeight) ##meters</p>
<p>while True:<br>print(“Current Altitude:”, vehicle.location.global_relative_frame.alt)<br>if vehicle.location.global_relative_frame.alt&gt;&#x3D;.95*targetHeight:<br>break<br>time.sleep(1)<br>print(“Target altitude reached!!”)<br>return None</p>
<p>vehicle &#x3D; connectMyCopter()</p>
<p>wphome &#x3D; vehicle.location.global_relative_frame</p>
<p>cmd1 &#x3D; Command(0,0,0,mavutil.mavlink.MAV_FRAME_GLOBAL_RELATIVE_ALT,mavutil.mavlink.MAV_CMD_NAV_WAYPOINT,0,0,0,0,0,0,wphome.lat,wphome.lon,wphome.alt)<br>cmd2 &#x3D; Command(0,0,0,mavutil.mavlink.MAV_FRAME_GLOBAL_RELATIVE_ALT,mavutil.mavlink.MAV_CMD_NAV_WAYPOINT,0,0,0,0,0,0,44.501375,-88.062645,15)<br>cmd3 &#x3D; Command(0,0,0,mavutil.mavlink.MAV_FRAME_GLOBAL_RELATIVE_ALT,mavutil.mavlink.MAV_CMD_NAV_WAYPOINT,0,0,0,0,0,0,44.501746,-88.062242,10)<br>cmd4 &#x3D; Command(0,0,0,mavutil.mavlink.MAV_FRAME_GLOBAL_RELATIVE_ALT,mavutil.mavlink.MAV_CMD_NAV_RETURN_TO_LAUNCH,0,0,0,0,0,0,0,0,0)</p>
<p>cmds &#x3D; vehicle.commands<br>cmds.download()<br>cmds.wait_ready()</p>
<p>cmds.clear()</p>
<p>cmds.add(cmd1)<br>cmds.add(cmd2)<br>cmds.add(cmd3)<br>cmds.add(cmd4)</p>
<p>vehicle.commands.upload()</p>
<p>arm_and_takeoff(10)</p>
<p>print(“after arm and takeoff”)<br>vehicle.mode &#x3D; VehicleMode(“AUTO”)<br>while vehicle.mode !&#x3D; “AUTO”:<br>time.sleep(.2)</p>
<p>while vehicle.location.global_relative_frame.alt &gt; 2:<br>print(“Drone is executing mission, but we can still run code”)<br>time.sleep(2)</p>
<p>我们来看一下这个流程，首先我们编写了几个command，前三个都是WAYPOIN，也就是飞往指定地点，最后一个是LAND。随后，我们下载目前无人机的命令列表，并清空，随后我们逐个在列表中增加命令，随后上传。无人机起飞后，我们将无人机设置为AUTO模式，无人机就会开始执行任务，直到最后一个命令降落。运行这个脚本，看看效果如何：</p>
<p>launchSitl auto_mission.py</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-26.png"></p>
<p>无人机画了一个三角形后降落。</p>
<h2 id="使用DroneKit基于速度控制无人机"><a href="#使用DroneKit基于速度控制无人机" class="headerlink" title="使用DroneKit基于速度控制无人机"></a>使用DroneKit基于速度控制无人机</h2><p>接下来我们使用基于速度的方式来控制无人机，在此之前，我们要明确一下无人机的方位。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-27.png"></p>
<p>在全球坐标系下，正北方是正x轴，正东方是正y轴，正下方是正z轴，反之亦然。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-28.png"></p>
<p>在本地坐标系下，无人机的正方向是x轴，右侧是正y轴，下方是正z轴。无人机虽然是中心对称的，但是安装飞控硬件的时候都会指明无人机的正方向。接下来我们来写一个python脚本来让无人机根据速度移动。我们要在GUIDED模式下对无人机发送自定义的MAVLink指令，对于多数MAVLink指令，生成相应指令的函数为“小写指令名”+“_encode”。如果你在上面的MAVLink文档里找不到对应的command，可以<a target="_blank" rel="noopener" href="https://ardupilot.org/dev/docs/copter-commands-in-guided-mode.html">到这里再找找</a>。我们使用SET_POSITION_TARGET_LOCAL_NED这个命令，它的参数如下：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-29-769x1024.png"></p>
<p>前面三个参数一般就取0，第四个参数指参考系，第五个参数是Bitmask，剩下几个参数写的都很明确了。这个Bitmask是什么呢？位掩码是一种用来定义状态的一串二进制数字，通过与目标数字串进行逻辑运算来达到控制状态的目的。位掩码可以占用很少资源实现丰富的状态标识。这里给出了三种位掩码，我们需要用表示速度的那个，也就是0b110111000111.我们开始写脚本：</p>
<h2 id="cd-courseRoot-dkgedit-velocity-based-movement-py"><a href="#cd-courseRoot-dkgedit-velocity-based-movement-py" class="headerlink" title="cd $courseRoot&#x2F;dkgedit velocity_based_movement.py"></a>cd $courseRoot&#x2F;dk<br>gedit velocity_based_movement.py</h2><p>from dronekit import connect, VehicleMode, LocationGlobalRelative, APIException, Command<br>import time<br>import socket<br>import exceptions<br>import math<br>import argparse<br>from pymavlink import mavutil</p>
<p>def connectMyCopter():</p>
<pre><code>parser = argparse.ArgumentParser(description=&#39;commands&#39;)
parser.add\_argument(&#39;--connect&#39;)
args = parser.parse\_args()

connection\_string = args.connect

if not connection\_string:
    import dronekit\_sitl
    sitl = dronekit\_sitl.start\_default()
    connection\_string = sitl.connection\_string()

vehicle = connect(connection\_string, wait\_ready=True)

return vehicle
</code></pre>
<p>def arm_and_takeoff(targetHeight):<br>while vehicle.is_armable!&#x3D;True:<br>    print(“Waiting for vehicle to become aramable”)<br>    time.sleep(1)<br>print(“Vehicle is now armable”)</p>
<p>vehicle.mode &#x3D; VehicleMode(“GUIDED”)</p>
<p>while vehicle.mode!&#x3D;”GUIDED”:<br>    print(“Waiting for drone to enter GUIDED flight mode”)<br>    time.sleep(1)<br>print(“Vehicle now in GUIDED MODE. Have fun!!”)</p>
<p>vehicle.armed &#x3D; True<br>while vehicle.armed&#x3D;&#x3D;False:<br>    print(“Waiting for drone to become armed”)<br>    time.sleep(1)<br>print(“Look out! Virtual props are spinning!”)</p>
<p>vehicle.simple_takeoff(targetHeight) ##meters</p>
<p>while True:<br>print(“Current Altitude:”, vehicle.location.global_relative_frame.alt)<br>if vehicle.location.global_relative_frame.alt&gt;&#x3D;.95*targetHeight:<br>break<br>time.sleep(1)<br>print(“Target altitude reached!!”)<br>return None</p>
<p>def send_global_ned_velocity(vx, vy, vz):<br>msg &#x3D; vehicle.message_factory.set_position_target_local_ned_encode(<br>0,0,0,mavutil.mavlink.MAV_FRAME_BODY_OFFSET_NED,<br>0b110111000111,<br>0,0,0,<br>vx,vy,vz,<br>0,0,0,<br>0,0)<br>vehicle.send_mavlink(msg)<br>vehicle.flush()</p>
<p>def send_local_ned_velocity(vx, vy, vz):<br>msg &#x3D; vehicle.message_factory.set_position_target_local_ned_encode(<br>0,0,0,mavutil.mavlink.MAV_FRAME_LOCAL_NED,<br>0b110111000111,<br>0,0,0,<br>vx,vy,vz,<br>0,0,0,<br>0,0)<br>vehicle.send_mavlink(msg)<br>vehicle.flush()</p>
<p>vehicle &#x3D; connectMyCopter()<br>arm_and_takeoff(10)<br>time.sleep(2)</p>
<p>i&#x3D;0<br>while i&lt;&#x3D;5:<br>send_global_ned_velocity(5,0,0)<br>time.sleep(1)<br>print(“Moving TRUE NORTH”)<br>i +&#x3D; 1</p>
<p>time.sleep(2)</p>
<p>i&#x3D;0<br>while i&lt;&#x3D;5:<br>send_global_ned_velocity(0,-5,0)<br>time.sleep(1)<br>print(“Moving TRUE WEST”)<br>i +&#x3D; 1</p>
<p>time.sleep(2)</p>
<p>i&#x3D;0<br>while i&lt;&#x3D;5:<br>send_local_ned_velocity(5,0,0)<br>time.sleep(1)<br>print(“Moving NORTH relative to front of drone”)<br>i +&#x3D; 1</p>
<p>time.sleep(2)</p>
<p>i&#x3D;0<br>while i&lt;&#x3D;5:<br>send_local_ned_velocity(0,-5,0)<br>time.sleep(1)<br>print(“Moving NORTH relative to front of drone”)<br>i +&#x3D; 1</p>
<p>time.sleep(2)</p>
<p>i&#x3D;0<br>while i&lt;&#x3D;5:<br>send_local_ned_velocity(0,0,5)<br>time.sleep(1)<br>print(“Moving DOWN”)<br>i +&#x3D; 1</p>
<p>time.sleep(2)</p>
<p>i&#x3D;0<br>while i&lt;&#x3D;5:<br>send_global_ned_velocity(0,0,-5)<br>time.sleep(1)<br>print(“Moving UP”)<br>i +&#x3D; 1</p>
<p>while True:<br>time.sleep(1)<br>———————–保存后退出<br>launchSitl velocity_based_movement.py</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-30-882x1024.png"></p>
<p>飞行器绕圈成功，这里有个bug没注意到，脚本里控制无人机下降的时候触底了，所以自动变成disarmed的状态，飞不起来了。</p>
<h2 id="用Dronekit控制无人机的朝向（yaw角）"><a href="#用Dronekit控制无人机的朝向（yaw角）" class="headerlink" title="用Dronekit控制无人机的朝向（yaw角）"></a>用Dronekit控制无人机的朝向（yaw角）</h2><p>这个脚本和前面大同小异，我在这里不做详细示范，你可以试着自己去实现它。这需要用到这个MAVLink命令：<a target="_blank" rel="noopener" href="https://ardupilot.org/copter/docs/common-mavlink-mission-command-messages-mav_cmd.html#mav-cmd-condition-yaw">MAV_CMD_CONDITION_YAW</a>，并且要求“These MAV_CMDs can be processed if packaged within a <a target="_blank" rel="noopener" href="https://mavlink.io/en/messages/common.html#COMMAND_LONG">COMMAND_LONG</a> message.”你可以回顾一下COMMAND_LONG的形式，结合MAV_CMD_CONDITION_YAW的参数格式来实现它。我直接给出可以使用的脚本，你可以参照一下：</p>
<p>from dronekit import connect, VehicleMode, LocationGlobalRelative, APIException, Command<br>import time<br>import socket<br>import exceptions<br>import math<br>import argparse<br>from pymavlink import mavutil</p>
<p>def connectMyCopter():</p>
<pre><code>parser = argparse.ArgumentParser(description=&#39;commands&#39;)
parser.add\_argument(&#39;--connect&#39;)
args = parser.parse\_args()

connection\_string = args.connect

if not connection\_string:
    import dronekit\_sitl
    sitl = dronekit\_sitl.start\_default()
    connection\_string = sitl.connection\_string()

vehicle = connect(connection\_string, wait\_ready=True)

return vehicle
</code></pre>
<p>def arm_and_takeoff(targetHeight):<br>while vehicle.is_armable!&#x3D;True:<br>    print(“Waiting for vehicle to become aramable”)<br>    time.sleep(1)<br>print(“Vehicle is now armable”)</p>
<p>vehicle.mode &#x3D; VehicleMode(“GUIDED”)</p>
<p>while vehicle.mode!&#x3D;”GUIDED”:<br>    print(“Waiting for drone to enter GUIDED flight mode”)<br>    time.sleep(1)<br>print(“Vehicle now in GUIDED MODE. Have fun!!”)</p>
<p>vehicle.armed &#x3D; True<br>while vehicle.armed&#x3D;&#x3D;False:<br>    print(“Waiting for drone to become armed”)<br>    time.sleep(1)<br>print(“Look out! Virtual props are spinning!”)</p>
<p>vehicle.simple_takeoff(targetHeight) ##meters</p>
<p>while True:<br>print(“Current Altitude:”, vehicle.location.global_relative_frame.alt)<br>if vehicle.location.global_relative_frame.alt&gt;&#x3D;.95*targetHeight:<br>break<br>time.sleep(1)<br>print(“Target altitude reached!!”)<br>return None</p>
<p>def condition_yaw(degrees, relative):<br>if relative:<br>is_relative &#x3D; 1<br>else:<br>is_relative &#x3D; 0<br>msg &#x3D; vehicle.message_factory.command_long_encode(<br>0,0,<br>mavutil.mavlink.MAV_CMD_CONDITION_YAW,<br>0,<br>degrees,<br>0,1,<br>is_relative,<br>0,0,0)<br>vehicle.send_mavlink(msg)<br>vehicle.flush()</p>
<p>vehicle &#x3D; connectMyCopter()<br>arm_and_takeoff(10)<br>condition_yaw(30,1)<br>time.sleep(7)<br>condition_yaw(0,0)<br>time.sleep(7)<br>condition_yaw(270,0)<br>while True:<br>time.sleep(1)</p>
<p>DroneKit的使用就介绍到这里，下一章我会介绍如何在Gazebo中对无人机进行仿真（可能要鸽很久，我自己也还在学）。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/04/11/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9Adronekit%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/11/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9Adronekit%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">无人机编程入门（七）：DroneKit使用（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-11 22:53:41" itemprop="dateCreated datePublished" datetime="2021-04-11T22:53:41+08:00">2021-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/%E6%97%A0%E4%BA%BA%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">无人机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在这一章里我们会学习DroneKit的基本使用方法，内容会比较多，请坐稳：</p>
<h2 id="使用DroneKit连接到SITL无人机"><a href="#使用DroneKit连接到SITL无人机" class="headerlink" title="使用DroneKit连接到SITL无人机"></a>使用DroneKit连接到SITL无人机</h2><p>首先我们在courseRoot下再创建一个文件夹来，来放置我们接下来所有的python脚本：</p>
<p>cd $courseRoot<br>mkdir dk<br>cd dk<br>sudo gedit connection_template.py</p>
<p>在窗口中输入以下内容：</p>
<p>#####DEPENDENCIES#####</p>
<p>from dronekit import connect, VehicleMode, LocationGlobalRelative, APIException<br>import time<br>import socket<br>import exceptions<br>import math<br>import argparse</p>
<p>#####FUNCTIONS#####</p>
<p>def connectMyCopter():</p>
<pre><code>parser = argparse.ArgumentParser(description=&#39;commands&#39;)
parser.add\_argument(&#39;--connect&#39;)
args = parser.parse\_args()
connection\_string = args.connect
</code></pre>
<p>if not connection_string:<br>import dronekit_sitl<br>sitl &#x3D; dronekit_sitl.start_default()<br>connection_string &#x3D; sitl.connection_string()</p>
<pre><code>vehicle = connect(connection\_string, wait\_ready=True)

return vehicle
</code></pre>
<p>#####MAIN EXECUTABLE#####</p>
<p>vehicle &#x3D; connectMyCopter()</p>
<p>我们使用argpars定义了一个命令行接口，你可以从–connect来输入参数，脚本会解析参数，随后我们基于IP参数来连接SITL。如果你不输入参数，则运行一个dronekit自带的SITL。wait_ready指等待连接成功后再进行下一步。接下来我们新建一个Terminal运行SITL：</p>
<p>sim_vehicle.py -v ArduCopter<br>—————–output<br>…<br>SIM_VEHICLE: “mavproxy.py” “–master” “tcp:127.0.0.1:5760” “–sitl” “127.0.0.1:5501” “–out” “127.0.0.1:14550” “–out” “127.0.0.1:14551”<br>…</p>
<p>你可以看到SITL开启了一个对外监听的端口127.0.0.1:14550，我们用它来链接python脚本：</p>
<p>python connection_template.py –connect 127.0.0.1:14550</p>
<p>运行这个脚本不会在当前控制台产生任何输出，但是你应该可以在MAVProxy的控制台里看到以下输出：</p>
<p>APM: ArduCopter V4.0.3 (ffd08628)<br>APM: a44d06f73482473d8d26d9c8407b175e #这个序列码可能不一样<br>APM: Frame: QUAD</p>
<p>如果你看到了以上输出，说明操作没有问题。</p>
<h2 id="用DroneKit获取无人机的飞行参数"><a href="#用DroneKit获取无人机的飞行参数" class="headerlink" title="用DroneKit获取无人机的飞行参数"></a>用DroneKit获取无人机的飞行参数</h2><p>你可以在<a target="_blank" rel="noopener" href="https://dronekit-python.readthedocs.io/en/latest/guide/vehicle_state_and_parameters.html#vehicle-state-parameters">dronekit的文档</a>中了解更多无人机的参数，我们这里只获取一些经常会用到的参数。这个过程很简单，因为我们链接到无人机后会生成一个vehicle对象，我们只需要获取对象的属性即可。我们新建一个python脚本文件，输入以下内容（前面我们建立的python脚本一部分内容可以复用）</p>
<p>cd $courseRoot&#x2F;dk<br>gedit attribute_fetcher.py<br>————————————以下为内容<br>#####DEPENDENCIES#####</p>
<p>from dronekit import connect, VehicleMode, LocationGlobalRelative, APIException<br>import time<br>import socket<br>import exceptions<br>import math<br>import argparse</p>
<p>#####FUNCTIONS#####</p>
<p>def connectMyCopter():</p>
<pre><code>parser = argparse.ArgumentParser(description=&#39;commands&#39;)
parser.add\_argument(&#39;--connect&#39;)
args = parser.parse\_args()
connection\_string = args.connect

if not connection\_string:
import dronekit\_sitl
sitl = dronekit\_sitl.start\_default()
connection\_string = sitl.connection\_string()

vehicle = connect(connection\_string, wait\_ready=True)

return vehicle
</code></pre>
<p>#####MAIN EXECUTABLE#####</p>
<p>vehicle &#x3D; connectMyCopter()</p>
<p>#Version of the autopilot<br>vehicle.wait_ready(‘autopilot_version’)<br>print(‘AutoPilot version: %s’ % vehicle.version)</p>
<p>#Position<br>print(‘Position: %s’ % vehicle.location.global_relative_frame)</p>
<p>#Attitude<br>print(‘Attitude: %s’ % vehicle.attitude)</p>
<p>#Velocity<br>print(‘Velocity: %s’ % vehicle.velocity)</p>
<p>#Last heartbeat<br>print(‘Last heartbeat: %s’ % vehicle.last_heartbeat)</p>
<p>#Is the vehicle good to arm<br>print(‘Is the vehicle good to arm: %s’ % vehicle.is_armable)</p>
<p>#Flight mode<br>print(‘Flight mode: %s’ % vehicle.mode.name)</p>
<p>#Is the vehicle armed<br>print(‘Armed: %s’ % vehicle.armed)</p>
<p>vehicle.close()</p>
<p>直接不带参数运行这个python文件，你应该可以看到以下输出：</p>
<p>Starting copter simulator (SITL)<br>SITL already Downloaded and Extracted.<br>Ready to boot.<br>CRITICAL:autopilot:APM:Copter V3.3 (d6053245)<br>CRITICAL:autopilot:Frame: QUAD<br>CRITICAL:autopilot:Calibrating barometer<br>CRITICAL:autopilot:Initialising APM…<br>CRITICAL:autopilot:barometer calibration complete<br>CRITICAL:autopilot:GROUND START<br>AutoPilot version: APM:Copter-3.3.0<br>Position: LocationGlobalRelative:lat&#x3D;-35.363261,lon&#x3D;149.1652299,alt&#x3D;0.0<br>Attitude: Attitude:pitch&#x3D;0.000484587973915,yaw&#x3D;-0.121489435434,roll&#x3D;0.000107868516352<br>Velocity: [0.0, 0.0, 0.0]<br>Last heartbeat: 0.786125409999<br>Is the vehicle good to arm: False<br>Flight mode: STABILIZE<br>Armed: False</p>
<h2 id="通过DroneKit设置SITL的参数"><a href="#通过DroneKit设置SITL的参数" class="headerlink" title="通过DroneKit设置SITL的参数"></a>通过DroneKit设置SITL的参数</h2><p>在这一节里我们开始通过DroneKit向SITL发出命令来让无人机的螺旋桨开始旋转，以及改变飞行模式等。**在此之前，现在我们使用的dronekit版本似乎有一个bug，不能正确地修改drone_sitl无人机的飞行模式（手动创建的SITL不受影响）。因此，我们额外创建一个虚拟环境来进行这个实验。**输入以下命令：</p>
<p>cd $courseRoot<br>mkdir env<br>cd env<br>sudo apt install virtualenv<br>virtualenv dksitl –system-site-packages<br>source dksitl&#x2F;bin&#x2F;activate<br>pip install dronekit&#x3D;&#x3D;2.9.1<br>pip install MAVProxy&#x3D;&#x3D;1.6.2</p>
<p>输入deactivate，就可以退出虚拟环境；输入source dksitl&#x2F;bin&#x2F;activate，则进入虚拟环境。我们在虚拟环境下新建一个python文件，输入以下内容：</p>
<h2 id="cd-courseRoot-dkgedit-mode-setter-py"><a href="#cd-courseRoot-dkgedit-mode-setter-py" class="headerlink" title="cd $courseRoot&#x2F;dkgedit mode_setter.py"></a>cd $courseRoot&#x2F;dk<br>gedit mode_setter.py</h2><p>#####DEPENDENCIES#####</p>
<p>from dronekit import connect, VehicleMode, LocationGlobalRelative, APIException<br>import time<br>import socket<br>import exceptions<br>import math<br>import argparse</p>
<p>#####FUNCTIONS#####</p>
<p>def connectMyCopter():</p>
<pre><code>parser = argparse.ArgumentParser(description=&#39;commands&#39;)
parser.add\_argument(&#39;--connect&#39;)
args = parser.parse\_args()
connection\_string = args.connect

if not connection\_string:
import dronekit\_sitl
sitl = dronekit\_sitl.start\_default()
connection\_string = sitl.connection\_string()

vehicle = connect(connection\_string, wait\_ready=True)

return vehicle
</code></pre>
<p>#####MAIN EXECUTABLE#####</p>
<p>vehicle &#x3D; connectMyCopter()</p>
<p>while vehicle.is_armable !&#x3D; True:<br>print(“Waiting for vehicle to be armable”)<br>time.sleep(1)<br>print(‘Vehicle is now armable’)</p>
<p>vehicle.mode &#x3D; VehicleMode(“GUIDED”)</p>
<p>while vehicle.mode !&#x3D; ‘GUIDED’:<br>print(“Waiting for vehicle to enter GUIDED mode”)<br>time.sleep(1)<br>print(‘Vehicle is now in GUIDED MODE, ready to fly!’)</p>
<p>vehicle.armed &#x3D; True<br>while vehicle.armed !&#x3D; True:<br>print(“Waiting for vehicle to be armed”)<br>time.sleep(1)<br>print(‘The virtual props are spinning!’)</p>
<p>我们首先检查无人机是否能够起飞，随后设置无人机的飞行模式，以及螺旋桨状态。需要注意的是，无人机开机后需要进行自检，处理MAVProxy命令也需要一定时间，所以每一步命令都需要等待命令传输并执行完成后再进行下一步。保存后运行脚本，你应该可以看到以下输出：</p>
<p>Starting copter simulator (SITL)<br>SITL already Downloaded and Extracted.<br>Ready to boot.</p>
<blockquote>
<blockquote>
<blockquote>
<p>APM:Copter V3.3 (d6053245)<br>Frame: QUAD<br>Calibrating barometer<br>Initialising APM…<br>barometer calibration complete<br>GROUND START<br>Waiting for vehicle to be armable<br>Waiting for vehicle to be armable<br>Waiting for vehicle to be armable<br>Waiting for vehicle to be armable<br>Waiting for vehicle to be armable<br>Vehicle is now armable<br>Waiting for vehicle to enter GUIDED mode<br>Vehicle is now in GUIDED MODE, ready to fly!<br>Waiting for vehicle to be armed<br>Waiting for vehicle to be armed<br>Waiting for vehicle to be armed<br>Waiting for vehicle to be armed</p>
<blockquote>
<blockquote>
<p>ARMING MOTORS<br>GROUND START<br>Waiting for vehicle to be armed</p>
<blockquote>
<blockquote>
<p>Link timeout, no heartbeat in last 5 seconds<br>…link restored.<br>Initialising APM…<br>The virtual props are spinning!</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>如果输出显示上述内容，说明操作没有问题。</p>
<h2 id="另一种查看并修改参数的方式"><a href="#另一种查看并修改参数的方式" class="headerlink" title="另一种查看并修改参数的方式"></a>另一种查看并修改参数的方式</h2><p>我们也可以通过修改vehicle对象的parameter属性（这是一个字典）来修改参数。同样，你可以在<a target="_blank" rel="noopener" href="https://dronekit-python.readthedocs.io/en/latest/guide/vehicle_state_and_parameters.html#vehicle-state-parameters">ArduPilot的文档</a>中了解更多无人机的参数。打开mode_setter.py文件，我们在里面再加上一些语句：</p>
<p>gps_type &#x3D; vehicle.parameters[‘GPS_TYPE’]<br>print(“GPS_TYPE param value is “, gps_type)<br>vehicle.parameters[‘GPS_TYPE’]&#x3D;3<br>gps_type &#x3D; vehicle.parameters[‘GPS_TYPE’]<br>print(“GPS_TYPE param value is “, gps_type)</p>
<p>这段语句的作用是获取并更改GPS的类型，在文档里GPS的类型包括：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-23-539x1024.png"></p>
<p>再次运行这个脚本，观察输出：</p>
<p>(‘GPS_TYPE param value is ‘, 1.0)<br>(‘GPS_TYPE param value is ‘, 3.0)</p>
<p>通过这种方式，我们将GPS的类型从AUTO（自动识别）改为了MTK。DroneKit的使用先告一段落，我们在下一篇继续学习DroneKit。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/04/11/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9Amavlink%E5%92%8Cdronekit%E7%AE%80%E4%BB%8B%E5%92%8C%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/11/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9Amavlink%E5%92%8Cdronekit%E7%AE%80%E4%BB%8B%E5%92%8C%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">无人机编程入门（六）：MAVLink和DroneKit简介和安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-11 11:46:55" itemprop="dateCreated datePublished" datetime="2021-04-11T11:46:55+08:00">2021-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/%E6%97%A0%E4%BA%BA%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">无人机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="MAVLink"><a href="#MAVLink" class="headerlink" title="MAVLink"></a>MAVLink</h2><p>简单地说，MAVLink是无人机和地面站直接通信的标准信息协议，就像任何一门语言一样，你需要把你发出的声音按照语言规则组织，才能让对方理解。MAVLink也要求信息以规定的架构组织，才能被双方所理解。</p>
<p>一条MAVLink的大小在8字节到263字节之间，总是包含以下内容并且按照顺序排布：</p>
<ol>
<li>开始位，总是以0xFE开始，不以这个开始的字节包都不是MAVLink且不会被无人机解析</li>
<li>Payload length，表达了包的长度</li>
<li>Packet sequence，可以用于探测包丢失</li>
<li>System ID，一般来说1指无人机，255指地面站，取值范围可以是1-255</li>
<li>Component ID，用来区分传输来的信息所属的传感器</li>
<li>Message ID，代表信息的类型，这样可以用对应的解析方式解析</li>
<li>Data，信息的内容</li>
<li>校验位</li>
</ol>
<p>上面是我的个人理解，可能有误。想要了解更多，可以参考<a target="_blank" rel="noopener" href="https://mavlink.io/zh/messages/common.html">mavlink的文档</a>.使用MAVLink的时候，一般只需要关注6和7项，你可以理解成，分别代表了函数名和参数。例如之前我们使用的调整参数的MAVProxy命令，在MAVLink中，对应的Message ID是#23，代表PARAM_SET命令，其参数包含在Data中。</p>
<p>另一种重要的MAVLink是Command Long，这种命令可以把其他命令包含在数据包里，并额外发送最多七个参数。下面是一个使用Command Long发送LAND命令的例子：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-21-1024x555.png"></p>
<p>Command_Long中的command包括所有MAV_CMD，包括各种飞行任务，你可以在文档里查阅他们。所以，Command_Long是我们使用MAVLink执行飞行任务的主要方式。下面是一个飞向指定地点的MAV_CMD形式。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-22-1024x483.png"></p>
<p>还有一些其他有趣的MAVLink命令，包括设置飞行区、获取参数等等，等待你自己去发掘。</p>
<h2 id="DroneKit"><a href="#DroneKit" class="headerlink" title="DroneKit"></a>DroneKit</h2><p>DroneKit是一个python包，你可以用DroneKit简单地生成MAVLink。DroneKit的强大之处在于其基于Python，你可以把MAVLink和其他python任务结合起来，从而为你的无人机编写复杂的任务，比如巡逻、送货、多无人机编队等等。</p>
<h2 id="MAVLink与DroneKit安装"><a href="#MAVLink与DroneKit安装" class="headerlink" title="MAVLink与DroneKit安装"></a>MAVLink与DroneKit安装</h2><p>首先我们安装特定版本的dronkit和dronkit-sitl，这个过程中会自动安装pymavlink：</p>
<p>pip install dronekit&#x3D;&#x3D;2.9.2<br>pip install dronekit-sitl&#x3D;&#x3D;3.3.0</p>
<p>安装完毕后，检查一下你的版本是否与文章中一致：</p>
<h2 id="pip-freeze-grep-dronekit"><a href="#pip-freeze-grep-dronekit" class="headerlink" title="pip freeze  grep dronekit"></a>pip freeze  grep dronekit</h2><p>dronekit&#x3D;&#x3D;2.9.2<br>dronekit-sitl&#x3D;&#x3D;3.3.0</p>
<p>下一章我们会开始使用DroneKit来编写一些简单的无人机操控python脚本。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/04/11/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9A%E5%9C%B0%E9%9D%A2%E7%AB%99%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/11/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9A%E5%9C%B0%E9%9D%A2%E7%AB%99%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">无人机编程入门（五）：地面站介绍与使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-11 11:11:22" itemprop="dateCreated datePublished" datetime="2021-04-11T11:11:22+08:00">2021-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/%E6%97%A0%E4%BA%BA%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">无人机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是地面站？"><a href="#什么是地面站？" class="headerlink" title="什么是地面站？"></a>什么是地面站？</h2><p>在无人机基础知识中，已经介绍过地面站，其实就是一类可以与无人机双向交流的软硬件。地面站既可以指可以发送特定指令和接受并解析无人机回传信息的软件，也可以指搭载这类软件的硬件。在使用SITL的时候，其实我们就已经在使用地面站了，不过我们使用的是命令行界面的，有一些GUI更加精美的地面站软件，比如QStation，可以更方便地查看并操控无人机。从地面站向无人机发送讯息时，信息流向如下图所示：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-15-1024x360.png"></p>
<h2 id="MAVProxy"><a href="#MAVProxy" class="headerlink" title="MAVProxy"></a>MAVProxy</h2><p>首先我们来了解MAVProxy，这是一种命令行式的地面站，非常轻量，但是包含了地面站应当用的大部分功能。你可以从ardupilot的文档中了解更多MAVProxy的知识。地面站可以通过无线网络与无人机通信，由于MAVProxy和SITL都运行在同一台电脑上，可以通过本地连接的方式进行通信，只需要指定通信端口即可。对于SITL来说，这个端口是5760，因此开启地面站并连接的方式如下：</p>
<p>首先我们手动启动一个SITL，这一步的好处在于这样不会加载默认配置参数，你可以创建自己的配置来调整你无人机的参数，这样不用每次启动无人机都要重新调整参数（如果你有调整参数的需求的话）。启动的时候，你还可以指定启动的位置，就好像你真的在现实中放置了一个无人机一样（记得修改参数文件位置）：</p>
<p>cd $apm&#x2F;ardupilot<br>cd build<br>cd sitl<br>cd bin<br>.&#x2F;arducopter -S -I0 –home -35.363261,149.165230,584,353 –model “+” –speedup 1 –defaults &#x2F;home&#x2F;shaw&#x2F;courseRoot&#x2F;apm&#x2F;ardupilot&#x2F;Tools&#x2F;autotest&#x2F;default_params&#x2F;copter.parm</p>
<p>启动之后，你应当能看到Serial port 0 on TCP port 5760，Waiting for connection的返回。接下来我们启动MAVProxy来连接无人机，新建一个Terminal：</p>
<p>mavproxy.py –master tcp:120.0.0.1:5760</p>
<p>连接成功，你可以在MAVProxy里向无人机发送信息了，就和之前教程中的一样。</p>
<h2 id="QGroundControl安装"><a href="#QGroundControl安装" class="headerlink" title="QGroundControl安装"></a>QGroundControl安装</h2><p>QGC是一款有着精美GUI界面的地面站，可以方便用户的操作，在之后的无人机编程中，我们会首选QGC作为我们的地面站。首先从官网<a target="_blank" rel="noopener" href="https://docs.qgroundcontrol.com/master/en/getting_started/download_and_install.html">下载QGC</a>到本地，然后我们再创建一个src文件夹来放QGC和我们以后编写的程序，向QGC授权后将其拷贝到环境变量中，这样可以从任何地方运行QGC：</p>
<p>cd $courseRoot<br>mkdir src<br>cd src<br>cp ~&#x2F;Downloads&#x2F;QGroundControl.AppImage QGroundControl.AppImage<br>sudo chmod +x QGroundControl.AppImage<br>sudo cp QGroundControl.AppImage &#x2F;usr&#x2F;local&#x2F;bin&#x2F;QGC.AppImage</p>
<p>然后运行QGC.AppImage打开界面，选项如图设置：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-16.png"></p>
<p>此时地面站已开启，等待无人机连接。下一步我们连接SITL和地面站。</p>
<h2 id="连接SITL和QGroundControl"><a href="#连接SITL和QGroundControl" class="headerlink" title="连接SITL和QGroundControl"></a>连接SITL和QGroundControl</h2><p>我们通过mavproxy来做到这一点。具体而言，我们先使用mavproxy来连接SITL，然后再用mavproxy将信息转发给QGC，从而实现SITL和QGroundControl的连接，如下：</p>
<p>$apm&#x2F;ardupilot&#x2F;build&#x2F;sitl&#x2F;bin&#x2F;arducopter -S -I0 –home -35.363261,149.165230,584,353 –model “+” –speedup 1 –defaults &#x2F;home&#x2F;shaw&#x2F;courseRoot&#x2F;apm&#x2F;ardupilot&#x2F;Tools&#x2F;autotest&#x2F;default_params&#x2F;copter.parm<br>#############开启一个新Terminal<br>QGC.AppImage<br>#############开启一个新Terminal<br>mavproxy.py –master tcp:127.0.0.1:5760 –out udp:127.0.0.1:14550</p>
<p>为什么使用udp？这里不多说网络知识，简单地说，mavproxy和QGC不需要双向沟通，只QGC只需要接受mavproxy传输来的数据就行，因此使用udp即可。QGC的端口默认是14550. 你应该可以在QGC中看到你的无人机位置了：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-17-1024x976.png"></p>
<p>QGC当然也支持连接到其他端口，如下设置：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-18.png"></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-19.png"></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-20.png"></p>
<p>SITL开了5760、5762、5763三个端口，所以使用tcp连接，可以把端口设置成以上的任何一个。设置完毕后，可以直接点击connect，就可以连接到无人机。</p>
<h2 id="更多的MAVProxy命令"><a href="#更多的MAVProxy命令" class="headerlink" title="更多的MAVProxy命令"></a>更多的MAVProxy命令</h2><p>在之前我们接触了mode GUIDED, takeoff这些非常简单的MAVProxy命令，不仅如此你还可以使用MAVProxy指示无人机飞行固定的距离、指定速度、转向等等。MAVProxy命令可以用dronekit来生成，并通过mavlink发送，这是下一章的主要内容。查看更多的mavproxy命令，可以到<a target="_blank" rel="noopener" href="https://ardupilot.github.io/MAVProxy/html/modules/index.html">ardupilot的相关文档</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/04/10/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9Asitl%E7%9A%84%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/10/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9Asitl%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">无人机编程入门（四）：SITL的使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-10 23:42:45" itemprop="dateCreated datePublished" datetime="2021-04-10T23:42:45+08:00">2021-04-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/%E6%97%A0%E4%BA%BA%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">无人机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>SITL是这篇教程使用的主力“机型”。对SITL的操作和对真实无人机的操作是相同的，在结果上也是相同的。当然，现实中无人机飞行所需要处理的不确定更多，但是炸SITL比炸真无人机便宜得多，所以虽然不能完全模拟现实环境，SITL的重要性也不言而喻。</p>
<h3 id="你的第一架SITL"><a href="#你的第一架SITL" class="headerlink" title="你的第一架SITL"></a>你的第一架SITL</h3><p>由于我们已经把autotest路径加入了环境，所以直接运行：</p>
<p>sim_vehicle.py -v ArduCopter –map –console</p>
<p>这会开启一个地图让你观察无人机的位置，以及一个控制台来让你控制无人机，第一次运行会进行编译，需要一定的时间，之后就不需要了：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-12-1024x486.png"></p>
<p>我们会与左边三个窗口进行交互，分别是地图、状态窗与控制台。地图显示了当前无人机的位置和朝向，状态窗显示无人机的高程、电池容量、飞行状态、GPS状态等，控制台允许你向无人机发送指令。在控制台中输入以下指令，试着让无人机起飞：</p>
<p>mode GUIDED<br>arm throttle<br>takeoff 10</p>
<p>观察状态窗，你会发现无人机上升到高度为10m时停止了。接下来让无人机飞向一个特定位置，在地图上右键选择一点，选择Fly to：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-13-1024x486.png"></p>
<p>最后让无人机降落：</p>
<p>mode LAND</p>
<p>这样，你就完成了你的第一次SITL飞行！</p>
<h3 id="SITL的参数"><a href="#SITL的参数" class="headerlink" title="SITL的参数"></a>SITL的参数</h3><p>接下来会介绍SITL的相关参数，我们进入ArduCopter查看SITL都有哪些参数：</p>
<p>cd $apm&#x2F;ardupilot&#x2F;ArduCopter<br>cat mav.parm</p>
<p>你会看到各种各样的预设参数。如果找不到mav.parm这个文件，在当前目录下再运行一次sim_vehicle.py试试。大部分参数都是可读的，例如RTL_ALT，指的是无人机返航时的巡航高度；BATT_CAPACITY，就是电池容量，等等。你可以从<a target="_blank" rel="noopener" href="http://ardupilot.org/copter/docs/parameters.html">ardupilot的参数文档</a>获取更多参数信息（可能需要科学上网）。接下来我们尝试在控制台中设置参数，首先运行：</p>
<p>sim_vehicle.py –map –console</p>
<p>然后在控制台里设置无人机的返回巡航高度参数（RTL_ALT)：</p>
<p>param show rtl_alt #查看当前的参数<br>param set rtl_alt 2100<br>mode RTL</p>
<p>可以看到，设置之后，返航巡航高度保持在了21m。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-14.png"></p>
<p>SITL的基本使用和参数就介绍到这里，下一章将会介绍地面站以及其在SITL上的使用方法。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/04/10/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9Aardupilot%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/10/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9Aardupilot%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">无人机编程入门（三）：ArduPilot简介与安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-10 23:14:25" itemprop="dateCreated datePublished" datetime="2021-04-10T23:14:25+08:00">2021-04-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/%E6%97%A0%E4%BA%BA%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">无人机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ArduPilot简介"><a href="#ArduPilot简介" class="headerlink" title="ArduPilot简介"></a>ArduPilot简介</h2><p>ArduPilot通过多种传感器的数据（GPS、加速度计、气压计、磁场计）等来估计飞行器的姿态，从而使飞行器能够保持稳定。被称为APM的飞控硬件，其实全程就是Ardu Pilot Mega，但是2013年后，这个系列的飞控硬件改名为Pixhawk，ArduPilot只用来指特定的飞控软件，但是约定俗称地也可以用APM来指ArduPilot（一点轶闻）。ArduPilot含有超过七十万条代码，所以很幸运我们不用自己去写飞控代码，直接用就可以了，大大降低了入门门槛。</p>
<h2 id="ArduPilot安装"><a href="#ArduPilot安装" class="headerlink" title="ArduPilot安装"></a>ArduPilot安装</h2><p>我们在课程文件夹下新建一个apm文件夹，并安装ArduPilot（4.0.3版本）：</p>
<p>cd $courseRoot<br>mkdir apm<br>cd apm<br>git clone -b Copter-4.0.3 <a target="_blank" rel="noopener" href="https://github.com/ardupilot/ardupilot">https://github.com/ardupilot/ardupilot</a></p>
<p>安装完成后，进入ardupilot文件夹，并安装一些子模块：</p>
<p>cd ardupilot<br>git submodule init<br>git submodule update  –init –recursive</p>
<p>完成后，我们将ArduPilot的一些工具加入环境变量，这样不用每次运行到进入对应的路径，方便测试：</p>
<p>sudo nano ~&#x2F;.bashrc</p>
<p>在文件中加入（记得把路径改成你自己的用户名）：</p>
<p>export PATH&#x3D;”&#x2F;home&#x2F;shaw&#x2F;courseRoot&#x2F;apm&#x2F;ardupilot&#x2F;Tools&#x2F;autotest”:$PATH<br>export apm&#x3D;&#x2F;home&#x2F;shaw&#x2F;courseRoot&#x2F;apm</p>
<p>然后source ~&#x2F;.bashrc。输入sim_后按tab键，如果可以自动补全为sim_vehicle.py，说明设置成功了。</p>
<h2 id="认识ArduPilot"><a href="#认识ArduPilot" class="headerlink" title="认识ArduPilot"></a>认识ArduPilot</h2><h3 id="ArduPilot支持的飞控"><a href="#ArduPilot支持的飞控" class="headerlink" title="ArduPilot支持的飞控"></a>ArduPilot支持的飞控</h3><p>我们回到ardupilot文减价，查看一下ardupilot的飞控硬件：</p>
<h2 id="cd-apm-ardupilot-waf-list-boards"><a href="#cd-apm-ardupilot-waf-list-boards" class="headerlink" title="cd $apm&#x2F;ardupilot.&#x2F;waf list_boards"></a>cd $apm&#x2F;ardupilot<br>.&#x2F;waf list_boards</h2><p>aero airbotf4 bbbmini bebop bhat blue crazyflie2 CUAV_GPS CUAVv5 CUAVv5Nano CubeBlack CubeBlack+ CubeGreen-solo CubeOrange CubePurple CubeSolo CubeYellow dark disco DrotekP3Pro Durandal edge erleboard erlebrain2 f103-ADSB f103-GPS f103-periph f103-RangeFinder F35Lightning F4BY fmuv2 fmuv3 fmuv4 fmuv4-beta fmuv5 iomcu KakuteF4 KakuteF7 KakuteF7Mini linux MatekF405 MatekF405-STD MatekF405-Wing MatekF765-Wing mindpx-v2 mini-pix mRoControlZeroF7 mRoX21 mRoX21-777 navio navio2 NucleoH743 ocpoc_zynq omnibusf4 omnibusf4pro omnibusf4v6 OMNIBUSF7V2 OmnibusNanoV6 PH4-mini Pixhawk1 Pixhawk1-1M Pixhawk4 Pixracer pocket pxf pxfmini revo-mini rst_zynq sitl SITL_arm_linux_gnueabihf SITL_static SITL_x86_64_linux_gnu skyviper-f412-rev1 skyviper-journey skyviper-v2450 sparky2 speedybeef4 TBS-Colibri-F7 VRBrain-v51 VRBrain-v52 VRBrain-v54 VRCore-v10 VRUBrain-v51 ZubaxGNSS zynq</p>
<p>基本上，ardupilot支持所有常见的飞控硬件，其中值得关注的是SITL，这是我们接下来要使用的虚拟无人机。</p>
<h3 id="ArduPilot支持的飞行模式"><a href="#ArduPilot支持的飞行模式" class="headerlink" title="ArduPilot支持的飞行模式"></a>ArduPilot支持的飞行模式</h3><p>经常会使用的飞行模式包括：</p>
<ol>
<li>GUIDED，这是最常使用的飞行模式，无人机会根据实时的指令进行飞行；</li>
<li>AUTO，无人机会根据预先设定的指令进行飞行，这个过程中也可以实时发送新的指令；</li>
<li>RTL，return to land的缩写，无人机会返回起飞点；</li>
<li>LAND，无人机降落。</li>
</ol>
<p>这几个模式可以支持大部分的飞行需求。</p>
<p>下一章，会主要介绍SITL的使用方式。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/04/10/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/10/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">无人机编程入门（二）：环境配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-10 00:01:22" itemprop="dateCreated datePublished" datetime="2021-04-10T00:01:22+08:00">2021-04-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/%E6%97%A0%E4%BA%BA%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">无人机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在这一期中，我会展示无人机编程需要的环境，以及软件版本。整体而言，整个教程是在Ubuntu18.04下进行的，所以这要求你有必要的Linux操作系统知识。</p>
<h2 id="软件版本"><a href="#软件版本" class="headerlink" title="软件版本"></a>软件版本</h2><ul>
<li><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1MtOoxVRp98QYFxXgMVZaqA">VMware Pro 16</a> （这里给出学习版本的，密码在教程（一）中找）</li>
<li><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/18.04/ubuntu-18.04.5-desktop-amd64.iso">Ubuntu 18.04</a>（这里给出清华大学镜像站的安装文件，加快下载速度）</li>
<li>Dronekit 2.9.2</li>
<li>ArduCopter 4.0.4</li>
<li>MAVProxy 1.8.17</li>
<li>Pymavlink 2.4.10</li>
</ul>
<p>强烈建议你使用相同的软件和操作系统版本，这样出现问题的概率会小一些。</p>
<h2 id="虚拟机安装"><a href="#虚拟机安装" class="headerlink" title="虚拟机安装"></a>虚拟机安装</h2><p>我们希望能在一个尽可能纯净的环境下进行实验，此外ArduCopter、MAVProxy这些软件也对Linux有更好的支持，所以需要安装一个Ubuntu虚拟机。在安装之前，在任务管理器下检查一下你的虚拟化功能是否启用了。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-3.png"></p>
<p>如果没有，参照<a target="_blank" rel="noopener" href="http://www.xitongcheng.com/jiaocheng/win10_article_53803.html">这篇教程</a>来开启虚拟化。</p>
<p>随后我们下载VMware安装包与Ubunutu 18.04安装镜像。安装完毕VMware之后，进入程序界面，选择创建新的虚拟机：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-4-1024x509.png"></p>
<p>选择经典安装，下一步安装操作系统，选择刚刚下载的Ubuntu 18.04：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-5.png"></p>
<p>下一步设置虚拟机的名称和用户密码，按自己的喜好即可：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-6.png"></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-7.png"></p>
<p>下一步选择磁盘大小、分配CPU和内存。磁盘分配20GB基本足够，保险起见可以分配40GB。不用担心它占据大量的原存储空间，它刚开始占用空间很小，随着你往虚拟机里增加内容，它会逐渐变大，最大不超过40GB。分配CPU与内存的时候，分配你的宿主机的25%是一个比较好的选择，也就是说，如果你的宿主机有4个核心，那么就给虚拟机分配一个核心；如果你有16GB的内存，给虚拟机分配4GB的内存。我的电脑有6个核心32GB内存，我在这里给虚拟机分配了2个核心和8GB的内存。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-8.png"></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-9.png"></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-10-914x1024.png"></p>
<p>完成之后打开虚拟机。打开虚拟机后，会询问是否下载VMware Tools，点击是。然后坐等Ubuntu安装完毕即可。<strong>安装完毕进入界面后，会询问你是否更新到Ubuntu20，请选择否！</strong></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-11-1024x614.png"></p>
<h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><h3 id="更改源"><a href="#更改源" class="headerlink" title="更改源"></a>更改源</h3><p>在安装软件前，更改一下下载源，否则下载的速度会慢的让你怀疑人生。</p>
<p>sudo cp &#x2F;etc&#x2F;apt&#x2F;sources.list &#x2F;etc&#x2F;apt&#x2F;sources.list.bak<br>sudo gedit &#x2F;etc&#x2F;apt&#x2F;sources.list</p>
<p>把文件内容换成下面的内容：</p>
<p>deb <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a> bionic main restricted universe multiverse</p>
<h1 id="deb-src-https-mirrors-tuna-tsinghua-edu-cn-ubuntu-bionic-main-restricted-universe-multiverse"><a href="#deb-src-https-mirrors-tuna-tsinghua-edu-cn-ubuntu-bionic-main-restricted-universe-multiverse" class="headerlink" title="deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse"></a>deb-src <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a> bionic main restricted universe multiverse</h1><p>deb <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a> bionic-updates main restricted universe multiverse</p>
<h1 id="deb-src-https-mirrors-tuna-tsinghua-edu-cn-ubuntu-bionic-updates-main-restricted-universe-multiverse"><a href="#deb-src-https-mirrors-tuna-tsinghua-edu-cn-ubuntu-bionic-updates-main-restricted-universe-multiverse" class="headerlink" title="deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse"></a>deb-src <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a> bionic-updates main restricted universe multiverse</h1><p>deb <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a> bionic-backports main restricted universe multiverse</p>
<h1 id="deb-src-https-mirrors-tuna-tsinghua-edu-cn-ubuntu-bionic-backports-main-restricted-universe-multiverse"><a href="#deb-src-https-mirrors-tuna-tsinghua-edu-cn-ubuntu-bionic-backports-main-restricted-universe-multiverse" class="headerlink" title="deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse"></a>deb-src <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a> bionic-backports main restricted universe multiverse</h1><p>deb <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a> bionic-security main restricted universe multiverse</p>
<h1 id="deb-src-https-mirrors-tuna-tsinghua-edu-cn-ubuntu-bionic-security-main-restricted-universe-multiverse"><a href="#deb-src-https-mirrors-tuna-tsinghua-edu-cn-ubuntu-bionic-security-main-restricted-universe-multiverse" class="headerlink" title="deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse"></a>deb-src <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a> bionic-security main restricted universe multiverse</h1><p>保存后更新一下源：</p>
<p>sudo apt-get update</p>
<h3 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h3><p>首先安装一些依赖项：</p>
<p>sudo apt-get install python-dev python-opencv python-wxgtk3.0 python-matplotlib python-pygame python-lxml python-yaml vim git screen -y</p>
<p>然后安装pip来自动安装和管理一些python的包：</p>
<p>sudo apt-get install python-pip</p>
<p>安装完毕后，检查一下pip是否安装成功以及版本：</p>
<p>pip –version<br>pip 9.0.1 from &#x2F;usr&#x2F;lib&#x2F;python2.7&#x2F;dist-packages (python 2.7)</p>
<p>然后我们安装MAVProxy，这是一个python的模块，在这个过程中还会安装一些其他的包例如pymavlink等。完成后，运行两行命令删除一些不需要的包：</p>
<p>sudo pip install MAVProxy&#x3D;&#x3D;1.8.17<br>sudo usermod -a -G dialout $USER<br>sudo apt-get remove modemmanager</p>
<p>在开始安装ArduPilot之前，我建议把所有的程序放在一个文件夹里以便管理，像下面这样：</p>
<p>cd ~<br>mkdir courseRoot<br>sudo echo “export courseRoot&#x3D;&#x2F;home&#x2F;$USER&#x2F;courseRoot” &gt;&gt; ~&#x2F;.bashrc<br>source .bashrc</p>
<p>上面的命令创建了一个courseRoot文件夹，并将其置入环境变量，这样你可以使用<code>cd $courseRoot</code> 从任何地方进入此文件夹。环境布置到这里结束，下一章会介绍ArduPilot以及其使用方法。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/04/09/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%89%8D%E8%A8%80%E4%BB%A5%E5%8F%8A%E6%97%A0%E4%BA%BA%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/09/%E6%97%A0%E4%BA%BA%E6%9C%BA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%89%8D%E8%A8%80%E4%BB%A5%E5%8F%8A%E6%97%A0%E4%BA%BA%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">无人机编程入门（一）：前言以及无人机基础知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-09 23:48:18" itemprop="dateCreated datePublished" datetime="2021-04-09T23:48:18+08:00">2021-04-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/%E6%97%A0%E4%BA%BA%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">无人机</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这篇教程是给那些对无人机有所兴趣，不仅想要操控无人机，更想要对无人机进行编程的开发者和创客的。这篇教程是我通过在Drone Dojo的付费课程<a target="_blank" rel="noopener" href="https://courses.dojofordrones.com/p/drone-programming-primer-for-software-development">Drone Programming Primer</a>学习后写下的，基本涵盖了其课程的大部分内容。如果你想要了解更多细节，可以自己购买（49美元），或者在回复中发表你的意见。</p>
<p>这篇教程的优势在于：</p>
<ul>
<li>并不要求学习者掌握太多编程技巧，了解Python和Linux命令行就可以开始学习；</li>
<li>并不要求学习者拥有一架真正的无人机，所有的操作都是在虚拟环境中实现的，但是也可以方便地迁移到真实地无人机上；</li>
<li>极其详细的步骤说明，复现Drone Dojo课程中的操作，但是不需要几个小时的时间去学习课程</li>
<li>完全免费</li>
</ul>
<p>闲话不多说，下面进入正题。</p>
<h2 id="无人机系统"><a href="#无人机系统" class="headerlink" title="无人机系统"></a>无人机系统</h2><p>除了常见的四旋翼无人机，无人机还包括很多其他形态，但是他们的系统都大同小异。无人机系统主要组成有三块：无人机，地面站，以及沟通层。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-1-1024x547.png"></p>
<h3 id="无人机"><a href="#无人机" class="headerlink" title="无人机"></a>无人机</h3><p>无人机的组成主要为三块，飞控软件、飞控硬件以及无人机硬件。无人机硬件包括GPS、螺旋桨、机架等组成无人机的基础硬件，你可以在橙色软件上很方便地买到。飞控硬件是包含了陀螺仪等传感器，以及具有一定处理能力的微处理器，比较著名的开源飞控是pixhawk，Daft Punk是【】年解散的。当然，你也完全可以用树莓派做一个自己的飞控，橙色软件上也有相应的开发板卖。常见的飞控软件主要有两个，ArduPilot与px4。这两个都是开源软件，不同的是ArduPilot遵循GPL协议，也就是说如果你使用ArduPilot开发你的程序，你的程序也必须是开源的。而PX4遵循BDS协议，不要求你对自己的程序也进行开源，所以很多商用开发会使用PX4.不管是哪一种飞控软件，都有很庞大的社区和完善的文档以供学习。这是一架真实无人机的主要组成，但是在本课程中，<strong>你可以用SITL（Software In The Loop）来代替飞控硬件和无人机硬件</strong>，这也是为什么本课程不需要真实无人机的原因。</p>
<h3 id="沟通层"><a href="#沟通层" class="headerlink" title="沟通层"></a>沟通层</h3><p>沟通层允许地面站和无人机之间双向发送信息，这样地面站可以接受无人机的信息，同时也可以向无人机发送信息。实际上只要使用的信息是两者都可以解析的，就可以作为沟通方式。不过最常见的沟通方式是MAVLINK，这是一种标准传输协议，可以同时被无人机和地面站理解。</p>
<h3 id="地面站"><a href="#地面站" class="headerlink" title="地面站"></a>地面站</h3><p>这个名字可能会让人误解，但是地面站可以是任何能与无人机传输信息的设备，可以是电脑，手机，遥控器。地面站的硬件只需要满足能够发送与接受MAVLINK信息即可。地面站软件一般是可视化的界面，常见的地面站软件包括Mission Planner，APM Planner，QControl，他们的功能大同小异。</p>
<p>在本课程中，我们会使用的技术栈如图所示：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/04/image-2.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/16/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Xiao Lin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">162</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">分类</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/linxiaoshaw@foxmail.com" title="E-Mail → linxiaoshaw@foxmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xiao Lin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
