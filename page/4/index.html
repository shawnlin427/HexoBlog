<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wonderful-sea-04900b000.6.azurestaticapps.net","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Shawn Lin&#39;s Blog">
<meta property="og:url" content="https://wonderful-sea-04900b000.6.azurestaticapps.net/page/4/index.html">
<meta property="og:site_name" content="Shawn Lin&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Xiao Lin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Shawn Lin's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Shawn Lin's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2022/11/03/%E6%9C%BA%E6%A2%B0%E8%87%82%E7%9B%AE%E6%A0%87%E8%BF%BD%E8%B8%AA%E4%BB%BF%E7%9C%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/03/%E6%9C%BA%E6%A2%B0%E8%87%82%E7%9B%AE%E6%A0%87%E8%BF%BD%E8%B8%AA%E4%BB%BF%E7%9C%9F/" class="post-title-link" itemprop="url">机械臂目标追踪仿真</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-03 16:02:53" itemprop="dateCreated datePublished" datetime="2022-11-03T16:02:53+08:00">2022-11-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/Robotics/" itemprop="url" rel="index"><span itemprop="name">Robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/Iginition/" itemprop="url" rel="index"><span itemprop="name">Iginition</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/Iginition/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li>Ubuntu 20.04</li>
<li>ROS Noetic</li>
<li>Gazebo11</li>
<li>Moveit</li>
<li>Kinova-ros</li>
<li>Aruco-ros</li>
<li>Blender</li>
<li>IntelRealsense-ros</li>
</ol>
<h2 id="制作追踪目标"><a href="#制作追踪目标" class="headerlink" title="制作追踪目标"></a>制作追踪目标</h2><p>Blender导入模型</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-3.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-3-1024x804.png"></a></p>
<p>贴个图</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-4.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-4-1024x548.png"></a></p>
<p>导出到Dae，获得dae和贴图</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-5.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-5-1024x478.png"></a></p>
<p>文件组织</p>
<p>.<br>└── aruco_hook<br>    ├── aruco_hook.sdf<br>    ├── materials<br>    │   └── textures<br>    │       └── aruco-582.png<br>    ├── meshes<br>    │   └── untitled.dae<br>    └── model.config</p>
<p>Gazebo里面</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-6.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-6-1024x702.png"></a></p>
<h2 id="Kinova机器人仿真"><a href="#Kinova机器人仿真" class="headerlink" title="Kinova机器人仿真"></a>Kinova机器人仿真</h2><p>roslaunch kinova_gazebo robot_launch.launch</p>
<p>报错：process has died [pid 9323, exit code 255, cmd &#x2F;opt&#x2F;ros&#x2F;noetic&#x2F;lib&#x2F;gazebo_ros&#x2F;gzserver -u -e ode &#x2F;home&#x2F;lin&#x2F;kinova_ws&#x2F;src&#x2F;kinova-ros&#x2F;kinova_gazebo&#x2F;worlds&#x2F;jaco.world __name:&#x3D;gazebo __log:&#x3D;&#x2F;home&#x2F;lin&#x2F;.ros&#x2F;log&#x2F;f6f9f014-5b38-11ed-a96a-9344835dca73&#x2F;gazebo-2.log].</p>
<p>killall gzserver</p>
<h2 id="Realsense仿真"><a href="#Realsense仿真" class="headerlink" title="Realsense仿真"></a>Realsense仿真</h2><p><a target="_blank" rel="noopener" href="https://github.com/pal-robotics/realsense_gazebo_plugin.git">https://github.com/pal-robotics/realsense_gazebo_plugin.git</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/IntelRealSense/realsense-ros.git">https://github.com/IntelRealSense/realsense-ros.git</a></p>
<p>编译</p>
<p><a target="_blank" rel="noopener" href="https://github.com/pal-robotics-forks/realsense/tree/upstream/realsense2_description/urdf">https://github.com/pal-robotics-forks/realsense/tree/upstream/realsense2_description&#x2F;urdf</a></p>
<p>用这里的<a target="_blank" rel="noopener" href="https://github.com/pal-robotics-forks/realsense/blob/upstream/realsense2_description/urdf/_d435.urdf.xacro">_d435.urdf.xacro</a>、<a target="_blank" rel="noopener" href="https://github.com/pal-robotics-forks/realsense/blob/upstream/realsense2_description/urdf/_d435.gazebo.xacro">_d435.gazebo.xacro</a>替换<a target="_blank" rel="noopener" href="https://github.com/IntelRealSense/realsense-ros.git">realsense-ros</a>库里的xacro文件，复制<a target="_blank" rel="noopener" href="https://github.com/pal-robotics-forks/realsense/blob/upstream/realsense2_description/urdf/test_d435_camera.urdf.xacro">test_d435_camera.urdf.xacro</a>文件</p>
<p>查看是否成功</p>
<p>rosrun gazebo_ros spawn_model -urdf -file test_d435_camera.urdf -model realsense2_camera</p>
<p>这里urdf要自己手动生成一下</p>
<p><strong>BUG</strong>：没有点云数据</p>
<p>检查_d435.gazebo.xacro里设置是否开启</p>
<pre><code>  &lt;pointCloud&gt;true&lt;/pointCloud&gt;
</code></pre>
<h2 id="Realsense添加到机器人上"><a href="#Realsense添加到机器人上" class="headerlink" title="Realsense添加到机器人上"></a>Realsense添加到机器人上</h2><p>robot_launch里修改参数，用自己喜欢的Kinova机器人</p>
  <!-- these are the arguments you can pass this launch file, for example paused:=true -->  
  <arg name="kinova\_robotType" default="j2n7s300"/>
  <arg name="kinova\_robotName" default="$(arg kinova\_robotType)"/>
  <arg name="paused" default="true"/>
  <arg name="use\_sim\_time" default="true"/>
  <arg name="gui" default="true"/>
  <arg name="headless" default="false"/>
  <arg name="debug" default="false"/>
  <arg name="use\_trajectory\_controller" default="true"/>
  <arg name="is7dof" default="true"/>
  <arg name="rqt" default="false"/>
  <arg name="has2finger" default="false"/>
  <arg name="description\_name" default="robot\_description"/> <!-- allows remapping of robot\_description into a namespace -->

<p>对应的RobotDescription是j2n7s300_standalone.xacro，添加描述</p>
<pre><code>&lt;xacro:include filename=&quot;$(find realsense2\_description)/urdf/\_d435.urdf.xacro&quot; /&gt;
</code></pre>
<p>&lt;xacro:sensor_d435 parent&#x3D;”j2n7s300_link_base”&gt;<br>    <origin xyz="0.3 0.4 0.5" rpy="0 0 0"/><br>  &lt;&#x2F;xacro:sensor_d435&gt;</p>
<p>运行launchfile</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-7.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-7-1024x503.png"></a></p>
<p>Rviz</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-8.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-8-1024x359.png"></a></p>
<h2 id="识别Aruco"><a href="#识别Aruco" class="headerlink" title="识别Aruco"></a>识别Aruco</h2><p>新写个Launch file一起启动gazebo模拟和aruco detector</p>
<launch>
  <include file="$(find kinova\_gazebo)/launch/robot\_launch.launch"/>

  <include file="$(find aruco\_ros)/launch/single.launch">
    <arg name="markerId" value="582"/>
    <arg name="markerSize" value="0.034"/>
    <arg name="ref\_frame" value="camera\_color\_frame"/>
  </include>

</launch>

<p>运行效果</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-9.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-9-1024x583.png"></a></p>
<p>方向错了，把aruco中single launch的ref frame和camera frame改成camera_color_optical_frame</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-10.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-10-1024x555.png"></a></p>
<p>这下对了</p>
<h2 id="Moveit！"><a href="#Moveit！" class="headerlink" title="Moveit！"></a>Moveit！</h2><p>开启模拟</p>
<p>roslaunch kinova_gazebo robot_launch.launch kinova_robotType:&#x3D;j2s7s300</p>
<p>启动Moveit</p>
<p>roslaunch j2s7s300_moveit_config j2s7s300_gazebo_demo.launch</p>
<p><strong>报错</strong></p>
<p>[ERROR] [1667528001.838003987, 12.500000000]: The kinematics plugin (arm) failed to load. Error: According to the loaded plugin descriptions the class trac_ik_kinematics_plugin&#x2F;TRAC_IKKinematicsPlugin with base class type kinematics::KinematicsBase does not exist. Declared types are cached_ik_kinematics_plugin&#x2F;CachedKDLKinematicsPlugin cached_ik_kinematics_plugin&#x2F;CachedSrvKinematicsPlugin j2n6s300_arm_kinematics&#x2F;IKFastKinematicsPlugin j2s6s300_arm_kinematics&#x2F;IKFastKinematicsPlugin j2s7s300_robot_arm_kinematics&#x2F;IKFastKinematicsPlugin kdl_kinematics_plugin&#x2F;KDLKinematicsPlugin lma_kinematics_plugin&#x2F;LMAKinematicsPlugin m1n6s300_mico_arm_kinematics&#x2F;IKFastKinematicsPlugin srv_kinematics_plugin&#x2F;SrvKinematicsPlugin<br>[ERROR] [1667528001.838122122, 12.500000000]: Kinematics solver could not be instantiated for joint group arm.</p>
<p>安装Kinematics</p>
<p>sudo apt install ros-noetic-trac-ik-kinematics-plugin</p>
<p>报错（拖动标记规划时）</p>
<p>[ERROR] [1667528367.276877631, 81.935000000]: Failed to fetch current robot state</p>
<p>把Use Cartisian Path勾选取消即可。可能是个BUG</p>
<h3 id="Python-Interface"><a href="#Python-Interface" class="headerlink" title="Python Interface"></a>Python Interface</h3><p>BUG [ WARN] [1667528713.845880249, 219.848000000]: Joint values for monitored state are requested but the full state is not known机器人的关节状态都是初始值</p>
<p>Launchfile中remap了机器人的关节话题</p>
<remap unless="$(arg fake\_execution)" from="/joint\_states" to="$(arg joint\_states\_ns)" />

<p>在Python脚本里也要制定话题</p>
<p>import sys<br>import copy<br>import rospy<br>import moveit_commander<br>import moveit_msgs.msg<br>import geometry_msgs.msg</p>
<h1 id="指定话题"><a href="#指定话题" class="headerlink" title="指定话题"></a>指定话题</h1><p>joint_state_topic &#x3D; [‘joint_states:&#x3D;&#x2F;j2s7s300&#x2F;joint_states’]<br>moveit_commander.roscpp_initialize(joint_state_topic)<br>rospy.init_node(‘move_group_python_interface_tutorial’,<br>                anonymous&#x3D;True)</p>
<p>robot &#x3D; moveit_commander.RobotCommander()<br>scene &#x3D; moveit_commander.PlanningSceneInterface()<br>group &#x3D; moveit_commander.MoveGroupCommander(“arm”)<br>print(robot.get_current_state())</p>
<p>可以显示当前的关节状态了</p>
<p>规划一个pose</p>
<p>pose_target &#x3D; geometry_msgs.msg.Pose()<br>pose_target.orientation.w &#x3D; 1.0<br>pose_target.position.x &#x3D; 0.7<br>pose_target.position.y &#x3D; -0.05<br>pose_target.position.z &#x3D; 1.1<br>group.set_pose_target(pose_target)<br>plan1 group.plan()<br>group.go(wait&#x3D;True)</p>
<p>需要知道Aruco的位置和朝向,</p>
<p>import tf<br>listener &#x3D; tf.TransformListener()<br>(t,r) &#x3D; listener.lookupTransform(‘&#x2F;world’,’&#x2F;aruco_marker_frame’, rospy.Time(0))</p>
<p>pose_target &#x3D; geometry_msgs.msg.Pose()<br>pose_target.orientation.x &#x3D; r[0]<br>pose_target.orientation.y &#x3D; r[1]<br>pose_target.orientation.z &#x3D; r[2]<br>pose_target.orientation.w &#x3D; r[3]<br>pose_target.position.x &#x3D; t[0]<br>pose_target.position.y &#x3D; t[1]<br>pose_target.position.z &#x3D; t[2]<br>group.set_pose_target(pose_target)   </p>
<p>plan &#x3D; group.plan()<br>group.go(wait&#x3D;True)</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-11.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-11-1024x602.png"></a></p>
<h2 id="抓取姿态调整"><a href="#抓取姿态调整" class="headerlink" title="抓取姿态调整"></a>抓取姿态调整</h2><p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-13.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-13-1024x654.png"></a></p>
<p>这个姿势好，末端执行器相对marker坐标系先饶Z转90度，再绕Y转90度，RPY角为90 90 0.</p>
<p>计算一个新的tf</p>
<p>import transforms3d as tfs<br>m &#x3D; tfs.quaternions.quat2mat(r)<br>m1 &#x3D; tfs.euler.euler2mat(pi&#x2F;2, pi&#x2F;2, 0)<br>fq &#x3D; tfs.quaternions.mat2quat(m1.dot(m))</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-14.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-14-1024x615.png"></a></p>
<p>不知为何，完全相反.控制爪子</p>
<p>group2 &#x3D; moveit_commander.MoveGroupCommander(“gripper”)<br>grip_target &#x3D; [1.4, 0, 1.4]<br>group2.set_joint_value_target(grip_target)<br>group2.plan()<br>group2.go() </p>
<p>模拟器里爪子抖的和帕金斯似的。显示Controller失败，准备用真的机械臂使一下。</p>
<p>完结！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2022/11/02/aruco-6d%E4%BD%8D%E5%A7%BF%E6%A3%80%E6%B5%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/02/aruco-6d%E4%BD%8D%E5%A7%BF%E6%A3%80%E6%B5%8B/" class="post-title-link" itemprop="url">Aruco 6D位姿检测</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-02 20:13:22" itemprop="dateCreated datePublished" datetime="2022-11-02T20:13:22+08:00">2022-11-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/Robotics/" itemprop="url" rel="index"><span itemprop="name">Robotics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="准备一个Aruco"><a href="#准备一个Aruco" class="headerlink" title="准备一个Aruco"></a>准备一个Aruco</h2><p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-1.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-1-1024x576.png"></a></p>
<p>ID 582，边长5cm</p>
<h2 id="Aruco-ros"><a href="#Aruco-ros" class="headerlink" title="Aruco-ros"></a>Aruco-ros</h2><p>git clone <a target="_blank" rel="noopener" href="https://github.com/pal-robotics/aruco/_ros.git">https://github.com/pal-robotics/aruco\_ros.git</a></p>
<p>别忘了切换到对应的ros分支再编译！</p>
<p>检测一个Aruco</p>
<p>使用realsense，但是任何一个标定过的rgb摄像头都可以。</p>
<p>修改launch file</p>
<arg name="markerId"        default="582"/>
<arg name="markerSize"      default="0.05"/>    <!-- in m -->
<arg name="eye"             default="left"/>
<arg name="marker\_frame"    default="aruco\_marker\_frame"/>
<arg name="ref\_frame"       default=""/>  <!-- leave empty and the pose will be published wrt param parent\_name -->
<arg name="corner\_refinement" default="LINES" /> <!-- NONE, HARRIS, LINES, SUBPIX -->


<node pkg="aruco\_ros" type="single" name="aruco\_single">
    <remap from="/camera\_info" to="/camera/color/camera\_info" />
    <remap from="/image" to="/camera/color/image\_raw" />
    <param name="image\_is\_rectified" value="True"/>
    <param name="marker\_size"        value="$(arg markerSize)"/>
    <param name="marker\_id"          value="$(arg markerId)"/>
    <param name="reference\_frame"    value="$(arg ref\_frame)"/>   <!-- frame in which the marker pose will be refered -->
    <param name="camera\_frame"       value="camera\_color\_frame"/>
    <param name="marker\_frame"       value="$(arg marker\_frame)" />
    <param name="corner\_refinement"  value="$(arg corner\_refinement)" />
</node>

<p>仅对realsense有效！不同相机更改camera info、image、reference_frame和camera_frame</p>
<p>运行aruco_detector</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image-2.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-2-1024x584.png"></a></p>
<h2 id="一些测试结果"><a href="#一些测试结果" class="headerlink" title="一些测试结果"></a>一些测试结果</h2><p>5cm的Aruco在70-80cm处可以识别，realsense分辨率是1024*768</p>
<p>Aruco辨识角在75度左右</p>
<p>相机移动过程中无法识别，但是标记移动能够持续识别。应该是因为相机移动的时候要重新计算自适应阈值。</p>
<p>旋转的标记比平移的标记要更容易追踪。</p>
<p>Aruco标志旁边要保留白色边框以在黑色背景下识别。</p>
<p>Aruco对遮挡非常非常敏感。如果场景中可能会发生遮挡，Aruco可能无法使用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2022/11/02/ros-orkintelrealsense%EF%BC%88%E5%A4%B1%E8%B4%A5%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/02/ros-orkintelrealsense%EF%BC%88%E5%A4%B1%E8%B4%A5%EF%BC%89/" class="post-title-link" itemprop="url">ROS ORK+intelrealsense（失败）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-02 15:32:04" itemprop="dateCreated datePublished" datetime="2022-11-02T15:32:04+08:00">2022-11-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/Robotics/" itemprop="url" rel="index"><span itemprop="name">Robotics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Ubuntu16.04 安装ROS kinect</p>
<h2 id="ORK"><a href="#ORK" class="headerlink" title="ORK"></a>ORK</h2><h3 id="安装ros-ork"><a href="#安装ros-ork" class="headerlink" title="安装ros-ork"></a>安装ros-ork</h3><p>前置</p>
<p>#sudo apt-get install libopenni-dev ros-kinetic-catkin ros-kinetic-ecto* ros-kinetic-opencv-candidate ros-kinetic-moveit</p>
<h3 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h3><p>sudo apt install git</p>
<p>clone源码</p>
<p>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/object/_recognition/_core">http://github.com/wg-perception/object\_recognition\_core</a><br>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/capture">http://github.com/wg-perception/capture</a><br>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/reconstruction">http://github.com/wg-perception/reconstruction</a><br>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/linemod">http://github.com/wg-perception/linemod</a><br>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/ork/_renderer">http://github.com/wg-perception/ork\_renderer</a><br>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/tabletop">http://github.com/wg-perception/tabletop</a><br>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/tod">http://github.com/wg-perception/tod</a><br>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/transparent/_objects">http://github.com/wg-perception/transparent\_objects</a></p>
<p>clone ROS stuff</p>
<p>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/object/_recognition/_msgs">http://github.com/wg-perception/object\_recognition\_msgs</a><br>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/object/_recognition/_ros">http://github.com/wg-perception/object\_recognition\_ros</a><br>git clone <a target="_blank" rel="noopener" href="http://github.com/wg-perception/object/_recognition/_ros/_visualization">http://github.com/wg-perception/object\_recognition\_ros\_visualization</a></p>
<p>catkin make编译</p>
<p>cd ..&#x2F; &amp;&amp; catkin_make</p>
<p><strong>报错</strong> SDL&#x2F;SDL.h: No such file or directory GL&#x2F;osmesa.h: No such file or directory</p>
<p>sudo apt-get install libsdl1.2-dev<br>sudo apt-get install libosmesa6-dev</p>
<h2 id="CouchDB-建立模型库"><a href="#CouchDB-建立模型库" class="headerlink" title="CouchDB 建立模型库"></a>CouchDB 建立模型库</h2><p>安装：sudo apt-get install couchdb</p>
<p>测试： curl -X GET <a target="_blank" rel="noopener" href="http://localhost:5984/">http://localhost:5984</a></p>
<p>环境路径（ork文件夹下）</p>
<p>source devel&#x2F;setup.bash</p>
<p>添加一个物体</p>
<p>lin@lin-Inspiron-7590:~&#x2F;library&#x2F;ork$ rosrun object_recognition_core object_add.py -n “coke” -d “A can of coke” –commit<br>Stored new object with id: 357b50964cd17d4502c92e919d0003c2</p>
<p>通过本地web界面查看物体记录</p>
<p><a target="_blank" rel="noopener" href="http://localhost:5984//_utils/database.html?object%5C_recognition/%5C_design/objects/%5C_view/by%5C_object%5C_name">http://localhost:5984/\_utils/database.html?object\_recognition/\_design/objects/\_view/by\_object\_name</a></p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/11/image.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/11/image-1024x207.png"></a></p>
<h2 id="添加MESH"><a href="#添加MESH" class="headerlink" title="添加MESH"></a>添加MESH</h2><p>install pip</p>
<p>sudo apt install python-pip</p>
<p>install couchapp</p>
<p>sudo pip install git+<a target="_blank" rel="noopener" href="https://github.com/couchapp/couchapp.git">https://github.com/couchapp/couchapp.git</a></p>
<p>Add mesh, and push the mesh to the database. ID改成Couchdb数据库里的id。</p>
<p>rosrun object_recognition_core mesh_add.py 357b50964cd17d4502c92e919d0003c2 src&#x2F;ork_tutorials&#x2F;data&#x2F;coke.stl –commit<br>rosrun object_recognition_core push.sh</p>
<p>这里要commit两次才能显示模型，不知为何。</p>
<p>Check the mesh in local web interface</p>
<p><a target="_blank" rel="noopener" href="http://localhost:5984/or/_web/_ui//_design/viewer/index.html">http://localhost:5984/or\_web\_ui/\_design/viewer/index.html</a></p>
<p>Lets Train the Model!</p>
<p>rosrun object_recognition_core training -c `rospack find object_recognition_linemod`&#x2F;conf&#x2F;training.ork</p>
<p>rosrun object_recognition_core training -c <code>rospack find object_recognition_linemod</code>&#x2F;conf&#x2F;training.ork</p>
<h2 id="Realsense"><a href="#Realsense" class="headerlink" title="Realsense"></a>Realsense</h2><p>install realsense</p>
<p>sudo apt-get install ros-kinetic-realsense2-camera</p>
<p>Launch the realsense (D435i)</p>
<p>roslaunch realsense2_camera rs_camera.launch</p>
<p><strong>BUG:Device 1&#x2F;1 failed with exception: failed to set power state</strong></p>
<p>Install the realsense SDK</p>
<p>sudo apt-key adv –keyserver keyserver.ubuntu.com –recv-key F6E65AC044F831AC80A06380C8B3A55A6F3EFCDE  sudo apt-key adv –keyserver hkp:&#x2F;&#x2F;keyserver.ubuntu.com:80 –recv-key F6E65AC044F831AC80A06380C8B3A55A6F3EFCDE<br>sudo add-apt-repository “deb <a target="_blank" rel="noopener" href="https://librealsense.intel.com/Debian/apt-repo">https://librealsense.intel.com/Debian/apt-repo</a> $(lsb_release -cs) main” -u<br>sudo apt-get install librealsense2-dkms<br>sudo apt-get install librealsense2-utils</p>
<p>Try the realsense</p>
<p>realsense-viewer</p>
<p>Try run again</p>
<p>[ INFO] [1667358059.365199853]: RealSense Node Is Up!</p>
<h2 id="detect"><a href="#detect" class="headerlink" title="detect"></a>detect</h2><p>Get your self a coda can</p>
<p>Detect</p>
<p>rosrun object_recognition_core detection -c  `rospack find object_recognition_linemod`&#x2F;conf&#x2F;detection.ros.ork</p>
<p>检查一下detector订阅的话题：</p>
<h2 id="lin-lin-Inspiron-7590-rosnode-info-object-recognition-server"><a href="#lin-lin-Inspiron-7590-rosnode-info-object-recognition-server" class="headerlink" title="lin@lin-Inspiron-7590:~$ rosnode info &#x2F;object_recognition_server "></a>lin@lin-Inspiron-7590:~$ rosnode info &#x2F;object_recognition_server </h2><p>Node [&#x2F;object_recognition_server]<br>Publications:<br> * &#x2F;rosout [rosgraph_msgs&#x2F;Log]</p>
<p>Subscriptions:<br> * &#x2F;camera&#x2F;depth_registered&#x2F;camera_info [unknown type]<br> * &#x2F;camera&#x2F;depth_registered&#x2F;image_raw [unknown type]<br> * &#x2F;camera&#x2F;rgb&#x2F;camera_info [unknown type]<br> * &#x2F;camera&#x2F;rgb&#x2F;image_rect_color [unknown type]</p>
<p>Services:<br> * &#x2F;object_recognition_server&#x2F;get_loggers<br> * &#x2F;object_recognition_server&#x2F;set_logger_level</p>
<p>contacting node <a target="_blank" rel="noopener" href="http://lin-inspiron-7590:34323/">http://lin-Inspiron-7590:34323/</a> …<br>Pid: 2156<br>Connections:<br> * topic: &#x2F;rosout<br>    * to: &#x2F;rosout<br>    * direction: outbound<br>    * transport: TCPROS</p>
<p>要和realsense的话题做一下映射</p>
<p>gedit `rospack find object_recognition_linemod`&#x2F;conf&#x2F;detection.ros.ork</p>
<p>source1:<br>  type: RosKinect<br>  module: ‘object_recognition_ros.io’<br>  parameters:<br>    rgb_frame_id: ‘camera_color_frame’<br>    rgb_image_topic: ‘&#x2F;camera&#x2F;color&#x2F;image_raw’<br>    rgb_camera_info: ‘&#x2F;camera&#x2F;color&#x2F;camera_info’<br>    depth_frame_id: ‘camera_depth_frame’<br>    depth_image_topic: ‘&#x2F;camera&#x2F;depth&#x2F;image_rect_raw’<br>    depth_camera_info: ‘&#x2F;camera&#x2F;depth&#x2F;camera_info’</p>
<p>BUG &#x2F;tmp&#x2F;binarydeb&#x2F;ros-kinetic-opencv3-3.3.1&#x2F;modules&#x2F;core&#x2F;src&#x2F;matrix.cpp:492: error: (-215) 0 &lt;&#x3D; _rowRange.start &amp;&amp; _rowRange.start &lt;&#x3D; _rowRange.end &amp;&amp; _rowRange.end &lt;&#x3D; m.rows in function Mat</p>
<p>这是因为realsense的rgb和depth分辨率不一样。</p>
<p>[ INFO] [1667365057.463705872]: depth stream is enabled - width: 848, height: 480, fps: 30, Format: Z16<br>[ INFO] [1667365057.467543566]: color stream is enabled - width: 1280, height: 720, fps: 30, Format: RGB8</p>
<p><code>roslaunch realsense2_camera rs_camera.launch align_depth:=true depth_width:=640 depth_height:=480 depth_fps:=30 color_width:=640 color_height:=480 color_fps:=30</code></p>
<p>BUG Rviz中找不到ORKobject</p>
<p>运行前source ORK的workspace</p>
<p>ORKLinemod不能训练有大空洞的模型。或者说，用一个框把模型包络起来，这个框的中间不能有很多背景图像。</p>
<p>使用自己的mesh时会有各种各样奇怪的bug。这个库已经没有人维护了，不建议使用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2022/10/30/ubuntu20-04%E5%AE%89%E8%A3%85%E5%A4%9A%E4%B8%AAcuda/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/30/ubuntu20-04%E5%AE%89%E8%A3%85%E5%A4%9A%E4%B8%AAcuda/" class="post-title-link" itemprop="url">Ubuntu20.04安装多个Cuda</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-10-30 11:33:08" itemprop="dateCreated datePublished" datetime="2022-10-30T11:33:08+08:00">2022-10-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E8%B4%B4/" itemprop="url" rel="index"><span itemprop="name">技术贴</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装NVIDIA驱动"><a href="#安装NVIDIA驱动" class="headerlink" title="安装NVIDIA驱动"></a>安装NVIDIA驱动</h2><p>首先，安装适当版本的nvidia driver。可以在系统自带的Driver manager中选择驱动。安装完成后，输入nvidia-smi查看支持的cuda版本。</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-17.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-17-1024x479.png"></a></p>
<p>右上方显示CUDA Version为11.4，意味着最高支持11.4的CUDA。</p>
<h2 id="安装适合版本的CUDA"><a href="#安装适合版本的CUDA" class="headerlink" title="安装适合版本的CUDA"></a>安装适合版本的CUDA</h2><p>如果安装的是和smi右上角前缀相同的CUDA，意味着这是直接适配系统的大版本。从<a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-downloads%E5%AF%BB%E6%89%BE%E5%AF%B9%E5%BA%94%E7%89%88%E6%9C%AC%E7%9A%84CUDA%EF%BC%8C%E9%80%89%E6%8B%A9%E7%9B%B8%E5%BA%94%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%90%8E%EF%BC%8C%E4%B8%8B%E8%BD%BDrunfile%E3%80%82%E8%BF%90%E8%A1%8Crunfile%EF%BC%8C%E4%BC%9A%E8%AF%A2%E9%97%AE%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E9%A9%B1%E5%8A%A8%EF%BC%8C%E9%80%89%E6%8B%A9%E5%90%A6%EF%BC%8C%E5%85%B6%E4%BB%96%E9%80%89%E6%8B%A9%E6%98%AF%E5%8D%B3%E5%8F%AF%E3%80%82">https://developer.nvidia.com/cuda-downloads寻找对应版本的CUDA，选择相应的操作系统后，下载runfile。运行runfile，会询问是否安装驱动，选择否，其他选择是即可。</a></p>
<h2 id="安装低版本CUDA"><a href="#安装低版本CUDA" class="headerlink" title="安装低版本CUDA"></a>安装低版本CUDA</h2><h3 id="安装底版本g-gcc"><a href="#安装底版本g-gcc" class="headerlink" title="安装底版本g++ gcc"></a>安装底版本g++ gcc</h3><p>安装底版本CUDA前，需要安装对应版本的gcc和g++。对应版本的gcc和g++在对应版本的Ubuntu的apt仓库中维护，所以安装之前需要加入这些仓库。</p>
<p>CUDA9对应了Ubuntu16.04，CUDA10对应了Ubuntu18.04.</p>
<p>以CUDA9为例，需要加入Ubuntu16.04的仓库：</p>
<p>deb <a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/ubuntu/">https://mirrors.aliyun.com/ubuntu/</a> xenial main<br>deb-src <a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/ubuntu/">https://mirrors.aliyun.com/ubuntu/</a> xenial main</p>
<p>deb <a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/ubuntu/">https://mirrors.aliyun.com/ubuntu/</a> xenial universe<br>deb-src <a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/ubuntu/">https://mirrors.aliyun.com/ubuntu/</a> xenial universe</p>
<p>apt update后，可以通过apt install gcc-5 g++-5安装。</p>
<h3 id="切换g-和gcc"><a href="#切换g-和gcc" class="headerlink" title="切换g++和gcc"></a>切换g++和gcc</h3><p>首先将原有的和刚安装的g++和gcc设置为可切换模式。参数为优先级（可自己设定），不是版本号：</p>
<p>sudo update-alternatives –install &#x2F;usr&#x2F;bin&#x2F;gcc gcc &#x2F;usr&#x2F;bin&#x2F;gcc-5 5<br>sudo update-alternatives –install &#x2F;usr&#x2F;bin&#x2F;g++ g++ &#x2F;usr&#x2F;bin&#x2F;g++-5 5<br>sudo update-alternatives –install &#x2F;usr&#x2F;bin&#x2F;gcc gcc &#x2F;usr&#x2F;bin&#x2F;gcc-10 10<br>sudo update-alternatives –install &#x2F;usr&#x2F;bin&#x2F;g++ g++ &#x2F;usr&#x2F;bin&#x2F;g++-10 10</p>
<p>然后用以下命令选择切换：</p>
<p>sudo update-alternatives –config gcc<br>sudo update-alternatives –config g++</p>
<h3 id="安装底版本CUDA"><a href="#安装底版本CUDA" class="headerlink" title="安装底版本CUDA"></a>安装底版本CUDA</h3><p>过程和当前版本CUDA安装方式相同。</p>
<h2 id="切换CUDA版本"><a href="#切换CUDA版本" class="headerlink" title="切换CUDA版本"></a>切换CUDA版本</h2><p>在&#x2F;usr&#x2F;local目录下，可以看到多个CUDA版本：</p>
<p>(base) lin@lin-Inspiron-7590:&#x2F;usr&#x2F;local$ ls<br>bin  cuda  cuda-11.4  cuda-9.0  etc  games  include  lib  man  sbin  share  src</p>
<p>让系统找到cuda，或者说将cuda的路径写入系统变量的方式有两种。一种是，切换cuda版本时，修改系统变量里cuda的路径。还有一种是，将系统变量里的cuda路径指向一个软连接，切换时修改软连接即可。</p>
<p>上面的cuda文件夹就是一个软连接，指向你想使用的cuda版本。如果没有cuda文件夹，可以自己创建一个。切换时，这样操作：</p>
<p>sudo rm -rf cuda<br>sudo ln -s &#x2F;usr&#x2F;local&#x2F;cuda9.0 &#x2F;usr&#x2F;local&#x2F;cuda</p>
<p>然后，在.bashrc中写入系统变量：</p>
<p>export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda&#x2F;bin${PATH:+:${PATH}}<br>export LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda&#x2F;lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}</p>
<p>这样，每次切换cuda的时候修改软连接即可。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2022/10/12/%E6%9C%80%E5%A4%A7%E6%9D%83%E9%87%8D%E4%BA%8C%E5%88%86%E5%9B%BE%E5%8C%B9%E9%85%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/12/%E6%9C%80%E5%A4%A7%E6%9D%83%E9%87%8D%E4%BA%8C%E5%88%86%E5%9B%BE%E5%8C%B9%E9%85%8D/" class="post-title-link" itemprop="url">最大权重二分图匹配</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-10-12 11:40:13" itemprop="dateCreated datePublished" datetime="2022-10-12T11:40:13+08:00">2022-10-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E8%B4%B4/" itemprop="url" rel="index"><span itemprop="name">技术贴</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=t9oESCbZvFw">https://www.youtube.com/watch?v=t9oESCbZvFw</a></p>
<p>这老哥讲的很好，但是视频声音比较小。结合<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15127509/4789817#:~:text=%E5%8C%88%E7%89%99%E5%88%A9%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95%20%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95,%28Hungary%20Algorithm%29%E6%98%AF%E7%94%B1Edmonds%E5%9C%A81965%E5%B9%B4%E6%8F%90%E5%87%BA%E7%9A%84%EF%BC%8C%E6%98%AF%E6%B1%82%E8%A7%A3%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D%E7%9A%84%E7%BB%8F%E5%85%B8%E7%AE%97%E6%B3%95%EF%BC%8C%E7%AE%97%E6%B3%95%E7%9A%84%E6%A0%B8%E5%BF%83%E5%B0%B1%E6%98%AF%E6%A0%B9%E6%8D%AE%E4%B8%80%E4%B8%AA%E5%88%9D%E5%A7%8B%E5%8C%B9%E9%85%8D%E4%B8%8D%E5%81%9C%E7%9A%84%E6%89%BE%E5%A2%9E%E5%B9%BF%E8%B7%AF%EF%BC%8C%E7%9B%B4%E5%88%B0%E6%B2%A1%E6%9C%89%E5%A2%9E%E5%B9%BF%E8%B7%AF%E4%B8%BA%E6%AD%A2%E3%80%82">这个博客</a>，可以更好地理解KM算法。</p>
<p>网上的最大权重二分图匹配大多晦涩难懂，很不适合我这样不太聪明的人，所以在这里记录一下最大权重二分图匹配的推演。</p>
<p>对于分配问题我们知道有一个方法叫做匈牙利匹配。而最大权重二分图匹配使用的方法叫做Kuhn-Munkres Algorithm，在最初提出的时候，使用矩阵的方式求解，后来发现可以基于匈牙利匹配简化求解过程（所以有的时候也可以用匈牙利算法指代最大权重二分图的解决方法）。匈牙利匹配理解起来很简单，但是编程实现很复杂；KM法理解起来非常困难，但是编程实现反而没有那么复杂（但也不简单）。</p>
<h2 id="二分图"><a href="#二分图" class="headerlink" title="二分图"></a>二分图</h2><p>二分图指一类特殊的图，它的顶点可以分为两类，一类之间互不相连，如下图所示。左边的点归为X集合，右边归为Y集合。</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-1.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-1.png"></a></p>
<h2 id="二分图最大匹配"><a href="#二分图最大匹配" class="headerlink" title="二分图最大匹配"></a>二分图最大匹配</h2><p>为了理解KM法，首先要了解二分图中最大匹配的方法——匈牙利匹配。这是在无权重的二分图上进行匹配的方法，目的是得到最多的匹配对。</p>
<p>方法是找增广路径，增广路径的特点是终点和起点都是未匹配的顶点，一个顶点属于X，另一个属于Y，并且依次经过依次经过未匹配边－匹配边－非匹配边－匹配边－未匹配边……那么不管中间路径是怎么样的，这条路径有以下特性：</p>
<ol>
<li>肯定由奇数条路径组成</li>
<li>含有未匹配顶点的路径肯定比两端均为匹配顶点的路径数量多1</li>
</ol>
<p>那么，把这条路径里原来的匹配边变成非匹配边，非匹配边变成匹配边，就会发现匹配对比原来多了一个。所以只要二分图中不存在增广路径了，就达到了最大匹配。具体实现运用到dfs（递归）加遍历。</p>
<h2 id="二分图最大权重匹配"><a href="#二分图最大权重匹配" class="headerlink" title="二分图最大权重匹配"></a>二分图最大权重匹配</h2><p>考虑下面这样一个二分图，不同之处在于，现在的edge是有权重的，目标是找到一个匹配使得匹配边的权重之和最大。</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-2.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-2.png"></a></p>
<p>事实上，这个图可以通过添加dummy edge的方式变成一个<strong>完全二分图</strong>：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-3.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-3.png"></a></p>
<p>我们用一个现实场景来表示这个图。X是农场主所拥有的农场，Y是市场，边的权重代表了从农场将作物卖到市场的收入。比如，从x1农场卖作物到y1可以得到6元收入。那么问题变为，在农场和市场之间只能一对一的情况下，农行主怎么卖作物最挣钱。</p>
<p>另一方面，政府希望集中收购这批粮食，那么政府需要给农场和市场分别一定的补助，好让农场愿意把作物交给政府。有意思的是，我们得到了这个问题的对偶，政府怎么发放补助才能使得补助之和最少。一个简单的起始点是，给每个农场他们可能的最大收入，如下：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-4.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-4.png"></a></p>
<p>这样一来，农场一定愿意将作物卖给政府。但是，这显然不是最佳的补助方法。我们首先定义，政府的补助数额是关于顶点的函数，又叫顶标。这里要引入一个概念：Equal Subgraph，相等子图。他的定义是，保留原图的所有顶点，但仅保留权重等于连接的顶标之和的边。在这个定义下，上图的子图是：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-5.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-5.png"></a></p>
<p>可以证明，当相等子图有完美匹配的时候，原图是一个最大权重匹配。这是因为，当相等子图有完美匹配的时候，（切换到现实模式），按照相等子图的匹配，政府给市场和农场的补助就等于出售农产品的总价格。之后可以看到，政府给的补助是逐渐下压的，因此没有被纳入相等子图的出售方法，获利一定低于政府的补助。（比如上图的0）因此，当相等子图有完美匹配的时候，用任何一条不在相等子图里的边替换完美匹配边，都会导致更低的出售价格。</p>
<p>但是，现在的相等子图并没有完美匹配。为什么？从现实来讲，政府给的钱太多了，还有下压的空间。那么问题就在于，怎么下压补贴。首先，在相等子图上我们至少可以用匈牙利匹配找到一个最大匹配，有可能是这样的：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-7.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-7.png"></a></p>
<p>此时，农场1卖到市场1，农场2卖到市场2。可以发现，农场3无法匹配。这是因为，从他出发无法找到一条新的增广路径，只能找到一条交替路，也就是农场3——市场2——农场2.将这种交替路上的农场归为R集，市场归为T集，那么这个相等子图是这样的，蓝色代表交替路：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-11.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-11.png"></a></p>
<p>接下来，政府想一步步压低补贴，那么可以最先考虑的是，压低一些补助就可以又阻断农场主出售货物的那条路子。具体而言，计算每条权重边和补助的差值。很容易就能得到，从农场2出售到市场1，收入是2，而此时补助之和是3，差价是1.于是政府就压低对农场2的补助到2——但是，又不能影响到原来的相等子图，所以，可以给市场2增加补助1. 进一步地，还可以给农场3的补助也降1.从更为严谨的角度来说，改变顶标的策略是这样的：</p>
<ol>
<li>首先，找到最大匹配中未匹配的顶点。由于已经是最大匹配，从该顶点出发，只能找到一条交替路而不是增广路。将X中在交替路上的顶点记为R集，Y中在交替路上的顶点记为T集，最小差价记为d。</li>
<li>令R中的顶标减少d，令T中的顶标增加d</li>
</ol>
<p>实际上就是这样：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-12.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-12.png"></a></p>
<p>这样相等子图里多了一条边，此时，再用匈牙利进行匹配，发现还是不行。交替路在图中已经标出。</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-13.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-13-1024x594.png"></a></p>
<p>说明还有压价的空间。x3，y2，x2，y1，x1构成了一条交替路（黑红黑红）：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-14.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-14.png"></a></p>
<p>相等子图中新增了一条绿色的相等路径。此时，用匈牙利匹配可以得到完美匹配了：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-15.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-15.png"></a></p>
<p>最终，最大权重匹配就是4+2+3+5+0+0&#x3D;14.</p>
<h2 id="其他问题的转化"><a href="#其他问题的转化" class="headerlink" title="其他问题的转化"></a>其他问题的转化</h2><h3 id="最小匹配"><a href="#最小匹配" class="headerlink" title="最小匹配"></a>最小匹配</h3><p>如果求最小匹配该怎么做?很简单，找到当前最大的权重，然后用这个权重减去所有其他路径的权重作为新权重，就可以将最小匹配转化为最大匹配了。</p>
<h3 id="非对称、非完全二分图"><a href="#非对称、非完全二分图" class="headerlink" title="非对称、非完全二分图"></a>非对称、非完全二分图</h3><p>在前面我们可以看到对于非完全的对称二分图，可以使用dummy edge补全。对于非对称的二分图，也可以使用dummy vertices补全。如下图：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/10/image-16.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/10/image-16-1024x434.png"></a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2022/09/29/%E4%B8%89%E7%BB%B4%E7%A9%BA%E9%97%B4%E4%BD%8D%E5%A7%BF%E6%8F%8F%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/09/29/%E4%B8%89%E7%BB%B4%E7%A9%BA%E9%97%B4%E4%BD%8D%E5%A7%BF%E6%8F%8F%E8%BF%B0/" class="post-title-link" itemprop="url">三维空间位姿描述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-29 13:07:53" itemprop="dateCreated datePublished" datetime="2022-09-29T13:07:53+08:00">2022-09-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>玩机器人就像开车，你可以不知道发动机原理，可以不知道汽车的性能参数，但是不能不知道东南西北，不然连去哪里都不知道。机器人也是一样，可以不知道机器人的动力特性，可以不知道PID的具体参数，但是不能不知道三维空间位姿描述。但是三位空间位姿描述是比较复杂的，从自身经验出发，我们对xyz上的平移深有体会，对绕Z轴的转向也是身体力行，但是在X、Y轴上的旋转却缺乏生活经验（可能只有上床睡觉、做仰卧起坐的时候有），所以三维空间中的旋转很容易让人迷糊。</p>
<p>欧拉旋转定理指出，任何两个独立的正交坐标系都可以通过不超过三次的相对于坐标系轴的旋转变换而来，但是不能连续绕同一个坐标轴旋转两次。换句话说，任何一个坐标系中的位姿都可以通过三个旋转角度来表示。三维空间中的旋转有一个特性是，旋转的顺序不同，最终结果也不同，因此有必要有一个约定俗成的顺序来表示位姿。</p>
<h2 id="ZYZ欧拉式"><a href="#ZYZ欧拉式" class="headerlink" title="ZYZ欧拉式"></a>ZYZ欧拉式</h2><p>欧拉式的特性是，三次旋转中有两次是绕同一轴进行旋转，而ZYZ是在航空和机械动力学中最常使用的欧拉角。表示为：</p>
<p>R&#x3D;R_z(\phi)R_y(\theta)R_z(\psi)</p>
<h2 id="RPY-XYZ卡尔丹式"><a href="#RPY-XYZ卡尔丹式" class="headerlink" title="RPY&#x2F;XYZ卡尔丹式"></a>RPY&#x2F;XYZ卡尔丹式</h2><p>RPY是机器人中最常使用的角度表示法，实际上是XYZ卡尔丹式的角度表示法。但是实践中似乎欧拉式和卡尔丹式表示法统称为欧拉角。RPY表示为：</p>
<p> R&#x3D;R_x(\theta_r)R_y(\theta_p)R_z(\theta_y)</p>
<p>RPY表示法的一个特点是，一般来说这三轴是有实际物理意义的。RPY常常用来描述车辆和飞机的姿态，此时R为横滚角，围绕载具前进的方向；P为偏航角，Y为偏航角。一般来说，载具前进的方向定义为Z，但是有一些定义也将其与X轴交换。不管怎么说，Y轴的定义一般都是相同的。因此，实际上RPY可能指XYZ式的欧拉角，也可能指ZYX的欧拉角。上面的公式意味着，先绕Z旋转，再绕Y旋转，再绕X旋转，实际上是XYZ式的欧拉角。注意这里旋转顺序是和公式中xyz的从左到右顺序相反的。</p>
<h3 id="ROS中的RPY：XYZ欧拉角"><a href="#ROS中的RPY：XYZ欧拉角" class="headerlink" title="ROS中的RPY：XYZ欧拉角"></a>ROS中的RPY：XYZ欧拉角</h3><p>ROS中的static_transform_publisher可以发布静态的transform，RPY是其中一种默认方式。参数如下：</p>
<p>static_transform_publisher x y z <strong>yaw pitch roll</strong> frame_id child_frame_id period_in_ms</p>
<p>进一步的，ROS wiki中解释这里的RPY指：</p>
<p>yaw is rotation about Z, pitch is rotation about Y, and roll is rotation about X</p>
<p>这里的定义和上面的公式是相同的，为了判断它是否遵循Z-&gt;Y-&gt;X的旋转顺序，也就是是否是一个XYZ的欧拉角，使用下面这个样例来测试。</p>
<p>首先，确认ROS中TF的表示形式，红色轴为X，蓝色为Z，绿色为Y。</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/09/%E5%9B%BE%E7%89%87-1.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/09/%E5%9B%BE%E7%89%87-1.png"></a></p>
<p>使用以下命令，创建一个新的TF：</p>
<p>rosrun tf static_transform_publisher 1 1 1 1.5708 1.5708 0 map base_link 100</p>
<p>结果如图所示：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/09/%E5%9B%BE%E7%89%87-2.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/09/%E5%9B%BE%E7%89%87-2.png"></a></p>
<p>经过简单的判断，可以发现，**ROS中的transform遵循的是yaw、pitch、roll依次的旋转顺序，实际上顺序为Z-&gt;Y-&gt;X。**ROS中使用的是XYZ欧拉角来表达角度姿态。</p>
<h2 id="四元数"><a href="#四元数" class="headerlink" title="四元数"></a>四元数</h2><blockquote>
<p>四元数法出自于汉密尔顿出色的研究工作，然而它虽然精妙绝伦，但对那些没有接触过他的人来说却是纯粹的恶魔，包括克拉克·麦克斯韦。</p>
<p>开尔文勋爵，1892</p>
</blockquote>
<p>四元数是复数的一种拓展，或者叫超复数。顾名思义，它有四个元：</p>
<p>q&#x3D;s+v_1i+v_2j+v_3k</p>
<p>i,j,k都是虚部。四元数也可以表示为：</p>
<p>q&#x3D;s[v_1,v_2,v_3]</p>
<p>四元数描述坐标系旋转的方法是，将坐标系视为绕一个单位向量n旋转theta角。单位向量和theta与四元数的关系是：</p>
<p>s&#x3D;cos\frac{\theta}{2},~ v&#x3D;(sin\frac{\theta}{2})n</p>
<p>在ROS中，四元数用w,x,y,z的形式表示，分别对应s,v1,v2,v3。</p>
<p>上面仅仅介绍了什么是四元数和他怎么表示，四元数的最大作用是显著减少坐标变换的计算量，在计算机图形、动画、游戏中应用很广泛。使用四元数可以方便地计算两个姿态之间地插值。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2022/09/29/%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%89%8B%E7%9C%BC%E6%A0%87%E5%AE%9A%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%93%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/09/29/%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%89%8B%E7%9C%BC%E6%A0%87%E5%AE%9A%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%93%8D/" class="post-title-link" itemprop="url">机器人手眼标定原理与实操</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-29 10:22:05" itemprop="dateCreated datePublished" datetime="2022-09-29T10:22:05+08:00">2022-09-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="手眼标定原理"><a href="#手眼标定原理" class="headerlink" title="手眼标定原理"></a>手眼标定原理</h2><p>手眼标定分为Eye-to-hand和Eye-in-hand两种，前者相机固定在机械臂以外的地方，后者相机一般固定在机械臂的手掌部位。</p>
<p>关于标定的原理，这篇文章讲的很清楚了：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/103749589">https://zhuanlan.zhihu.com/p/103749589</a>。以Eye-in-Hand为例，有下图：</p>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/09/image.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/09/image.png"></a></p>
<p>固定一个标定板，让机械臂运动到两个不同的位置，进行标定。我们知道，相机到末端执行器的变换是固定的，所以根据变换法有（对照图中的各物体首字母）：</p>
<p>T_{E2}^{E1}T_{E1}^{C2}&#x3D;T_{E1}^{C2}T_{C2}^{C1}\\<br>AX&#x3D;XB</p>
<p>这是一个方程，只有一个未知数X。如果能得到AB，那么X就可以解出。对于A来说，机器人末端姿态的改变显然是可以得到的，很多商业机器人都提供直接获得末端姿态的方法。对于B来说，就有一点难度了，这就是为什么要标定板，因为B实际上可以写成：</p>
<p>T_{C2}^{C1}&#x3D;T^{B}_{C2}(T^{B}_{C1})^{-1}</p>
<p>那么只要知道相机到标定板的位姿变化就行了，这个在数值上等价于标定板在相机坐标系中的位姿。</p>
<h2 id="Acuro标定板"><a href="#Acuro标定板" class="headerlink" title="Acuro标定板"></a>Acuro标定板</h2><p>Acuro是一个大小已知的标志，在这个网站生成：<a target="_blank" rel="noopener" href="https://chev.me/arucogen/">https://chev.me/arucogen/</a></p>
<p>一般的，如果已知摄像头参数的话，根据Acuro在画面中的大小，位置，就可以推算出其位姿。比如，Intel的Realsense就提前标定好了参数。如果是未标定参数的摄像头，则需要先标定参数。</p>
<p>使用Acuro进行多次标定，就可以减少误差值，直到得到一个相对精确的X。</p>
<h2 id="实操：在ROS中进行手眼标定"><a href="#实操：在ROS中进行手眼标定" class="headerlink" title="实操：在ROS中进行手眼标定"></a>实操：在ROS中进行手眼标定</h2><p>使用7自由度的Kinova Jaco2，Intel Realsense D435i进行Eye-on-hand标定。</p>
<p>标定工具包括：</p>
<ol>
<li>Ubuntu20.04</li>
<li>ROS Noetic</li>
<li>Kinova-ros</li>
<li>easy-hand-eye</li>
<li>realsense-ros</li>
<li>acuro-ros</li>
</ol>
<h3 id="程序流"><a href="#程序流" class="headerlink" title="程序流"></a>程序流</h3><ol>
<li>运行Realsense和Kinova，此时Kinova-driver提供机械臂末端相对于基底的坐标，Frame为end_effector；Realsense提供一个未知的相机坐标，Frame为&#x2F;camera_link。</li>
<li>运行aruco-ros，适用Realsense的彩色摄像头捕捉aruco标志，得到&#x2F;camera_link到&#x2F;camera_marker的transform</li>
<li>运行easy-hand-eye，负责基于多次标定的结果（15次左右）计算出X，得到最终结果。</li>
</ol>
<h3 id="运行文件"><a href="#运行文件" class="headerlink" title="运行文件"></a>运行文件</h3><h3 id="提示，以及可能遇到的错误"><a href="#提示，以及可能遇到的错误" class="headerlink" title="提示，以及可能遇到的错误"></a>提示，以及可能遇到的错误</h3><ol>
<li>在标定过程中，让机械臂的末端执行器尽可能大范围地转动，在其三个轴上都转90°以上。末端执行器的平移运动倒不必要的，不过也没有关系。</li>
<li><a target="_blank" rel="noopener" href="https://chev.me/arucogen/">https://chev.me/arucogen/</a>默认生成4x4字典的Aruco，但是aruco-ros用的是Original的。建议使用582号marker，据说这个检测率最高。</li>
</ol>
<p><a target="_blank" rel="noopener" href="http://www.lxshaw.com/wp-content/uploads/2022/09/%E5%9B%BE%E7%89%87.png"><img src="http://www.lxshaw.com/wp-content/uploads/2022/09/%E5%9B%BE%E7%89%87.png"></a></p>
<p>582号Marker</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2022/09/17/%E4%B8%8D%E8%A6%81%E7%9B%B4%E6%8E%A5%E5%AD%A6ros2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/09/17/%E4%B8%8D%E8%A6%81%E7%9B%B4%E6%8E%A5%E5%AD%A6ros2/" class="post-title-link" itemprop="url">不要直接学ROS2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-17 12:04:11" itemprop="dateCreated datePublished" datetime="2022-09-17T12:04:11+08:00">2022-09-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>不要直接学ROS2！我的一些肺腑之言。学ROS1，现有的材料可以在一年内让你踏入ROS门槛，然后再花几个月时间迁移到ROS2上。直接学ROS2，你得花半年时间自己摸索，等到用到实际项目上，已经猴年马月了。</p>
<p>电子产品买新不买旧，但是学习，除非是新的比旧的要好的太多，不然就还是什么资料多学什么，一般都是旧的资料多。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2022/09/16/wp-global-styles-pacify/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/09/16/wp-global-styles-pacify/" class="post-title-link" itemprop="url">Custom Styles</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-16 17:16:02" itemprop="dateCreated datePublished" datetime="2022-09-16T17:16:02+08:00">2022-09-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>{“version”: 2, “isGlobalStylesUserThemeJSON”: true }</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2022/09/09/wp-global-styles-twentysixteen/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/09/09/wp-global-styles-twentysixteen/" class="post-title-link" itemprop="url">Custom Styles</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-09 22:07:37" itemprop="dateCreated datePublished" datetime="2022-09-09T22:07:37+08:00">2022-09-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>{“version”: 2, “isGlobalStylesUserThemeJSON”: true }</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Xiao Lin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">分类</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/linxiaoshaw@foxmail.com" title="E-Mail → linxiaoshaw@foxmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xiao Lin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
