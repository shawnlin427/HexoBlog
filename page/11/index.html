<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wonderful-sea-04900b000.6.azurestaticapps.net","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Shawn Lin&#39;s Blog">
<meta property="og:url" content="https://wonderful-sea-04900b000.6.azurestaticapps.net/page/11/index.html">
<meta property="og:site_name" content="Shawn Lin&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Xiao Lin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/page/11/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Shawn Lin's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Shawn Lin's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/09/13/%E5%92%8Cdolly%E4%B8%80%E8%B5%B7%E6%8E%A2%E7%B4%A2ros2%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%90%AF%E5%8A%A8%E6%A8%A1%E6%8B%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/13/%E5%92%8Cdolly%E4%B8%80%E8%B5%B7%E6%8E%A2%E7%B4%A2ros2%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%90%AF%E5%8A%A8%E6%A8%A1%E6%8B%9F/" class="post-title-link" itemprop="url">和Dolly一起探索ROS2（一）：启动模拟</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-13 21:36:07" itemprop="dateCreated datePublished" datetime="2021-09-13T21:36:07+08:00">2021-09-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://www.theconstructsim.com/">https://www.theconstructsim.com/</a></p>
<p>我们使用the construct，这是一个学习ROS的很好平台，免去了配置平台的烦恼，还可以跨平台。登陆并注册，然后在My Project里点击新建一个Rosjects：</p>
<p><img src="http://www.lxshaw.com/wp-content/uploads/2021/09/image-2-1024x640.png"></p>
<p>启动后稍等一下，就能看到界面了，下面从左到右分别是bash、code、jupyter、gazebo、可视化工具（rviz2一类的），还有课程notebook，这里用不到。</p>
<p>首先查看一下当前路径：</p>
<p>user:~$ ls<br>ai_ws  catkin_ws  notebook_ws  ros2_ws  simulation_ws  webpage_ws</p>
<p>进入ros2_ws再看一眼：</p>
<p>user:<del>$ cd ros2_ws&#x2F;<br>user:</del>&#x2F;ros2_ws$ ls -l<br>total 16<br>drwxr-xr-x 2 user user 4096 Sep 13 12:26 build<br>drwxr-xr-x 2 user user 4096 Sep 13 12:26 install<br>drwxr-xr-x 5 user user 4096 Sep 13 12:26 log<br>drwxr-xr-x 2 user user 4096 Dec  7  2020 src</p>
<p>这就是ros2的文件架构了，先不管其他文件夹，进入src，git clone 多利：</p>
<p>user:<del>&#x2F;ros2_ws$ cd src<br>user:</del>&#x2F;ros2_ws&#x2F;src$ git clone <a target="_blank" rel="noopener" href="https://github.com/chapulina/dolly.git">https://github.com/chapulina/dolly.git</a></p>
<p>git clone之后自然是要编译了，在此之前首先source一下ros2 foxy。每开启一个新控制台都要source，或者把它写到bashrc里，否则就用不了ros2的功能。</p>
<p>user:<del>&#x2F;ros2_ws$ source &#x2F;opt&#x2F;ros&#x2F;foxy&#x2F;setup.bash<br>user:</del>&#x2F;ros2_ws$ colcon build –symlink-install –packages-ignore dolly_ignition</p>
<p>这里ignore了dolly_ignition这个包，因为这个包依赖ignition library，但是平台里默认没有安装。</p>
<p>编译成功后，打开code。下一步我们要做的是创建自己的ros2 package，这样能把ros2工作流走一遍。</p>
<p>user:~&#x2F;ros2_ws&#x2F;src$ ros2 pkg create my_package –build-type ament_cmake –dependencies rclcpp</p>
<p><img src="http://www.lxshaw.com/wp-content/uploads/2021/09/image-3.png"></p>
<p>实际上可以理解为创建了一个project，这个项目所有的模型啊运行脚本啊都在这里管理。下一步创建一个launch file，它是py格式的，也没有什么稀奇的，就是一个脚本文件。</p>
<p>首先要定义一个启动描述函数，它返回的就是启动描述。实际上launch file并不一定是为ros2服务的，可以将其看作是执行一系列命令的一个脚本。在my_package下创建一个launch文件夹，然后创建一个dolly.launch.py文件。</p>
<p>import os</p>
<p>from ament_index_python.packages import get_package_share_directory<br>from launch import LaunchDescription<br>from launch.actions import DeclareLaunchArgument<br>from launch.actions import IncludeLaunchDescription<br>from launch.launch_description_sources import PythonLaunchDescriptionSource</p>
<p>def generate_launch_description():</p>
<pre><code>pkg\_gazebo\_ros = get\_package\_share\_directory(&#39;gazebo\_ros&#39;)
pkg\_dolly\_gazebo = get\_package\_share\_directory(&#39;dolly\_gazebo&#39;)

# Gazebo launch
gazebo = IncludeLaunchDescription(
    PythonLaunchDescriptionSource(
        os.path.join(pkg\_gazebo\_ros, &#39;launch&#39;, &#39;gazebo.launch.py&#39;),
    )
)

return LaunchDescription(\[
    DeclareLaunchArgument(
      &#39;world&#39;,
      default\_value=\[os.path.join(pkg\_dolly\_gazebo, &#39;worlds&#39;, &#39;dolly\_empty.world&#39;), &#39;&#39;\],
      description=&#39;SDF world file&#39;),
    gazebo,
\])
</code></pre>
<p>实际上，这个脚本文件就做了三件事：找到gazebo_ros、dolly_gazebo这两个包的路径，启动gazebo，把dolly_empty.word作为参数传入gazebo launch，和gazebo dolly_empty.world效果其实是一样的。</p>
<p>之后还需要修改一下cmakelist，在最后一行前面加入这么一行：</p>
<p>install(DIRECTORY<br>  launch<br>  DESTINATION share&#x2F;${PROJECT_NAME}<br>)</p>
<p>修改之后退出来编译一下：</p>
<p>user:~&#x2F;ros2_ws$ colcon build –symlink-install –packages-select my_package</p>
<p>接下来就可以运行了：</p>
<p>user:~&#x2F;ros2_ws$ ros2 launch  my_package dolly.launch.py<br>[INFO] [launch]: All log files can be found below &#x2F;home&#x2F;user&#x2F;.ros&#x2F;log&#x2F;2021-09-13-13-20-07-318871-2_xterm-15456<br>[INFO] [launch]: Default logging verbosity is set to INFO<br>[INFO] [gzserver-1]: process started with pid [15458]<br>[INFO] [gzclient   -2]: process started with pid [15460]<br>[gzclient   -2] ++ ls &#x2F;usr&#x2F;bin&#x2F;gzclient-11.1.0<br>[gzclient   -2] + gzclient_path&#x3D;&#x2F;usr&#x2F;bin&#x2F;gzclient-11.1.0<br>[gzclient   -2] + DISPLAY&#x3D;:2<br>[gzclient   -2] + &#x2F;usr&#x2F;bin&#x2F;gzclient-11.1.0<br>[gzserver-1] [INFO] [1631539209.561754647] [dolly.diff_drive]: Wheel pair 1 separation set to [1.250000m]<br>[gzserver-1] [INFO] [1631539209.562577250] [dolly.diff_drive]: Wheel pair 1 diameter set to [0.300000m]<br>[gzserver-1] [INFO] [1631539209.564346299] [dolly.diff_drive]: Subscribed to [&#x2F;dolly&#x2F;cmd_vel]<br>[gzserver-1] [INFO] [1631539209.566206561] [dolly.diff_drive]: Advertise odometry on [&#x2F;dolly&#x2F;odom]<br>[gzserver-1] [INFO] [1631539209.568098315] [dolly.diff_drive]: Publishing odom transforms between [odom_demo] and [chassis]</p>
<p>这个时候gazebo实际已经开始运行了，点击下面的gazebo：</p>
<p><img src="http://www.lxshaw.com/wp-content/uploads/2021/09/image-4-1024x615.png"></p>
<p>这样，我们就用ROS2启动了一个仿真。真的是用ROS2启动的吗？实际上应该说是用python脚本启动的，但是在此过程中，我们用ROS2创建了一个ros package方便项目管理，修改了cmakelist并编译从而使得ros2 launch能够找到启动路径。不仅如此，我们还同时启动了gazebo_ros，这是一个topic映射工具，可以将gazebo的topic和ros的topic互相映射。</p>
<p>user:~&#x2F;ros2_ws$ ros2 topic pub &#x2F;dolly&#x2F;cmd_vel geometry_msgs&#x2F;msg&#x2F;Twist “ { linear: {x: 0.2}, angular: {z: 0.3} }”</p>
<p>小车就能赚起来了，输入命令的时候注意标点符号后面都要空格，不然会报错。也可以查看传感器数据：</p>
<p>user:~&#x2F;ros2_ws$ ros2 topic echo &#x2F;dolly&#x2F;laser_scan</p>
<p>那么这一章就到这里结束了，下一章来看如何在ros2中手动订阅话题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/09/05/blender%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E7%BC%96%E8%BE%91%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/05/blender%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E7%BC%96%E8%BE%91%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">Blender入门（二）：编辑模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-05 00:14:56" itemprop="dateCreated datePublished" datetime="2021-09-05T00:14:56+08:00">2021-09-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/Blender/" itemprop="url" rel="index"><span itemprop="name">Blender</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1，2，3"><a href="#1，2，3" class="headerlink" title="1，2，3"></a>1，2，3</h2><p>编辑模式下，选择1，2，3可以分别进入点、线、面选择模式</p>
<h2 id="E"><a href="#E" class="headerlink" title="E"></a>E</h2><p>从一个面拉出一个面，或者从一条线拉出一条线，很强大。如果E之后接S，可以闭合洞口之类的</p>
<h2 id="Ctrl-R"><a href="#Ctrl-R" class="headerlink" title="Ctrl+R"></a>Ctrl+R</h2><p>切分模型，可以几等分，或者随意分割</p>
<h2 id="Ctrl-B"><a href="#Ctrl-B" class="headerlink" title="Ctrl+B"></a>Ctrl+B</h2><p>倒角，选择一个面，然后拉伸，滚轮设置精细度</p>
<h2 id="细分模型"><a href="#细分模型" class="headerlink" title="细分模型"></a>细分模型</h2><p>把粗糙的线框模型细分为光滑曲面。</p>
<p><img src="http://www.lxshaw.com/wp-content/uploads/2021/09/image.png"></p>
<h2 id="L"><a href="#L" class="headerlink" title="L"></a>L</h2><p>选择和一个面相连的所有面</p>
<h2 id="按比例编辑"><a href="#按比例编辑" class="headerlink" title="按比例编辑"></a>按比例编辑</h2><p><img src="http://www.lxshaw.com/wp-content/uploads/2021/09/image-1.png"></p>
<p>拖动一个面时，可以产生更为平滑的变形效果（很搞笑）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/09/04/blender%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%B8%83%E5%B1%80%E4%B8%8E%E5%BF%AB%E6%8D%B7%E9%94%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/04/blender%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%B8%83%E5%B1%80%E4%B8%8E%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="post-title-link" itemprop="url">Blender入门（一）：布局与快捷键</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-04 16:07:31" itemprop="dateCreated datePublished" datetime="2021-09-04T16:07:31+08:00">2021-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/Blender/" itemprop="url" rel="index"><span itemprop="name">Blender</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="分屏"><a href="#分屏" class="headerlink" title="分屏"></a>分屏</h2><p><img src="http://www.lxshaw.com/wp-content/uploads/2021/09/%E5%9B%BE%E7%89%87-2-1024x592.png"></p>
<p>鼠标移动到“选项”按钮右上方，也就是当前界面右上角落，光标发生变化后，可以拖拽分屏。合并屏幕，也是将鼠标移动到相同位置，然后向需要被合并的界面移动。</p>
<h2 id="鼠标左键、右键"><a href="#鼠标左键、右键" class="headerlink" title="鼠标左键、右键"></a>鼠标左键、右键</h2><p><img src="http://www.lxshaw.com/wp-content/uploads/2021/09/%E5%9B%BE%E7%89%87-3-1024x867.png"></p>
<p>建议将键位映射改为上述。鼠标左键点击可以设置3D游标，也可以框选。右键选择物体，也可以移动。空格键位可以搜索命令。</p>
<h2 id="小键盘"><a href="#小键盘" class="headerlink" title="小键盘"></a>小键盘</h2><p>小键盘123456789可以调整视角。</p>
<h2 id="斜杠"><a href="#斜杠" class="headerlink" title="&#x2F;斜杠"></a>&#x2F;斜杠</h2><p>用于专注某一个模型。</p>
<h2 id="G"><a href="#G" class="headerlink" title="G"></a>G</h2><p>移动物体。</p>
<h2 id="R"><a href="#R" class="headerlink" title="R"></a>R</h2><p>旋转物体</p>
<h2 id="S"><a href="#S" class="headerlink" title="S"></a>S</h2><p>缩放物体</p>
<h2 id="X-Y-Z"><a href="#X-Y-Z" class="headerlink" title="X,Y,Z"></a>X,Y,Z</h2><p>在执行R\G\S操作时，使用XYZ可以制定操作在哪一条轴上进行。再按一次，可以从全局坐标转换到局部坐标。</p>
<h2 id="Shift-A"><a href="#Shift-A" class="headerlink" title="Shift+A"></a>Shift+A</h2><p>创建新物体。</p>
<h2 id="Shift-S"><a href="#Shift-S" class="headerlink" title="Shift+S"></a>Shift+S</h2><p>可以用于吸附游标到原点。</p>
<h2 id="Shift-D"><a href="#Shift-D" class="headerlink" title="Shift+D"></a>Shift+D</h2><p>复制物体。</p>
<h2 id="坐标系，吸附"><a href="#坐标系，吸附" class="headerlink" title="坐标系，吸附"></a>坐标系，吸附</h2><p><img src="http://www.lxshaw.com/wp-content/uploads/2021/09/%E5%9B%BE%E7%89%87-4.png"></p>
<h2 id="Z"><a href="#Z" class="headerlink" title="Z"></a>Z</h2><p>视图选项，可以查看线框、材质或者渲染视图。</p>
<h2 id="设置物体的质心（旋转中心）"><a href="#设置物体的质心（旋转中心）" class="headerlink" title="设置物体的质心（旋转中心）"></a>设置物体的质心（旋转中心）</h2><p><img src="http://www.lxshaw.com/wp-content/uploads/2021/09/%E5%9B%BE%E7%89%87-5.png"></p>
<p>点击物体，然后选择设置原点。</p>
<h2 id="Ctrl-J"><a href="#Ctrl-J" class="headerlink" title="Ctrl+J"></a>Ctrl+J</h2><p>聚合所有选中的物体。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/09/03/ignition%E6%8F%92%E4%BB%B6%EF%BC%9Aopenjoint/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/03/ignition%E6%8F%92%E4%BB%B6%EF%BC%9Aopenjoint/" class="post-title-link" itemprop="url">Ignition插件：OpenJoint</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-03 23:25:17" itemprop="dateCreated datePublished" datetime="2021-09-03T23:25:17+08:00">2021-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/Iginition/" itemprop="url" rel="index"><span itemprop="name">Iginition</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>OpenJoint是我自创的一个Ignition插件。他的功能是，在安装了插件的model中的指定link与其他物体碰撞时，生成一个fixed joint，链接物体。并在接受特定指令后（通过topic发布），删除该joint，释放物体。</p>
<p>github链接如下：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/0smile/OpenJoint">https://github.com/0smile/OpenJoint</a></p>
<p>通过写这个插件，也总结了一些写这种插件的心得：</p>
<ol>
<li>对仿真世界的操作，统一写在PreUpdate里；</li>
<li>创建话题、订阅话题，统一写在Configure里；</li>
<li>订阅topic的时候，需要绑定函数，函数的变量就是topic的消息类型。函数内容一般是赋值、改值。</li>
<li>EntityComponentManager，增加Entity、删除Entity、查找Entity的名称、父级、某个属性，都要靠它；</li>
<li>SDF中的标签可以用于Get里面的值。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/09/02/revit-blender-ignition-%E5%B7%A5%E4%BD%9C%E6%B5%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/02/revit-blender-ignition-%E5%B7%A5%E4%BD%9C%E6%B5%81/" class="post-title-link" itemprop="url">Revit-Blender-Ignition 工作流</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-02 12:28:34" itemprop="dateCreated datePublished" datetime="2021-09-02T12:28:34+08:00">2021-09-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/Iginition/" itemprop="url" rel="index"><span itemprop="name">Iginition</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/BIM/" itemprop="url" rel="index"><span itemprop="name">BIM</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bim/" itemprop="url" rel="index"><span itemprop="name">bim</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bim/IFC/" itemprop="url" rel="index"><span itemprop="name">IFC</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>下面这个工作流能够导出携带材质的Revit模型到Ignition中（应该如此）</p>
<p>环境与软件版本：</p>
<ol>
<li>IFC：随意</li>
<li>blender 2.93.4</li>
<li>IFCBlender：随意</li>
</ol>
<h2 id="Revit-IFC"><a href="#Revit-IFC" class="headerlink" title="Revit-&gt;IFC"></a>Revit-&gt;IFC</h2><p>从Revit中导出IFC，IFC会携带材质。</p>
<h2 id="IFC-Blender"><a href="#IFC-Blender" class="headerlink" title="IFC-&gt;Blender"></a>IFC-&gt;Blender</h2><p>将IFC导入到Blender中，需要一个IFCBlender插件，前往ifcopenshell网站下载：</p>
<p><a target="_blank" rel="noopener" href="http://ifcopenshell.org/ifcblender">http://ifcopenshell.org/ifcblender</a></p>
<p>下载好后，到Blender内启用并安装，就可以导入IFC模型了。</p>
<h2 id="IFC-DAE"><a href="#IFC-DAE" class="headerlink" title="IFC-&gt;DAE"></a>IFC-&gt;DAE</h2><p>这一步是为了调整文件的组织结构，IFC的组织结构是会划分楼层的，这使得下一步中无法识别。</p>
<p>要做到这一步，只需要导入IFC模型后（时间比较长），将当前模型导出为dae一次即可，然后再次读取dae文件。</p>
<h2 id="DAE-SDF"><a href="#DAE-SDF" class="headerlink" title="DAE-&gt;SDF"></a>DAE-&gt;SDF</h2><p>这一步需要Ignition提供的一个脚本：</p>
<p>import bpy<br>import os.path<br>from bpy_extras.io_utils import ImportHelper<br>from bpy.props import StringProperty, BoolProperty<br>from bpy.types import Operator</p>
<p>import xml.etree.ElementTree as ET<br>from xml.dom import minidom</p>
<h1 id="Target-blender-version-2-82"><a href="#Target-blender-version-2-82" class="headerlink" title="Target blender version: 2.82"></a>Target blender version: 2.82</h1><p>########################################################################################################################</p>
<h3 id="Exports-model-dae-of-the-scene-with-textures-its-corresponding-model-sdf-file-and-a-default-model-config-file"><a href="#Exports-model-dae-of-the-scene-with-textures-its-corresponding-model-sdf-file-and-a-default-model-config-file" class="headerlink" title="Exports model.dae of the scene with textures, its corresponding model.sdf file, and a default model.config file"></a>Exports model.dae of the scene with textures, its corresponding model.sdf file, and a default model.config file</h3><p>########################################################################################################################<br>def export_sdf(prefix_path):</p>
<pre><code>dae\_filename = &#39;model.dae&#39;
sdf\_filename = &#39;model.sdf&#39;
model\_config\_filename = &#39;model.config&#39;
lightmap\_filename = &#39;LightmapBaked.png&#39;
model\_name = &#39;my\_model&#39;
meshes\_folder\_prefix = &#39;meshes/&#39;

# Exports the dae file and its associated textures
bpy.ops.wm.collada\_export(filepath=prefix\_path+meshes\_folder\_prefix+dae\_filename, check\_existing=False, filter\_blender=False, filter\_image=False, filter\_movie=False, filter\_python=False, filter\_font=False, filter\_sound=False, filter\_text=False, filter\_btx=False, filter\_collada=True, filter\_folder=True, filemode=8)

# objects = bpy.context.selected\_objects
objects = bpy.context.selectable\_objects
mesh\_objects = \[ o for o in objects if o.type == &#39;MESH&#39; \]
light\_objects = \[ o for o in objects if o.type == &#39;LIGHT&#39; \]

#############################################
#### export sdf xml based off the scene #####
#############################################
sdf = ET.Element(&#39;sdf&#39;, attrib=&#123;&#39;version&#39;:&#39;1.8&#39;&#125;)

# 1 model and 1 link
model = ET.SubElement(sdf, &quot;model&quot;, attrib=&#123;&quot;name&quot;:&quot;test&quot;&#125;)
static = ET.SubElement(sdf, &quot;static&quot;)
static.text = &quot;true&quot;
link = ET.SubElement(model, &quot;link&quot;, attrib=&#123;&quot;name&quot;:&quot;testlink&quot;&#125;)
# for each geometry in geometry library add a &lt;visual&gt; tag
for o in mesh\_objects:
    visual = ET.SubElement(link, &quot;visual&quot;, attrib=&#123;&quot;name&quot;:o.name&#125;)

    geometry = ET.SubElement(visual, &quot;geometry&quot;)
    mesh = ET.SubElement(geometry, &quot;mesh&quot;)
    uri = ET.SubElement(mesh, &quot;uri&quot;)
    uri.text = meshes\_folder\_prefix+dae\_filename
    submesh = ET.SubElement(mesh, &quot;submesh&quot;)
    submesh\_name = ET.SubElement(submesh, &quot;name&quot;)
    submesh\_name.text = o.name
    
    # grab diffuse/albedo map
    diffuse\_map = &quot;&quot;    
    nodes = o.active\_material.node\_tree.nodes
    principled = next(n for n in nodes if n.type == &#39;BSDF\_PRINCIPLED&#39;)
    if principled is not None:
        base\_color = principled.inputs\[&#39;Base Color&#39;\] #Or principled.inputs\[0\]
        value = base\_color.default\_value
        if len(base\_color.links):
            link\_node = base\_color.links\[0\].from\_node
            diffuse\_map = link\_node.image.name
    
    # setup diffuse/specular color
    material = ET.SubElement(visual, &quot;material&quot;)
    diffuse = ET.SubElement(material, &quot;diffuse&quot;)
    diffuse.text = &quot;1.0 1.0 1.0 1.0&quot;
    specular = ET.SubElement(material, &quot;specular&quot;)
    specular.text = &quot;0.0 0.0 0.0 1.0&quot;
    pbr = ET.SubElement(material, &quot;pbr&quot;)
    metal = ET.SubElement(pbr, &quot;metal&quot;)
    if diffuse\_map != &quot;&quot;:
        albedo\_map = ET.SubElement(metal, &quot;albedo\_map&quot;)
        albedo\_map.text = meshes\_folder\_prefix + diffuse\_map
    
    # for lightmapping, add the UV and turn off casting of shadows
    if os.path.isfile(lightmap\_filename):
        light\_map = ET.SubElement(metal, &quot;light\_map&quot;, attrib=&#123;&quot;uv\_set&quot;:&quot;1&quot;&#125;)
        light\_map.text = meshes\_folder\_prefix + lightmap\_filename
        
        cast\_shadows = ET.SubElement(visual, &quot;cast\_shadows&quot;)
        cast\_shadows.text = &quot;0&quot;
    
def add\_attenuation\_tags(light\_tag, blender\_light):
    attenuation = ET.SubElement(light, &quot;attenuation&quot;)
    range = ET.SubElement(attenuation, &quot;range&quot;)
    range.text = str(blender\_light.cutoff\_distance)
    linear\_attenuation = ET.SubElement(attenuation, &quot;linear&quot;)
    linear\_attenuation.text = str(blender\_pointlight.linear\_attenuation)
    quad\_attenuation = ET.SubElement(attenuation, &quot;quadratic&quot;)
    quad\_attenuation.text = str(blender\_pointlight.quadratic\_coefficient)
    const\_attenuation = ET.SubElement(attenuation, &quot;constant&quot;)
    const\_attenuation.text = str(blender\_pointlight.constant\_coefficient)

# export lights
for l in light\_objects:
    blender\_light = l.data
    
    if blender\_light.type == &quot;POINT&quot;:
        light = ET.SubElement(link, &quot;light&quot;, attrib=&#123;&quot;name&quot;:l.name, &quot;type&quot;:&quot;point&quot;&#125;)
        diffuse = ET.SubElement(light, &quot;diffuse&quot;)
        diffuse.text = str(blender\_light.color.r) + &quot; &quot; + str(blender\_light.color.g) + &quot; &quot; + str(blender\_light.color.b) + &quot; 1.0&quot;
        blender\_pointlight = bpy.types.PointLight(blender\_light)
        
        add\_attenuation\_tags(light, blender\_pointlight)
        
    if blender\_light.type == &quot;SPOT&quot;:
        light = ET.SubElement(link, &quot;light&quot;, attrib=&#123;&quot;name&quot;:l.name, &quot;type&quot;:&quot;spot&quot;&#125;)
        diffuse = ET.SubElement(light, &quot;diffuse&quot;)
        diffuse.text = str(blender\_light.color.r) + &quot; &quot; + str(blender\_light.color.g) + &quot; &quot; + str(blender\_light.color.b) + &quot; 1.0&quot;
        blender\_spotlight = bpy.types.SpotLight(blender\_light)
        
        add\_attenuation\_tags(light, blender\_spotlight)
        # note: unsupported &lt;spot&gt; tags in blender
        
    if blender\_light.type == &quot;SUN&quot;:
        light = ET.SubElement(link, &quot;light&quot;, attrib=&#123;&quot;name&quot;:l.name, &quot;type&quot;:&quot;directional&quot;&#125;)
        diffuse = ET.SubElement(light, &quot;diffuse&quot;)
        diffuse.text = str(blender\_light.color.r) + &quot; &quot; + str(blender\_light.color.g) + &quot; &quot; + str(blender\_light.color.b) + &quot; 1.0&quot;
        blender\_pointlight = bpy.types.SunLight(blender\_light)
        
    if blender\_light.type == &quot;SUN&quot; or blender\_light.type == &quot;SPOT&quot;:
        direction = ET.SubElement(light, &quot;direction&quot;)
        direction.text = str(l.matrix\_world\[0\]\[2\]) + &quot; &quot; + str(l.matrix\_world\[1\]\[2\]) + &quot; &quot; + str(l.matrix\_world\[2\]\[2\])
        
    # unsupported: AREA lights

    cast\_shadows = ET.SubElement(light, &quot;cast\_shadows&quot;)
    cast\_shadows.text = &quot;true&quot;
    
    # todo : bpy.types.light script api lacks an intensity value, possible candidate is energy/power(Watts)?
    intensity = ET.SubElement(light, &quot;intensity&quot;)
    intensity.text = &quot;1.0&quot;

## sdf collision tags
collision = ET.SubElement(link, &quot;collision&quot;, attrib=&#123;&quot;name&quot;:&quot;collision&quot;&#125;)

geometry = ET.SubElement(collision, &quot;geometry&quot;)
mesh = ET.SubElement(geometry, &quot;mesh&quot;)
uri = ET.SubElement(mesh, &quot;uri&quot;)
uri.text = meshes\_folder\_prefix+dae\_filename

surface = ET.SubElement(collision, &quot;surface&quot;)
contact = ET.SubElement(collision, &quot;contact&quot;)
collide\_bitmask = ET.SubElement(collision, &quot;collide\_bitmask&quot;)
collide\_bitmask.text = &quot;0x01&quot;

## sdf write to file
xml\_string = ET.tostring(sdf, encoding=&#39;unicode&#39;)
reparsed = minidom.parseString(xml\_string)

sdf\_file = open(prefix\_path+sdf\_filename, &quot;w&quot;)
sdf\_file.write(reparsed.toprettyxml(indent=&quot;  &quot;))
sdf\_file.close()

##############################
### generate model.config ####
##############################
model = ET.Element(&#39;model&#39;)
name = ET.SubElement(model, &#39;name&#39;)
name.text = model\_name
version = ET.SubElement(model, &#39;version&#39;)
version.text = &quot;1.0&quot;
sdf\_tag = ET.SubElement(model, &quot;sdf&quot;, attrib=&#123;&quot;sdf&quot;:&quot;1.8&quot;&#125;)
sdf\_tag.text = sdf\_filename

author = ET.SubElement(model, &#39;author&#39;)
name = ET.SubElement(author, &#39;name&#39;)
name.text = &quot;Generated by blender SDF tools&quot;

xml\_string = ET.tostring(model, encoding=&#39;unicode&#39;)
reparsed = minidom.parseString(xml\_string)

config\_file = open(prefix\_path+model\_config\_filename, &quot;w&quot;)
config\_file.write(reparsed.toprettyxml(indent=&quot;  &quot;))
config\_file.close()
</code></pre>
<h4 id="UI-Handling"><a href="#UI-Handling" class="headerlink" title="UI Handling"></a>UI Handling</h4><p>class OT_TestOpenFilebrowser(Operator, ImportHelper):<br>  bl_idname &#x3D; “test.open_filebrowser”<br>  bl_label &#x3D; “Save”</p>
<p>  directory : bpy.props.StringProperty(name&#x3D;”Outdir Path”)</p>
<p>  def execute(self, context):<br>    “””Do the export with the selected file.”””</p>
<pre><code>if not os.path.isdir(self.directory):
    print(self.directory + &quot; is not a directory!&quot;)
else:
    print(&quot;exporting to directory: &quot; + self.directory)
    export\_sdf(self.directory)
return &#123;&#39;FINISHED&#39;&#125;
</code></pre>
<p>def register():<br>    bpy.utils.register_class(OT_TestOpenFilebrowser)<br>def unregister():<br>    bpy.utils.unregister_class(OT_TestOpenFilebrowser)</p>
<p>if __name__ &#x3D;&#x3D; “__main__“:<br>    register()<br>    bpy.ops.test.open_filebrowser(‘INVOKE_DEFAULT’)</p>
<h1 id="alternatively-comment-the-main-code-block-and-do-a-function-call-without-going-through-all-the-ui"><a href="#alternatively-comment-the-main-code-block-and-do-a-function-call-without-going-through-all-the-ui" class="headerlink" title="alternatively comment the main code block and do a function call without going through all the ui"></a>alternatively comment the main code block and do a function call without going through all the ui</h1><h1 id="prefix-path-‘-home-ddeng-blender-lightmap-final-office-office-‘"><a href="#prefix-path-‘-home-ddeng-blender-lightmap-final-office-office-‘" class="headerlink" title="prefix_path &#x3D; ‘&#x2F;home&#x2F;ddeng&#x2F;blender_lightmap&#x2F;final_office&#x2F;office&#x2F;‘"></a>prefix_path &#x3D; ‘&#x2F;home&#x2F;ddeng&#x2F;blender_lightmap&#x2F;final_office&#x2F;office&#x2F;‘</h1><h1 id="export-sdf-prefix-path"><a href="#export-sdf-prefix-path" class="headerlink" title="export_sdf(prefix_path)"></a>export_sdf(prefix_path)</h1><p>复制上面文本保存为一个py文件，在Blender中，点击最左下角的编辑器类型，选择Scripting下的文本编辑器，点击打开，选择上述py文件，然后点击运行按钮。选择一个保存路径后，就会生成dae文件、model.config、model.sdf。</p>
<p>但是我个人发现这个插件因为是吧每个部分分别插入sdf文件中，所以经常出问题，不如直接自己手动插入：</p>
<sdf version="1.7">
  <world name="demo">
    
<pre><code>&lt;include&gt;
  &lt;uri&gt;https://fuel.ignitionrobotics.org/1.0/OpenRobotics/models/Sun&lt;/uri&gt;
&lt;/include&gt;

&lt;include&gt;
  &lt;uri&gt;https://fuel.ignitionrobotics.org/1.0/OpenRobotics/models/Ground Plane&lt;/uri&gt;
&lt;/include&gt;
&lt;model name=&quot;myModel&quot;&gt;
  &lt;pose&gt;0 0 0 0 0 0&lt;/pose&gt;
  &lt;static&gt;true&lt;/static&gt;
  &lt;link name=&quot;link&quot;&gt;
    &lt;collision name=&quot;collision&quot;&gt;
      &lt;geometry&gt;
        
        &lt;mesh&gt;
          &lt;uri&gt;untitled.dae&lt;/uri&gt;
        &lt;/mesh&gt;
      &lt;/geometry&gt;
    &lt;/collision&gt;
    &lt;visual name=&quot;visual&quot;&gt;
      &lt;geometry&gt;
        
        &lt;mesh&gt;
          &lt;uri&gt;untitled.dae&lt;/uri&gt;
        &lt;/mesh&gt;
      &lt;/geometry&gt;
    &lt;/visual&gt;
  &lt;/link&gt;
&lt;/model&gt;
</code></pre>
  </world>
</sdf>

<p>不如像这样直接导入，倒是一点问题也没有。</p>
<p>这个工作流的好处在于他保存了材质，让场景看起来更加真实。下面这个颜色是我在Blender里随便加的。</p>
<p><img src="http://www.lxshaw.com/wp-content/uploads/2021/09/%E5%9B%BE%E7%89%87-1-1024x562.png"></p>
<p>但是这个方法虽然快，也有弊端。比如，如果我想在这个模型的某颗树下加一个物体，如果sdf是按照部件逐个导入dae的，那么可以根据名称直接找到树所在的sdf模型，然后相对位置放置即可，但是，如果是整个导入的，就只能按照世界绝对坐标系放置了。在之后的与IFC结合的工作中，这实际上是非常关键的。因此，还是得想办法把这个完整的工作流跑通。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/09/01/ignition%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB%EF%BC%9A%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E4%B8%8Eignition%E7%9A%84%E7%BB%93%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/01/ignition%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB%EF%BC%9A%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E4%B8%8Eignition%E7%9A%84%E7%BB%93%E5%90%88/" class="post-title-link" itemprop="url">Ignition资源分享：强化学习与Ignition的结合</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-01 14:56:53" itemprop="dateCreated datePublished" datetime="2021-09-01T14:56:53+08:00">2021-09-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/Iginition/" itemprop="url" rel="index"><span itemprop="name">Iginition</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Ignition communication meeting (June 2021)</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1jh411W7NJ/">https://www.bilibili.com/video/BV1jh411W7NJ/</a></p>
<p>本次会议介绍了Ignition与强化学习结合的应用，主要使用了Gym-ignition。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/robotology/gym-ignition">https://github.com/robotology/gym-ignition</a></p>
<p>Gym-ignition是一个用于强化学习的ignition拓展程序。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/08/30/ignition-contact-sensor%E6%8E%A5%E8%A7%A6%E4%BC%A0%E6%84%9F%E5%99%A8%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/30/ignition-contact-sensor%E6%8E%A5%E8%A7%A6%E4%BC%A0%E6%84%9F%E5%99%A8%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96/" class="post-title-link" itemprop="url">Ignition contact sensor接触传感器数据提取</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-30 16:47:29" itemprop="dateCreated datePublished" datetime="2021-08-30T16:47:29+08:00">2021-08-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/Iginition/" itemprop="url" rel="index"><span itemprop="name">Iginition</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>void ContactPrivate::UpdateSensors(const UpdateInfo &amp;_info,<br>                                   const EntityComponentManager &amp;_ecm)<br>{<br>    IGN_PROFILE(“ContactPrivate::UpdateSensors”);<br>    for (const auto &amp;item : this-&gt;entitySensorMap)<br>    {<br>        for (const Entity &amp;entity : item.second-&gt;collisionEntities)<br>        {</p>
<pre><code>        auto contacts = \_ecm.Component&lt;components::ContactSensorData&gt;(entity);//这一句应该是重点

        // We will assume that the ContactData component will have been created if
        // this entity is in the collisionEntities list
        if (contacts-&gt;Data().contact\_size() &gt; 0)
        &#123;
            auto names = \_ecm.Component&lt;components::Name&gt;(entity);
            ignmsg &lt;&lt; &quot;collision object:&quot; &lt;&lt; contacts-&gt;Data().contact().Get(0).collision2().id() &lt;&lt; std::endl;
            item.second-&gt;AddContacts(\_info.simTime, contacts-&gt;Data());
        &#125;
    &#125;
&#125;
</code></pre>
<p>}</p>
<p>ignition的接触传感器通过更新传感器来探测是否有物体碰撞。</p>
<p>const Entity &amp;entity : item.second-&gt;collisionEntities</p>
<p>item.second指的是传感器，collisionEntities是传感器检测碰撞的物体。</p>
<p> auto contacts &#x3D; _ecm.Component<a href="components::ContactSensorData">components::ContactSensorData</a>(entity)</p>
<p>contacts不太清楚是什么，个人感觉是对“接触”这一事件的描述。</p>
<p>contacts-&gt;Data().contact().Get(0).collision2().id()</p>
<p>这一句是我发现的如何得到接触物体的entityid的方法。更进一步地，如果不加上id()，得到的则是entity本身。但是要注意的是，这里得到的entity类型为msgs::entity，还不能直接使用。</p>
<p>在Ignition中，Entity的表示方法就是一个数字id，也就是上一行代码中我们用id()方法得到的entityid。将msgs::Entity转化为gazebo::Entity的方法很简单：</p>
<p>gazebo::Entity collision &#x3D; contacts-&gt;Data().contact().Get(0).collision2().id()；</p>
<p>注意这里类型指定不能使用auto，不然类型还是long。要使用gazebo::Entity.这样就能得到可操作的Entity对象了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/08/26/%E9%AB%98%E6%97%97%E8%B6%85%E8%BD%BD%E4%B9%90%E9%98%9F-%E7%94%9F%E5%91%BD%E4%B9%8B%E8%AF%97%E6%BC%94%E5%94%B1%E4%BC%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/26/%E9%AB%98%E6%97%97%E8%B6%85%E8%BD%BD%E4%B9%90%E9%98%9F-%E7%94%9F%E5%91%BD%E4%B9%8B%E8%AF%97%E6%BC%94%E5%94%B1%E4%BC%9A/" class="post-title-link" itemprop="url">高旗&超载乐队——生命之诗演唱会</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-26 19:42:20" itemprop="dateCreated datePublished" datetime="2021-08-26T19:42:20+08:00">2021-08-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>高旗&amp;超载乐队是我最喜欢的中国乐队。</p>
<h2 id="陈胜吴广"><a href="#陈胜吴广" class="headerlink" title="陈胜吴广"></a>陈胜吴广</h2><h2 id="感受"><a href="#感受" class="headerlink" title="感受"></a>感受</h2><h2 id="距离"><a href="#距离" class="headerlink" title="距离"></a>距离</h2><h2 id="生命之诗"><a href="#生命之诗" class="headerlink" title="生命之诗"></a>生命之诗</h2><h2 id="梦缠绕的时候"><a href="#梦缠绕的时候" class="headerlink" title="梦缠绕的时候"></a>梦缠绕的时候</h2><h2 id="不要怪我"><a href="#不要怪我" class="headerlink" title="不要怪我"></a>不要怪我</h2><h2 id="依靠"><a href="#依靠" class="headerlink" title="依靠"></a>依靠</h2><h2 id="完美夏天"><a href="#完美夏天" class="headerlink" title="完美夏天"></a>完美夏天</h2><h2 id="不要告别"><a href="#不要告别" class="headerlink" title="不要告别"></a>不要告别</h2><h2 id="如果我现在"><a href="#如果我现在" class="headerlink" title="如果我现在"></a>如果我现在</h2><h2 id="现在到永远"><a href="#现在到永远" class="headerlink" title="现在到永远"></a>现在到永远</h2><h2 id="生命是一次奇遇"><a href="#生命是一次奇遇" class="headerlink" title="生命是一次奇遇"></a>生命是一次奇遇</h2><h2 id="出发"><a href="#出发" class="headerlink" title="出发"></a>出发</h2><h2 id="太空2001遨游"><a href="#太空2001遨游" class="headerlink" title="太空2001遨游"></a>太空2001遨游</h2><h2 id="魔幻蓝天"><a href="#魔幻蓝天" class="headerlink" title="魔幻蓝天"></a>魔幻蓝天</h2><h2 id="让每一个夜晚充满爱的火焰"><a href="#让每一个夜晚充满爱的火焰" class="headerlink" title="让每一个夜晚充满爱的火焰"></a>让每一个夜晚充满爱的火焰</h2><h2 id="每次都想拥抱你"><a href="#每次都想拥抱你" class="headerlink" title="每次都想拥抱你"></a>每次都想拥抱你</h2><p>以下是完整CD内容：</p>
<p><strong>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/16HA5r/_92VITbGhz-3n9XKg">https://pan.baidu.com/s/16HA5r\_92VITbGhz-3n9XKg</a> 密码: uok4</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/08/15/freecad-bim%E4%BD%BF%E7%94%A8%E6%84%9F%E5%8F%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/15/freecad-bim%E4%BD%BF%E7%94%A8%E6%84%9F%E5%8F%97/" class="post-title-link" itemprop="url">FreeCAD BIM使用感受</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-15 21:04:02" itemprop="dateCreated datePublished" datetime="2021-08-15T21:04:02+08:00">2021-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/BIM/" itemprop="url" rel="index"><span itemprop="name">BIM</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我很喜欢FreeCAD，最主要的原因就是FreeCA是开源的。之前我尝试使用FreeCAD替代SolidWorks，效果还是不错的。我认为这有两个原因，一个原因是FreeCAD本身在零件设计上下了一定的功夫，因此功能还是比较完全；另一个原因是我对SolidWork本身掌握也不多，因此使用FreeCAD就足以替代SolidWorks中我经常使用的一些功能。</p>
<p>自然而然的，我开始想，能否用FreeCAD来替代Revit呢？我使用Revit已经很长时间了，已经习惯了它的许多布局与操作。甚至在FreeCAD中，我也将Revit操作模式设置为默认操作模式。就我而言，使用FreeCAD来替代Revit，至少有以下好处：</p>
<ol>
<li>补上Ubuntu工作平台的最后一环。目前，我已经在Ubuntu上搭建了完整的科研和工作平台，除了BIM建模；</li>
<li>开源的、不受限制的应用。我曾经试图在Revit中导出dae格式的建筑模型，然而可供选择的工具很少，有一些还需要收费。而FreeCAD本身自带这一功能；</li>
<li>对IFC的更好支持。相比Revit，FreeCAD能够导出更为简洁的IFC文件；</li>
<li>拓展性。在未来，甚至可能可以通过自己动手来集成一些其他功能。</li>
</ol>
<p>因此我对FreeCAD+BIM工作流展开了尝试。感谢**<a target="_blank" rel="noopener" href="https://github.com/yorikvanhavre">yorikvanhavre</a>**的工作，他是FreeCAD的一名核心开发人员，同时也是一名专业的建筑师。他开发的BIM workbench让这一切成为了可能。</p>
<p>要在FreeCAD中使用BIM功能，需要下载<a target="_blank" rel="noopener" href="https://github.com/yorikvanhavre/BIM_Workbench">BIM workbench</a>。实际上这是一个将Arch和Draft功能集成的插件。具体的学习资源，可以看作者在Youtube上发布的教学视频：<a target="_blank" rel="noopener" href="https://www.youtube.com/playlist?list=PLmKdGVtV5Vnt2cj4IZIv9FM39QHaE1ZaU">https://www.youtube.com/playlist?list=PLmKdGVtV5Vnt2cj4IZIv9FM39QHaE1ZaU</a>。</p>
<p>跟着教程学习了一段时间后，我认为FreeCAD BIM目前还无法对Revit造成任何威胁。</p>
<p>首先从建模的难易度上来说，FreecadBIM远逊于Revit。在Revit中，所有的操作都建立在楼层平面上，这实际上是非常自然的。因此，在建模的一开始，就应该在立面图中设置标高。而在FreeCADBIM中，立面和平面本质上并没有差别。因此，在FreeCADBIM中，需要频繁切换工作面以确保模型附着在工作面上。而且，FreeCADBIM在绘制时没有提供尺寸显示和吸附，</p>
<p>这引出第二个不足之处。在Revit中，放置窗户是非常简便的。只需要选择窗户的类型和大小，设置标高后，立面图中在墙体相应的地方点击就可以了，之后也可以在立面图中调整。这也是非常自然的。而在FreeCAD中，墙和门实际上是同一类型的洞口。因此，绘制门或者窗口必须在立面图中，或者说墙的工作面上进行绘制。这就导致很难快速地绘制大量的窗口。</p>
<p>第三个不足之处是材质上的。在FreeCADBIM中，材质功能很少，近似没有。只能设置颜色、反光率等，只能做为区分使用。而在Revit中，不仅能够设置表面材质，还能设置夹层、夹层材质。在这一点上，FreeCADBIM远逊于Revit，而且暂时也没有解决方法。</p>
<p>因此，FreeCADBIM的用途可能仅局限于输出高兼容度的IFC、DAE，以及作为一种可能的开源方法进行BIM建模。同时，对于建筑师来说，FreeCADBIM的操作难度又明显大于SketchUp，库的数量也远远低于SketchUp，渲染也有很大的局限性。</p>
<p>综上所处，FreeCADBIM目前的发展情况并不理想。除非FreeCADBIM能够脱离它为工业设计的蹩脚逻辑，或者增加大量的基于用户体验考虑的操作逻辑，否则FreeCADBIM只能是一个可能性而不是一个工具。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/08/13/ignition-gazebo%E5%AD%A6%E4%B9%A0-entitycomponentmanager%E7%9A%84%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/13/ignition-gazebo%E5%AD%A6%E4%B9%A0-entitycomponentmanager%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Ignition Gazebo学习: 阅读DetachableJoint代码</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-13 20:13:21" itemprop="dateCreated datePublished" datetime="2021-08-13T20:13:21+08:00">2021-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E8%B4%B4/" itemprop="url" rel="index"><span itemprop="name">技术贴</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/Iginition/" itemprop="url" rel="index"><span itemprop="name">Iginition</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>EntityComponentManager是一个用于控制sdf世界中实体增加和删除的功能，之所以把这个功能单独拿出来说，是因为基于它可以实现许多功能，比如说解除链接功能，或者是增加链接功能。ign官方有一个DetachableJoint插件，就使用了这个功能。</p>
<p>我们来看看，官方给出的插件中是如何运用这个功能的。这个插件主要由三个函数组成：</p>
<ol>
<li>Configure</li>
<li>PreUpdate</li>
<li>OnDetachableRequest</li>
</ol>
<h2 id="Configure"><a href="#Configure" class="headerlink" title="Configure"></a>Configure</h2><p>void DetachableJoint::Configure(const Entity &amp;_entity,<br>                                const std::shared_ptr<const sdf::Element> &amp;_sdf,<br>                                EntityComponentManager &amp;_ecm,<br>                                EventManager &amp; &#x2F;*_eventMgr*&#x2F;)<br>&#x2F;&#x2F;函数继承自模板文件中的Configure，插件挂载在_entity之下。_ecm是一个EntityComponentManager。_sdf是插件所属的sdf区块。<br>{<br>&#x2F;&#x2F;model的初始化方法为Model(gazebo::Entity _entity&#x3D;kNullEntity)，由此将_entity所指向的model赋值给this-&gt;model。<br>  this-&gt;model &#x3D; Model(_entity);<br>&#x2F;&#x2F;model.Valid是一个用于检测model是否正确指向一个entity的方法，使用_ecm作为参数。如果不存在，那么抛出一个错误。这是为了确保插件放在model内。<br>  if (!this-&gt;model.Valid(_ecm))<br>  {<br>    ignerr &lt;&lt; “DetachableJoint should be attached to a model entity. “<br>           &lt;&lt; “Failed to initialize.” &lt;&lt; std::endl;<br>    return;<br>  }<br>&#x2F;&#x2F;如果_sdf内有parent_link这个元素：<br>  if (_sdf-&gt;HasElement(“parent_link”))<br>  {<br>&#x2F;&#x2F;则使用_sdf的Get方法获取其parentLinkName属性;<br>    auto parentLinkName &#x3D; _sdf-&gt;Get<a href="std::string">std::string</a>(“parent_link”);<br>&#x2F;&#x2F;然后，使用model的LinkByName方法，找到parentLinkName所对应的Entity;<br>    this-&gt;parentLinkEntity &#x3D; this-&gt;model.LinkByName(_ecm, parentLinkName);<br>&#x2F;&#x2F;如果parentLinkName所对应的Entity是kNullEntity（也就是无）：<br>    if (kNullEntity &#x3D;&#x3D; this-&gt;parentLinkEntity)<br>    {<br>&#x2F;&#x2F;报错，parent_link这个参数的值不对（也就是名称错误），跳出程序<br>      ignerr &lt;&lt; “Link with name “ &lt;&lt; parentLinkName<br>             &lt;&lt; “ not found in model “ &lt;&lt; this-&gt;model.Name(_ecm)<br>             &lt;&lt; “. Make sure the parameter ‘parent_link’ has the “<br>             &lt;&lt; “correct value. Failed to initialize.\n”;<br>      return;<br>    }<br>  }<br>&#x2F;&#x2F;如果没有parent_link这个元素，报错，跳出程序<br>  else<br>  {<br>    ignerr &lt;&lt; “‘parent_link’ is a required parameter for DetachableJoint. “<br>              “Failed to initialize.\n”;<br>    return;<br>  }</p>
<p>  if (_sdf-&gt;HasElement(“child_model”))<br>  {<br>    this-&gt;childModelName &#x3D; _sdf-&gt;Get<a href="std::string">std::string</a>(“child_model”);<br>  }<br>  else<br>  {<br>    ignerr &lt;&lt; “‘child_model’ is a required parameter for DetachableJoint.”<br>              “Failed to initialize.\n”;<br>    return;<br>  }<br>&#x2F;&#x2F;如果_sdf内有child_link这个元素：<br>  if (_sdf-&gt;HasElement(“child_link”))<br>  {<br>&#x2F;&#x2F;则使用_sdf的Get方法获取其ChildLinkName属性;<br>    this-&gt;childLinkName &#x3D; _sdf-&gt;Get<a href="std::string">std::string</a>(“child_link”);<br>  }<br>&#x2F;&#x2F;否则报错，跳出<br>  else<br>  {<br>    ignerr &lt;&lt; “‘child_link’ is a required parameter for DetachableJoint.”<br>              “Failed to initialize.\n”;<br>    return;<br>  }</p>
<p>  &#x2F;&#x2F; Setup detach topic<br>&#x2F;&#x2F;设置一个Topic，不过这里只是把这个话题的名称列出来。defalutTopic名称为&#x2F;model&#x2F;model的名称&#x2F;detachable_joint&#x2F;detach<br>  std::string defaultTopic{“&#x2F;model&#x2F;“ + this-&gt;model.Name(_ecm) +<br>                           “&#x2F;detachable_joint&#x2F;detach”};<br>&#x2F;&#x2F;把这个topic赋值给this-&gt;topic<br>  this-&gt;topic &#x3D; _sdf-&gt;Get<a href="std::string">std::string</a>(“topic”, defaultTopic).first;</p>
<p>  this-&gt;suppressChildWarning &#x3D;<br>      _sdf-&gt;Get<bool>(“suppress_child_warning”, this-&gt;suppressChildWarning)<br>          .first;<br>&#x2F;&#x2F;上面都完成后，将this-&gt;validConfig值改为true<br>  this-&gt;validConfig &#x3D; true;<br>}</p>
<p>Configure主要是对插件是否能够正确读取参数做一检查。</p>
<h2 id="PreUpdate"><a href="#PreUpdate" class="headerlink" title="PreUpdate"></a>PreUpdate</h2><p>&#x2F;&#x2F;PreUpdate,是在每一个模拟帧计算前执行的任务<br>void DetachableJoint::PreUpdate(<br>    const ignition::gazebo::UpdateInfo &amp; &#x2F;*_info*&#x2F;,<br>    ignition::gazebo::EntityComponentManager &amp;_ecm)<br>{<br>  IGN_PROFILE(“DetachableJoint::PreUpdate”);<br>&#x2F;&#x2F;this-&gt;validConfig，如果Configure函数顺利执行的话值为true；initialized在一开始的状态为默认的false，如果下面这些nt，变成一个特定函数正常执行，则会变为true，也就是不会在执行这些语句，后面再看<br>  if (this-&gt;validConfig &amp;&amp; !this-&gt;initialized)<br>  {<br>    &#x2F;&#x2F; Look for the child model and link<br>&#x2F;&#x2F;先初始化一个Entity对象，默认kNullEntity也就是空对象<br>    Entity modelEntity{kNullEntity};<br>&#x2F;&#x2F;__model__也就是“this”的model属性，如果这个model就是Configure函数中初始化的childModelName（这种情况下，意味着你把插件放在了这个model里）：<br>    if (“__model__“ &#x3D;&#x3D; this-&gt;childModelName)<br>    {<br>&#x2F;&#x2F;modelEntity的值改为this-&gt;model.Entity()<br>      modelEntity &#x3D; this-&gt;model.Entity();<br>    }<br>    else<br>    {<br>&#x2F;&#x2F;否则的话，使用_cem的EntityByComponents寻找符合条件的Entity：类型为Model，名称为this-&gt;childModelName。这个时候意味着插件可能放在了model以外的地方：<br>      modelEntity &#x3D; _ecm.EntityByComponents(<br>          components::Model(), components::Name(this-&gt;childModelName));<br>    }<br>&#x2F;&#x2F;如果经过上面的操作，找到了对应的modelEntity（不为空）：<br>    if (kNullEntity !&#x3D; modelEntity)<br>    {<br>&#x2F;&#x2F;还是用_ecm.EntityByComponents找对应的Entity，这次的寻找筛选器为：类型为Link，ParentEntity为modelEntity，Name为childLinkName的对象。其实就是找到childLinkEntity对应的实体。<br>      this-&gt;childLinkEntity &#x3D; _ecm.EntityByComponents(<br>          components::Link(), components::ParentEntity(modelEntity),<br>          components::Name(this-&gt;childLinkName));<br>&#x2F;&#x2F;如果经过上面的操作，找到了对应的childLinkEntity：<br>      if (kNullEntity !&#x3D; this-&gt;childLinkEntity)<br>      {<br>        &#x2F;&#x2F; Attach the models<br>        &#x2F;&#x2F; We do this by creating a detachable joint entity.<br>&#x2F;&#x2F;用_ecm.CreateEntity方法创建一个实体。此时我们还没有指定这是一个什么实体，不过先赋值给this-&gt;detachableJointEntity<br>        this-&gt;detachableJointEntity &#x3D; _ecm.CreateEntity();<br>&#x2F;&#x2F;然后具体指定实体类型。使用_ecm.CreateComponent方法，指定为components::DetachableJoint。因为DetachableJoint这个特殊的Joint已经被加入ignition library了，所以可以直接指定。目前仅支持fixed类型的Joint。<br>        _ecm.CreateComponent(<br>            this-&gt;detachableJointEntity,<br>            components::DetachableJoint({this-&gt;parentLinkEntity,<br>                                         this-&gt;childLinkEntity, “fixed”}));<br>&#x2F;&#x2F;订阅topic，绑定OnDetachRequest函数<br>        this-&gt;node.Subscribe(<br>            this-&gt;topic, &amp;DetachableJoint::OnDetachRequest, this);<br>&#x2F;&#x2F;订阅成功后打印一条消息，然后把initialized状态改为true，上面的寻找childLinkEngity等操作不会再执行<br>        ignmsg &lt;&lt; “DetachableJoint subscribing to messages on “<br>               &lt;&lt; “[“ &lt;&lt; this-&gt;topic &lt;&lt; “]“ &lt;&lt; std::endl;</p>
<pre><code>    this-&gt;initialized = true;
  &#125;
</code></pre>
<p>&#x2F;&#x2F;如果找不到的话，报错<br>      else<br>      {<br>        ignwarn &lt;&lt; “Child Link “ &lt;&lt; this-&gt;childLinkName<br>                &lt;&lt; “ could not be found.\n”;<br>      }<br>    }<br>    else if (!this-&gt;suppressChildWarning)<br>    {<br>      ignwarn &lt;&lt; “Child Model “ &lt;&lt; this-&gt;childModelName<br>              &lt;&lt; “ could not be found.\n”;<br>    }<br>  }</p>
<p>&#x2F;&#x2F;initialized变为true后，每次PreUpdate时执行下面的语句<br>  if (this-&gt;initialized)<br>  {<br>&#x2F;&#x2F;如果收到了detachRequested为true的消息，并且detachableJointEntity存在的话：<br>    if (this-&gt;detachRequested &amp;&amp; (kNullEntity !&#x3D; this-&gt;detachableJointEntity))<br>    {<br>      &#x2F;&#x2F; Detach the models<br>      igndbg &lt;&lt; “Removing entity: “ &lt;&lt; this-&gt;detachableJointEntity &lt;&lt; std::endl;<br>&#x2F;&#x2F;使用_ecm.RequestRemoveENtity方法移除一个Entity；<br>      _ecm.RequestRemoveEntity(this-&gt;detachableJointEntity);<br>&#x2F;&#x2F;将detachableJointEntity设为空实体，将detachRequested重设为false。<br>      this-&gt;detachableJointEntity &#x3D; kNullEntity;<br>      this-&gt;detachRequested &#x3D; false;<br>    }<br>  }<br>}</p>
<p>PreUpdate里完成了对Entity的搜索、创建DetachableJoint、订阅Topic、删除DetachableJoint四大工作。主要运用了_ecm的几个方法：</p>
<ol>
<li>EntityByComponents，用来寻找符合条件的Entity</li>
<li>CreateEntity，创建一个Entity</li>
<li>CreateComponent给Entity创建一些Component，变成一个特定的Entity</li>
<li>RequestRemoveEntity删除Entity</li>
</ol>
<h2 id="OnDetachRequests"><a href="#OnDetachRequests" class="headerlink" title="OnDetachRequests"></a>OnDetachRequests</h2><p>void DetachableJoint::OnDetachRequest(const msgs::Empty &amp;)<br>{<br>  this-&gt;detachRequested &#x3D; true;<br>}</p>
<p>这个函数就很简单了，从参数可以看出，它接受一个Empty类型的msgs，然后就把this-&gt;detachRequested的值改为true。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Xiao Lin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">分类</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/linxiaoshaw@foxmail.com" title="E-Mail → linxiaoshaw@foxmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xiao Lin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
