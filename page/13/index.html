<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wonderful-sea-04900b000.6.azurestaticapps.net","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Shawn Lin&#39;s Blog">
<meta property="og:url" content="https://wonderful-sea-04900b000.6.azurestaticapps.net/page/13/index.html">
<meta property="og:site_name" content="Shawn Lin&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Xiao Lin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/page/13/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Shawn Lin's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Shawn Lin's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/05/29/endnote%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/29/endnote%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">EndNote使用指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-29 00:33:06" itemprop="dateCreated datePublished" datetime="2021-05-29T00:33:06+08:00">2021-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E8%B4%B4/" itemprop="url" rel="index"><span itemprop="name">技术贴</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/thought/" itemprop="url" rel="index"><span itemprop="name">thought</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/thought/%E7%A7%91%E7%A0%94%E4%BA%8C%E4%B8%89%E4%BA%8B/" itemprop="url" rel="index"><span itemprop="name">科研二三事</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>EndNote是一款文献管理软件，有一点点的操作入门门槛，但是熟悉之后会给研究带来很大帮助。与国内的类似软件（知网研学）相比，许多高校会提供免费的软件源，同时只要注册账户就可以多平台同步文献，后者对外文文献支持较差，且需要花钱注册会员才能多平台同步。</p>
<h2 id="版本选择"><a href="#版本选择" class="headerlink" title="版本选择"></a>版本选择</h2><p>建议选择EndNote X9而不是最新的EndNote 20. EndNote 20作为最新版本对UI进行了大改，比较让人抓狂的一是一页上显示的文献数变少了，对于大数量的文献库很不友好；二是取消了PDF预览功能，如果想查看PDF文件需要更多步操作，而有的时候我只是想看个摘要回忆一下。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/05/29/endnote%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/05/22/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E4%B9%9D%EF%BC%89%EF%BC%9A%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A5%BD%E7%9A%84ros2-gazebo%E6%8F%92%E4%BB%B6%E6%A8%A1%E6%9D%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/22/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E4%B9%9D%EF%BC%89%EF%BC%9A%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A5%BD%E7%9A%84ros2-gazebo%E6%8F%92%E4%BB%B6%E6%A8%A1%E6%9D%BF/" class="post-title-link" itemprop="url">Gazebo入门（九）：一个更好的ROS2-Gazebo插件模板</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-22 23:05:43" itemprop="dateCreated datePublished" datetime="2021-05-22T23:05:43+08:00">2021-05-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这个调试过的插件模板形式上参照了Gazebo教程中的<a target="_blank" rel="noopener" href="http://gazebosim.org/tutorials?cat=guided_i&tut=guided_i6">Velodyne Plugin</a>，但是是适用于ROS2的。</p>
<p>cpp源文件：</p>
<p>#ifndef _VELODYNE_PLUGIN_HH_<br>#define _VELODYNE_PLUGIN_HH_</p>
<p>#include &lt;gazebo&#x2F;gazebo.hh&gt;<br>#include &lt;gazebo&#x2F;common&#x2F;common.hh&gt;<br>#include &lt;gazebo&#x2F;physics&#x2F;physics.hh&gt;<br>&#x2F;&#x2F;#include &lt;gazebo&#x2F;common&#x2F;Time.hh&gt;<br>&#x2F;&#x2F;#include &lt;gazebo&#x2F;physics&#x2F;Joint.hh&gt;<br>&#x2F;&#x2F;#include &lt;gazebo&#x2F;physics&#x2F;Link.hh&gt;<br>&#x2F;&#x2F;#include &lt;gazebo&#x2F;physics&#x2F;Model.hh&gt;<br>&#x2F;&#x2F;#include &lt;gazebo&#x2F;physics&#x2F;World.hh&gt;<br>&#x2F;&#x2F;#include &lt;gazebo_ros&#x2F;conversions&#x2F;builtin_interfaces.hpp&gt;<br>#include &lt;gazebo_ros&#x2F;conversions&#x2F;geometry_msgs.hpp&gt;<br>#include &lt;gazebo_ros&#x2F;node.hpp&gt;<br>&#x2F;&#x2F;#include &lt;geometry_msgs&#x2F;msg&#x2F;pose2_d.hpp&gt;<br>#include &lt;geometry_msgs&#x2F;msg&#x2F;vector3.hpp&gt;<br>&#x2F;&#x2F;#include &lt;nav_msgs&#x2F;msg&#x2F;odometry.hpp&gt;<br>#include &lt;sdf&#x2F;sdf.hh&gt;</p>
<p>#include <memory><br>#include <string><br>#include <vector></p>
<p>namespace gazebo<br>{<br>    class VelodynePlugin : public ModelPlugin<br>    {<br>    public:<br>        VelodynePlugin() {}</p>
<pre><code>    /// A pointer to the GazeboROS node.
private:
    gazebo\_ros::Node::SharedPtr ros\_node\_;

    /// Subscriber to command velocities
private:
    rclcpp::Subscription&lt;geometry\_msgs::msg::Vector3&gt;::SharedPtr cmd\_vel\_sub\_;

    /// Connection to event called at every world iteration.
private:
    gazebo::event::ConnectionPtr update\_connection\_;

    /// Pointer to model.
private:
    gazebo::physics::ModelPtr model\_;

private:
    gazebo::physics::JointPtr joint\_;

private:
    gazebo::common::PID pid\_;

public:
    virtual void Load(gazebo::physics::ModelPtr \_model, sdf::ElementPtr \_sdf)
    &#123;
        this-&gt;model\_ = \_model;
        this-&gt;joint\_ = \_model-&gt;GetJoints()\[0\];
        this-&gt;pid\_ = gazebo::common::PID(0.1, 0, 0);
        this-&gt;model\_-&gt;GetJointController()-&gt;SetVelocityPID(this-&gt;joint\_-&gt;GetScopedName(), this-&gt;pid\_);
        double velocity = 10;
        this-&gt;SetVelocity(velocity);

        // Initialize ROS node
        this-&gt;ros\_node\_ = gazebo\_ros::Node::Get(\_sdf);

        // Get QoS profiles
        const gazebo\_ros::QoS &amp;qos = this-&gt;ros\_node\_-&gt;get\_qos();

        this-&gt;cmd\_vel\_sub\_ = this-&gt;ros\_node\_-&gt;create\_subscription&lt;geometry\_msgs::msg::Vector3&gt;(
            &quot;cmd\_vel&quot;, qos.get\_subscription\_qos(&quot;cmd\_vel&quot;, rclcpp::QoS(1)),
            std::bind(&amp;VelodynePlugin::OnCmdVel, this, std::placeholders::\_1));

        RCLCPP\_INFO(
            this-&gt;ros\_node\_-&gt;get\_logger(), &quot;Subscribed to \[%s\]&quot;,
            this-&gt;cmd\_vel\_sub\_-&gt;get\_topic\_name());

        // Listen to the update event (broadcast every simulation iteration)
        this-&gt;update\_connection\_ = gazebo::event::Events::ConnectWorldUpdateBegin(
            std::bind(&amp;VelodynePlugin::OnUpdate, this, std::placeholders::\_1));
    &#125;

public:
    void OnUpdate(const gazebo::common::UpdateInfo &amp;\_info)
    &#123;
    &#125;

public:
    void SetVelocity(const double &amp;\_vel)
    &#123;
        this-&gt;model\_-&gt;GetJointController()-&gt;SetVelocityTarget(
            this-&gt;joint\_-&gt;GetScopedName(), \_vel);
    &#125;

public:
    void OnCmdVel(const geometry\_msgs::msg::Vector3::SharedPtr \_msg)
    &#123;
        this-&gt;SetVelocity(\_msg-&gt;x);
    &#125;
&#125;;

GZ\_REGISTER\_MODEL\_PLUGIN(VelodynePlugin)
</code></pre>
<p>} &#x2F;&#x2F; namespace gazebo_plugins<br>#endif</p>
<p>CMakeLists.txt</p>
<p>cmake_minimum_required(VERSION 3.5)<br>project(gazebo_plugins)</p>
<h1 id="Default-to-C-14"><a href="#Default-to-C-14" class="headerlink" title="Default to C++14"></a>Default to C++14</h1><p>if(NOT CMAKE_CXX_STANDARD)<br>  set(CMAKE_CXX_STANDARD 14)<br>endif()<br>if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES “Clang”)</p>
<h1 id="we-dont-use-add-compile-options-with-pedantic-in-message-packages"><a href="#we-dont-use-add-compile-options-with-pedantic-in-message-packages" class="headerlink" title="we dont use add_compile_options with pedantic in message packages"></a>we dont use add_compile_options with pedantic in message packages</h1><h1 id="because-the-Python-C-extensions-dont-comply-with-it"><a href="#because-the-Python-C-extensions-dont-comply-with-it" class="headerlink" title="because the Python C extensions dont comply with it"></a>because the Python C extensions dont comply with it</h1><p>  set(CMAKE_CXX_FLAGS “${CMAKE_CXX_FLAGS} -Wall -Wextra -Wpedantic -Wno-inconsistent-missing-override”)<br>endif()</p>
<p>find_package(ament_cmake REQUIRED)<br>find_package(camera_info_manager REQUIRED)<br>find_package(gazebo_dev REQUIRED)<br>find_package(gazebo_msgs REQUIRED)<br>find_package(gazebo_ros REQUIRED)<br>find_package(geometry_msgs REQUIRED)<br>find_package(image_transport REQUIRED)<br>find_package(cv_bridge REQUIRED)<br>find_package(nav_msgs REQUIRED)<br>find_package(rclcpp REQUIRED)<br>find_package(sensor_msgs REQUIRED)<br>find_package(std_msgs REQUIRED)<br>find_package(std_srvs REQUIRED)<br>find_package(tf2 REQUIRED)<br>find_package(tf2_geometry_msgs REQUIRED)<br>find_package(tf2_ros REQUIRED)<br>find_package(trajectory_msgs REQUIRED)</p>
<p>link_directories(${gazebo_dev_LIBRARY_DIRS})</p>
<p>option(ENABLE_PROFILER “Enable Ignition Profiler” FALSE)<br>if(ENABLE_PROFILER)<br>  find_package(ignition-common3 QUIET COMPONENTS profiler)<br>  if(ignition-common3_FOUND)<br>    add_definitions(“-DIGN_PROFILER_ENABLE&#x3D;1” “-DIGN_PROFILER_REMOTERY&#x3D;1”)<br>    message(STATUS “Profiler is active”)<br>  else()<br>    message(WARNING “Can’t find Ignition common3. Profiler will not be actived”)<br>    add_definitions(“-DIGN_PROFILER_ENABLE&#x3D;0” “-DIGN_PROFILER_REMOTERY&#x3D;0”)<br>  endif()<br>endif()</p>
<h1 id="gazebo-ros-diff-drive"><a href="#gazebo-ros-diff-drive" class="headerlink" title="gazebo_ros_diff_drive"></a>gazebo_ros_diff_drive</h1><p>add_library(gazebo_ros_test SHARED<br>  velodyne.cpp<br>)<br>target_include_directories(gazebo_ros_test PUBLIC include)<br>ament_target_dependencies(gazebo_ros_test<br>  “gazebo_dev”<br>  “gazebo_ros”<br>  “geometry_msgs”<br>  “nav_msgs”<br>  “rclcpp”<br>  “tf2”<br>  “tf2_geometry_msgs”<br>  “tf2_ros”<br>)<br>ament_export_libraries(gazebo_ros_test)<br>if(ENABLE_PROFILER)<br>  target_include_directories(gazebo_ros_test PUBLIC ${ignition-common3_INCLUDE_DIRS})<br>  target_link_libraries(gazebo_ros_test ${ignition-common3_LIBRARIES})<br>endif()</p>
<p>ament_export_libraries(gazebo_ros_test)</p>
<p>ament_export_include_directories(include)<br>ament_export_dependencies(rclcpp)<br>ament_export_dependencies(gazebo_dev)<br>ament_export_dependencies(gazebo_msgs)<br>ament_export_dependencies(gazebo_ros)</p>
<p>if(NOT WIN32)<br>  if(NOT APPLE)<br>    set(<br>      AMENT_CMAKE_ENVIRONMENT_HOOKS_DESC_gazebo_plugins<br>      “prepend-non-duplicate;LD_LIBRARY_PATH;${GAZEBO_PLUGIN_PATH}”)<br>  else()<br>    set(<br>      AMENT_CMAKE_ENVIRONMENT_HOOKS_DESC_gazebo_plugins<br>      “prepend-non-duplicate;DYLD_LIBRARY_PATH;${GAZEBO_PLUGIN_PATH}”)<br>  endif()<br>endif()</p>
<p>ament_package()</p>
<p>Package.xml</p>
<?xml version="1.0"?>
<?xml-model href="http://download.ros.org/schema/package\_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>
<package format="3">
  <name>gazebo\_plugins</name>
  <version>3.5.2</version>
  <description>
    Robot-independent Gazebo plugins for sensors, motors and dynamic reconfigurable components.
  </description>

<p>  <maintainer email="jrivero@osrfoundation.org">Jose Luis Rivero</maintainer><br>  <maintainer email="louise@openrobotics.org">Louise Poubel</maintainer></p>
<p>  <license>BSD, Apache 2.0</license></p>
<p>  <url type="website"><a target="_blank" rel="noopener" href="http://gazebosim.org/tutorials?cat=connect%5C_ros">http://gazebosim.org/tutorials?cat=connect\_ros</a></url><br>  <url type="bugtracker"><a target="_blank" rel="noopener" href="https://github.com/ros-simulation/gazebo/_ros/_pkgs/issues">https://github.com/ros-simulation/gazebo\_ros\_pkgs/issues</a></url><br>  <url type="repository"><a target="_blank" rel="noopener" href="https://github.com/ros-simulation/gazebo/_ros/_pkgs">https://github.com/ros-simulation/gazebo\_ros\_pkgs</a></url></p>
<p>  <author>John Hsu</author></p>
<p>  &lt;buildtool_depend&gt;ament_cmake&lt;&#x2F;buildtool_depend&gt;</p>
<p>  <depend>camera_info_manager</depend><br>  <depend>cv_bridge</depend><br>  <depend>image_transport</depend><br>  <depend>nav_msgs</depend><br>  <depend>sensor_msgs</depend><br>  <depend>std_msgs</depend><br>  <depend>std_srvs</depend><br>  <depend>tf2_geometry_msgs</depend><br>  <depend>tf2_ros</depend><br>  <depend>trajectory_msgs</depend></p>
<p>  &lt;build_depend&gt;gazebo_dev&lt;&#x2F;build_depend&gt;<br>  &lt;build_depend&gt;gazebo_msgs&lt;&#x2F;build_depend&gt;<br>  &lt;build_depend&gt;gazebo_ros&lt;&#x2F;build_depend&gt;<br>  &lt;build_depend&gt;rclcpp&lt;&#x2F;build_depend&gt;<br>  &lt;build_depend&gt;geometry_msgs&lt;&#x2F;build_depend&gt;</p>
<p>  &lt;exec_depend&gt;gazebo_dev&lt;&#x2F;exec_depend&gt;<br>  &lt;exec_depend&gt;gazebo_msgs&lt;&#x2F;exec_depend&gt;<br>  &lt;exec_depend&gt;gazebo_ros&lt;&#x2F;exec_depend&gt;<br>  &lt;exec_depend&gt;rclcpp&lt;&#x2F;exec_depend&gt;<br>  &lt;exec_depend&gt;geometry_msgs&lt;&#x2F;exec_depend&gt;</p>
<p>  &lt;test_depend&gt;ament_cmake_gtest&lt;&#x2F;test_depend&gt;<br>  &lt;test_depend&gt;ament_lint_auto&lt;&#x2F;test_depend&gt;<br>  &lt;test_depend&gt;ament_lint_common&lt;&#x2F;test_depend&gt;<br>  &lt;test_depend&gt;cv_bridge&lt;&#x2F;test_depend&gt;</p>
  <export>
    <build\_type>ament\_cmake</build\_type>
  </export>
</package>

<p>CmakeLists和Package是从ros2的gazebo_ros_plugin仓库里抄过来的，比较臃肿，许多包其实用不到。</p>
<p>通过以下命令来控制Velodyne的转速：</p>
<p>ros2 topic pub –once &#x2F;cmd_vel geometry_msgs&#x2F;msg&#x2F;Vector3 {x:\ 50.0,y:\ 0.0,z:\ 0.0\}</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/05/19/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89%EF%BC%9A%E9%80%82%E7%94%A8%E4%BA%8Eros2%E7%9A%84%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/19/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AB%EF%BC%89%EF%BC%9A%E9%80%82%E7%94%A8%E4%BA%8Eros2%E7%9A%84%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99/" class="post-title-link" itemprop="url">Gazebo入门（八）：适用于ROS2的插件编写</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-19 15:44:02" itemprop="dateCreated datePublished" datetime="2021-05-19T15:44:02+08:00">2021-05-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>作为C++苦手和ROS萌新，费了将近半个星期的时间，琢磨出了如何编写一个适用于ROS2的Gazebo Plugin。</p>
<p>目前，ROS2的官方教程并不包含Gazebo Plugin的编写。同时，Gazebo的ROS Plugin教程只针对ROS1。总而言之，目前找不到一个ROS2+Gazebo的自定义插件教程。不过，在ROS2的自带例程中，包括了一些通过Gazebo插件来创建ROS2节点、控制Gazebo机器人的实例。运用比较广泛的是libgazebo_ros_diff_driver.so这个插件，它可以用在有一对轮子的机器人上，提供差速控制。但是，这些插件基本都把功能写死，所以如果想要让机器人有自己的功能，还是需要自定义插件。</p>
<p>好在GIthub上有这些插件的源码和CMakeLists文件，这至少证明了一点：ROS2+Gazebo Plugin是完全可行的。而他们的关键在于，使用了gazbeo_ros这个包，这个包在网上还没有找到相关的使用教程。踩了几天的坑后，终于成功编写了一个最简单的自定义Plugin插件。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>Gazebo插件与ROS2通信的原理其实非常简单。一般只需要以下几个主要函数：</p>
<ul>
<li>Load，这个函数会在Gazebo Plugin加载时运行；</li>
<li>OnMsg，这个函数用来在某个Node作为Subscriber接受信息时被调用；</li>
<li>OnUpdate，这个函数用来在Gazebo中每次仿真更新时被调用。</li>
</ul>
<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p>template.hpp</p>
<p>#ifndef GAZEBO_PLUGINS__GAZEBO_ROS_TEMPLATE_HPP_<br>#define GAZEBO_PLUGINS__GAZEBO_ROS_TEMPLATE_HPP_</p>
<p>#include &lt;gazebo&#x2F;common&#x2F;Plugin.hh&gt;<br>#include &lt;std_msgs&#x2F;msg&#x2F;string.hpp&gt;</p>
<p>#include <memory></p>
<p>namespace gazebo_plugins<br>{</p>
<p>class GazeboRosTemplatePrivate;</p>
<p>class GazeboRosTemplate : public gazebo::ModelPlugin<br>{<br>public:<br>  &#x2F;&#x2F;&#x2F; Constructor<br>  GazeboRosTemplate();</p>
<p>  &#x2F;&#x2F;&#x2F; Destructor<br>  virtual ~GazeboRosTemplate();</p>
<p>  void Load(gazebo::physics::ModelPtr model, sdf::ElementPtr sdf) override;</p>
<p>protected:</p>
<p>  virtual void OnMsg(const std_msgs::msg::String::ConstSharedPtr msg);</p>
<p>  virtual void OnUpdate();</p>
<p>private:</p>
<p>  std::unique_ptr<GazeboRosTemplatePrivate> impl_;<br>};<br>}</p>
<p>#endif  &#x2F;&#x2F; GAZEBO_PLUGINS__GAZEBO_ROS_TEMPLATE_HPP_</p>
<p>这个模板文件声明并实现了GazeboRosTemplate，在public中声明了Load函数，在protected中声明了OnMsg和OnUpdate函数。需要增加函数时，建议在hpp文件中先定义好函数的类型和变量，然后到cpp文件中进行具体实现。</p>
<h2 id="cpp"><a href="#cpp" class="headerlink" title="cpp"></a>cpp</h2><p>在cpp中进行具体实现：</p>
<p>#include &lt;gazebo&#x2F;physics&#x2F;Model.hh&gt;<br>#include “template.hpp”<br>#include &lt;gazebo_plugins&#x2F;gazebo_ros_elevator.hpp&gt;<br>#include &lt;gazebo_ros&#x2F;node.hpp&gt;<br>#include &lt;rclcpp&#x2F;rclcpp.hpp&gt;</p>
<p>#include <memory></p>
<p>namespace gazebo_plugins<br>{<br>class GazeboRosTemplatePrivate<br>{<br>public:<br>  &#x2F;&#x2F;&#x2F; Connection to world update event. Callback is called while this is alive.<br>  gazebo::event::ConnectionPtr update_connection_;<br>  &#x2F;&#x2F;&#x2F; Node for ROS communication.<br>  gazebo_ros::Node::SharedPtr ros_node_;<br>  &#x2F;&#x2F;&#x2F; Subscriber to elevator commands<br>  rclcpp::Subscription&lt;std_msgs::msg::String&gt;::SharedPtr sub_;<br>};</p>
<dl><dt>GazeboRosTemplate::GazeboRosTemplate()</dt><dd>impl_(std::make_unique<GazeboRosTemplatePrivate>())<br>{<br>}</dd></dl><p>GazeboRosTemplate::~GazeboRosTemplate()<br>{<br>}</p>
<p>void GazeboRosTemplate::Load(gazebo::physics::ModelPtr model, sdf::ElementPtr sdf)<br>{<br>  &#x2F;&#x2F; Create a GazeboRos node instead of a common ROS node.<br>  &#x2F;&#x2F; Pass it SDF parameters so common options like namespace and remapping<br>  &#x2F;&#x2F; can be handled.<br>  impl_-&gt;ros_node_ &#x3D; gazebo_ros::Node::Get(sdf);<br>  &#x2F;&#x2F; Get QoS profiles<br>  const gazebo_ros::QoS &amp; qos &#x3D; impl_-&gt;ros_node_-&gt;get_qos();<br>  &#x2F;&#x2F; The model pointer gives you direct access to the physics object,<br>  &#x2F;&#x2F; for example:<br>  RCLCPP_INFO(impl_-&gt;ros_node_-&gt;get_logger(), model-&gt;GetName().c_str());<br>  impl_-&gt;sub_ &#x3D; impl_-&gt;ros_node_-&gt;create_subscription&lt;std_msgs::msg::String&gt;(<br>    “elevator”, qos.get_subscription_qos(“elevator”, rclcpp::QoS(1)),<br>    std::bind(&amp;GazeboRosTemplate::OnMsg, this, std::placeholders::_1));<br>  RCLCPP_INFO(impl_-&gt;ros_node_-&gt;get_logger(), “Subscribed to [%s]“, impl_-&gt;sub_-&gt;get_topic_name());<br>  &#x2F;&#x2F; Create a connection so the OnUpdate function is called at every simulation<br>  &#x2F;&#x2F; iteration. Remove this call, the connection and the callback if not needed.<br>  impl_-&gt;update_connection_ &#x3D; gazebo::event::Events::ConnectWorldUpdateBegin(<br>    std::bind(&amp;GazeboRosTemplate::OnUpdate, this));<br>}<br>void GazeboRosTemplate::OnMsg(const std_msgs::msg::String::ConstSharedPtr msg)<br>{<br>    RCLCPP_INFO(impl_-&gt;ros_node_-&gt;get_logger(), “I heard!”);<br>}<br>void GazeboRosTemplate::OnUpdate()<br>{<br>  &#x2F;&#x2F; Do something every simulation iteration<br>}</p>
<p>&#x2F;&#x2F; Register this plugin with the simulator<br>GZ_REGISTER_MODEL_PLUGIN(GazeboRosTemplate)<br>}  &#x2F;&#x2F; namespace gazebo_plugins</p>
<p>需要修改的地方有：</p>
<p>class GazeboRosTemplatePrivate<br>{<br>public:<br>  &#x2F;&#x2F;&#x2F; Connection to world update event. Callback is called while this is alive.<br>  gazebo::event::ConnectionPtr update_connection_;<br>  &#x2F;&#x2F;&#x2F; Node for ROS communication.<br>  gazebo_ros::Node::SharedPtr ros_node_;<br>  &#x2F;&#x2F;&#x2F; Subscriber to elevator commands<br>  rclcpp::Subscription&lt;std_msgs::msg::String&gt;::SharedPtr sub_;<br>};</p>
<p>在这一块内声明之后需要使用的变量；</p>
<p>void GazeboRosTemplate::Load(gazebo::physics::ModelPtr model, sdf::ElementPtr sdf)<br>{<br>  &#x2F;&#x2F; Create a GazeboRos node instead of a common ROS node.<br>  &#x2F;&#x2F; Pass it SDF parameters so common options like namespace and remapping<br>  &#x2F;&#x2F; can be handled.<br>  impl_-&gt;ros_node_ &#x3D; gazebo_ros::Node::Get(sdf);<br>  &#x2F;&#x2F; Get QoS profiles<br>  const gazebo_ros::QoS &amp; qos &#x3D; impl_-&gt;ros_node_-&gt;get_qos();<br>  &#x2F;&#x2F; The model pointer gives you direct access to the physics object,<br>  &#x2F;&#x2F; for example:<br>  RCLCPP_INFO(impl_-&gt;ros_node_-&gt;get_logger(), model-&gt;GetName().c_str());<br>  impl_-&gt;sub_ &#x3D; impl_-&gt;ros_node_-&gt;create_subscription&lt;std_msgs::msg::String&gt;(<br>    “elevator”, qos.get_subscription_qos(“elevator”, rclcpp::QoS(1)),<br>    std::bind(&amp;GazeboRosTemplate::OnMsg, this, std::placeholders::_1));<br>  RCLCPP_INFO(impl_-&gt;ros_node_-&gt;get_logger(), “Subscribed to [%s]“, impl_-&gt;sub_-&gt;get_topic_name());<br>  &#x2F;&#x2F; Create a connection so the OnUpdate function is called at every simulation<br>  &#x2F;&#x2F; iteration. Remove this call, the connection and the callback if not needed.<br>  impl_-&gt;update_connection_ &#x3D; gazebo::event::Events::ConnectWorldUpdateBegin(<br>    std::bind(&amp;GazeboRosTemplate::OnUpdate, this));<br>}</p>
<p>在这一块内进行Load的具体实现。在示例中，依次进行了以下操作：</p>
<ul>
<li>创建一个Gazebo_Ros节点，这个Node同时具有ROS节点和Gazebo节点的功能；</li>
<li>Get QoS profiles，QoS是ROS2引入的新机制；</li>
<li>RCLCPP_INFO用来在控制台中打印东西，这里打印了模型的名字；</li>
<li>订阅“elevator这个话题”，将OnMsg这个函数绑定到话题上，每次话题上有新发布时，接受信息并调用函数；</li>
<li>打印订阅的话题名称；</li>
<li>将某个函数绑定到虚拟世界刷新上；</li>
</ul>
<p>void GazeboRosTemplate::OnMsg(const std_msgs::msg::String::ConstSharedPtr msg)<br>{<br>    RCLCPP_INFO(impl_-&gt;ros_node_-&gt;get_logger(), “I heard!”);<br>}</p>
<p>OnMsg函数，需要注意的是，参数应当与Subscriber收取的消息类型一致。这里每次发布话题时，在控制台中打印“I heard!”。</p>
<p>void GazeboRosTemplate::OnUpdate()<br>{<br>  &#x2F;&#x2F; Do something every simulation iteration<br>}</p>
<p>OnUpdate函数。这个函数可以用来让模型作为Publisher向某个ROS节点发布消息，这样就可以获取机器人的一些信息。这里空着。</p>
<h2 id="CMakeLists"><a href="#CMakeLists" class="headerlink" title="CMakeLists"></a>CMakeLists</h2><p>cmake_minimum_required(VERSION 3.5)<br>project(gazebo_plugins)</p>
<h1 id="Default-to-C-14"><a href="#Default-to-C-14" class="headerlink" title="Default to C++14"></a>Default to C++14</h1><p>if(NOT CMAKE_CXX_STANDARD)<br>  set(CMAKE_CXX_STANDARD 14)<br>endif()<br>if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES “Clang”)</p>
<h1 id="we-dont-use-add-compile-options-with-pedantic-in-message-packages"><a href="#we-dont-use-add-compile-options-with-pedantic-in-message-packages" class="headerlink" title="we dont use add_compile_options with pedantic in message packages"></a>we dont use add_compile_options with pedantic in message packages</h1><h1 id="because-the-Python-C-extensions-dont-comply-with-it"><a href="#because-the-Python-C-extensions-dont-comply-with-it" class="headerlink" title="because the Python C extensions dont comply with it"></a>because the Python C extensions dont comply with it</h1><p>  set(CMAKE_CXX_FLAGS “${CMAKE_CXX_FLAGS} -Wall -Wextra -Wpedantic -Wno-inconsistent-missing-override”)<br>endif()</p>
<p>find_package(ament_cmake REQUIRED)<br>find_package(camera_info_manager REQUIRED)<br>find_package(gazebo_dev REQUIRED)<br>find_package(gazebo_msgs REQUIRED)<br>find_package(gazebo_ros REQUIRED)<br>find_package(geometry_msgs REQUIRED)<br>find_package(image_transport REQUIRED)<br>find_package(cv_bridge REQUIRED)<br>find_package(nav_msgs REQUIRED)<br>find_package(rclcpp REQUIRED)<br>find_package(sensor_msgs REQUIRED)<br>find_package(std_msgs REQUIRED)<br>find_package(std_srvs REQUIRED)<br>find_package(tf2 REQUIRED)<br>find_package(tf2_geometry_msgs REQUIRED)<br>find_package(tf2_ros REQUIRED)<br>find_package(trajectory_msgs REQUIRED)</p>
<p>link_directories(${gazebo_dev_LIBRARY_DIRS})</p>
<p>option(ENABLE_PROFILER “Enable Ignition Profiler” FALSE)<br>if(ENABLE_PROFILER)<br>  find_package(ignition-common3 QUIET COMPONENTS profiler)<br>  if(ignition-common3_FOUND)<br>    add_definitions(“-DIGN_PROFILER_ENABLE&#x3D;1” “-DIGN_PROFILER_REMOTERY&#x3D;1”)<br>    message(STATUS “Profiler is active”)<br>  else()<br>    message(WARNING “Can’t find Ignition common3. Profiler will not be actived”)<br>    add_definitions(“-DIGN_PROFILER_ENABLE&#x3D;0” “-DIGN_PROFILER_REMOTERY&#x3D;0”)<br>  endif()<br>endif()</p>
<h1 id="gazebo-ros-template"><a href="#gazebo-ros-template" class="headerlink" title="gazebo_ros_template"></a>gazebo_ros_template</h1><p>add_library(gazebo_ros_test SHARED<br>  gazebo_ros_template.cpp<br>)</p>
<p>target_include_directories(gazebo_ros_test<br>    PUBLIC<br>        ${PROJECT_SOURCE_DIR}&#x2F;include<br>)<br>ament_target_dependencies(gazebo_ros_test<br>  “gazebo_dev”<br>  “gazebo_ros”<br>  “rclcpp”<br>)<br>ament_export_libraries(gazebo_ros_test)</p>
<p>ament_export_include_directories(include)<br>ament_export_dependencies(rclcpp)<br>ament_export_dependencies(gazebo_dev)<br>ament_export_dependencies(gazebo_msgs)<br>ament_export_dependencies(gazebo_ros)</p>
<p>if(NOT WIN32)<br>  if(NOT APPLE)<br>    set(<br>      AMENT_CMAKE_ENVIRONMENT_HOOKS_DESC_gazebo_plugins<br>      “prepend-non-duplicate;LD_LIBRARY_PATH;${GAZEBO_PLUGIN_PATH}”)<br>  else()<br>    set(<br>      AMENT_CMAKE_ENVIRONMENT_HOOKS_DESC_gazebo_plugins<br>      “prepend-non-duplicate;DYLD_LIBRARY_PATH;${GAZEBO_PLUGIN_PATH}”)<br>  endif()<br>endif()</p>
<p>ament_package()</p>
<p>这个CMakeLists.txt经过验证可用。基本上不需要更改，如果引入新的包，可能需要在find_package中加入新的命令。在add_library(gazebo_ros_test SHARED<br>gazebo_ros_template.cpp)中，指定lib的名字，以及源文件的名字。</p>
<h2 id="package-xml"><a href="#package-xml" class="headerlink" title="package.xml"></a>package.xml</h2><?xml version="1.0"?>
<?xml-model href="http://download.ros.org/schema/package\_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>
<package format="3">
  <name>gazebo\_plugins</name>
  <version>3.5.2</version>
  <description>
    Robot-independent Gazebo plugins for sensors, motors and dynamic reconfigurable components.
  </description>

<p>  <maintainer email="jrivero@osrfoundation.org">Jose Luis Rivero</maintainer><br>  <maintainer email="louise@openrobotics.org">Louise Poubel</maintainer></p>
<p>  <license>BSD, Apache 2.0</license></p>
<p>  <url type="website"><a target="_blank" rel="noopener" href="http://gazebosim.org/tutorials?cat=connect%5C_ros">http://gazebosim.org/tutorials?cat=connect\_ros</a></url><br>  <url type="bugtracker"><a target="_blank" rel="noopener" href="https://github.com/ros-simulation/gazebo/_ros/_pkgs/issues">https://github.com/ros-simulation/gazebo\_ros\_pkgs/issues</a></url><br>  <url type="repository"><a target="_blank" rel="noopener" href="https://github.com/ros-simulation/gazebo/_ros/_pkgs">https://github.com/ros-simulation/gazebo\_ros\_pkgs</a></url></p>
<p>  <author>John Hsu</author></p>
<p>  &lt;buildtool_depend&gt;ament_cmake&lt;&#x2F;buildtool_depend&gt;</p>
<p>  <depend>camera_info_manager</depend><br>  <depend>cv_bridge</depend><br>  <depend>geometry_msgs</depend><br>  <depend>image_transport</depend><br>  <depend>nav_msgs</depend><br>  <depend>sensor_msgs</depend><br>  <depend>std_msgs</depend><br>  <depend>std_srvs</depend><br>  <depend>tf2_geometry_msgs</depend><br>  <depend>tf2_ros</depend><br>  <depend>trajectory_msgs</depend></p>
<p>  &lt;build_depend&gt;gazebo_dev&lt;&#x2F;build_depend&gt;<br>  &lt;build_depend&gt;gazebo_msgs&lt;&#x2F;build_depend&gt;<br>  &lt;build_depend&gt;gazebo_ros&lt;&#x2F;build_depend&gt;<br>  &lt;build_depend&gt;rclcpp&lt;&#x2F;build_depend&gt;</p>
<p>  &lt;exec_depend&gt;gazebo_dev&lt;&#x2F;exec_depend&gt;<br>  &lt;exec_depend&gt;gazebo_msgs&lt;&#x2F;exec_depend&gt;<br>  &lt;exec_depend&gt;gazebo_ros&lt;&#x2F;exec_depend&gt;<br>  &lt;exec_depend&gt;rclcpp&lt;&#x2F;exec_depend&gt;</p>
<p>  &lt;test_depend&gt;ament_cmake_gtest&lt;&#x2F;test_depend&gt;<br>  &lt;test_depend&gt;ament_lint_auto&lt;&#x2F;test_depend&gt;<br>  &lt;test_depend&gt;ament_lint_common&lt;&#x2F;test_depend&gt;<br>  &lt;test_depend&gt;cv_bridge&lt;&#x2F;test_depend&gt;</p>
  <export>
    <build\_type>ament\_cmake</build\_type>
  </export>
</package>

<h2 id="文件组织结构"><a href="#文件组织结构" class="headerlink" title="文件组织结构"></a>文件组织结构</h2><p>最终文件树应当如下所示：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-55.png"></p>
<h2 id="试运行"><a href="#试运行" class="headerlink" title="试运行"></a>试运行</h2><p>创建一个简单的world文件：</p>
<?xml version="1.0" ?>
<sdf version="1.5">
  <world name="default">
    <!-- A global light source -->
    <include>
      <uri>model://sun</uri>
    </include>
    <!-- A ground plane -->
    <include>
      <uri>model://ground\_plane</uri>
    </include>

<pre><code>&lt;!-- A testing model that includes the Velodyne sensor model --&gt;
&lt;model name=&quot;my\_velodyne&quot;&gt;
  &lt;include&gt;
    &lt;uri&gt;model://velodyne\_hdl32&lt;/uri&gt;
  &lt;/include&gt;

  &lt;!-- Attach the plugin to this model --&gt;
  &lt;plugin name=&quot;velodyne\_control&quot; filename=&quot;libgazebo\_ros\_test.so&quot;&gt;
    &lt;velocity&gt;1&lt;/velocity&gt;
  &lt;/plugin&gt;
&lt;/model&gt;
</code></pre>
  </world>
</sdf>

<p>模型是什么样的都无所谓，plugin的文件名不能写错。新建一个Terminal:</p>
<p>export GAZEBO_PLUGIN_PATH&#x3D;${GAZEBO_PLUGIN_PATH}:~&#x2F;velodyne_plugin&#x2F;build</p>
<p>然后运行：</p>
<p>gazebo –verbose velodyne.world</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-56-1024x530.png"></p>
<p>相关信息可以正确打印。然后查看一下ROS2的topic：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-57-1024x183.png"></p>
<p>可以看到有一个话题elevator了，我们向这个话题发布一条信息：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-58-1024x111.png"></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-59-1024x274.png"></p>
<p>可以看到，Gazebo成功接收到信息，将反馈打印在了控制台上。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>实际上，ROS2与Gazebo通信的最大问题就在于如何创建一个节点，如何订阅话题，以及如何发布消息。这也是目前网上教程所缺少的。其他的问题，例如如何创建roslaunch文件，如何控制Gazebo中仿真机器人的具体操作，这些都有比较完整的教程。因为ROS2实际上是一个消息管理系统，而非完整的机器人控制系统。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/05/13/ros%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E5%86%99%E4%B8%80%E4%B8%AAtopic%E7%9A%84listner%E4%B8%8Etalker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/13/ros%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E5%86%99%E4%B8%80%E4%B8%AAtopic%E7%9A%84listner%E4%B8%8Etalker/" class="post-title-link" itemprop="url">ROS入门（三）：写一个topic的listner与talker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-13 16:27:34" itemprop="dateCreated datePublished" datetime="2021-05-13T16:27:34+08:00">2021-05-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这一次用C++来写topic的listner与talker。为什么要用C++，因为Gazebo的Plugin是用C++的。</p>
<p>新建一个文件夹，再新建一个src与build文件夹。</p>
<p>mkdir dev_ws<br>cd dev_ws<br>mkdir build<br>mkdir src</p>
<p>在src下新建一个publisher_member_function.cpp：</p>
<p>#include <chrono><br>#include <functional><br>#include <memory><br>#include <string></p>
<p>#include “rclcpp&#x2F;rclcpp.hpp”<br>#include “std_msgs&#x2F;msg&#x2F;string.hpp”</p>
<p>using namespace std::chrono_literals;</p>
<p>&#x2F;* This example creates a subclass of Node and uses std::bind() to register a<br>* member function as a callback from the timer. *&#x2F;</p>
<p>class MinimalPublisher : public rclcpp::Node<br>{<br>  public:<br>    MinimalPublisher()<br>    : Node(“minimal_publisher”), count_(0)<br>    {<br>      publisher_ &#x3D; this-&gt;create_publisher&lt;std_msgs::msg::String&gt;(“topic”, 10);<br>      timer_ &#x3D; this-&gt;create_wall_timer(<br>      500ms, std::bind(&amp;MinimalPublisher::timer_callback, this));<br>    }</p>
<p>  private:<br>    void timer_callback()<br>    {<br>      auto message &#x3D; std_msgs::msg::String();<br>      message.data &#x3D; “Hello, world! “ + std::to_string(count_++);<br>      RCLCPP_INFO(this-&gt;get_logger(), “Publishing: ‘%s’”, message.data.c_str());<br>      publisher_-&gt;publish(message);<br>    }<br>    rclcpp::TimerBase::SharedPtr timer_;<br>    rclcpp::Publisher&lt;std_msgs::msg::String&gt;::SharedPtr publisher_;<br>    size_t count_;<br>};</p>
<p>int main(int argc, char * argv[])<br>{<br>  rclcpp::init(argc, argv);<br>  rclcpp::spin(std::make_shared<MinimalPublisher>());<br>  rclcpp::shutdown();<br>  return 0;<br>}</p>
<p>  public:<br>    MinimalPublisher()<br>    : Node(“minimal_publisher”), count_(0)<br>    {<br>      publisher_ &#x3D; this-&gt;create_publisher&lt;std_msgs::msg::String&gt;(“topic”, 10);<br>      timer_ &#x3D; this-&gt;create_wall_timer(<br>      500ms, std::bind(&amp;MinimalPublisher::timer_callback, this));<br>    }</p>
<p>这个是一个consturctor方法，不需要被显示调用，创建object的时候就会被自动调用。this指的都是Node。</p>
<p>  private:<br>    void timer_callback()<br>    {<br>      auto message &#x3D; std_msgs::msg::String();<br>      message.data &#x3D; “Hello, world! “ + std::to_string(count_++);<br>      RCLCPP_INFO(this-&gt;get_logger(), “Publishing: ‘%s’”, message.data.c_str());<br>      publisher_-&gt;publish(message);<br>    }<br>    rclcpp::TimerBase::SharedPtr timer_;<br>    rclcpp::Publisher&lt;std_msgs::msg::String&gt;::SharedPtr publisher_;<br>    size_t count_;<br>};</p>
<p>这是消息收发的主要函数，首先定义message（定义类都是ROS2中的标准消息类型），赋予message的值，RCLCPP_INFO用于打印在控制台里，然后发送信息。最后还要记得把构造函数里的publisher、timer、count都声明。</p>
<p>int main(int argc, char * argv[])<br>{<br>  rclcpp::init(argc, argv);<br>  rclcpp::spin(std::make_shared<MinimalPublisher>());<br>  rclcpp::shutdown();<br>  return 0;<br>}</p>
<p>主函数里首先初始化ROS2，然后spin相当于不停地调用MinimalPublisher里的private函数。程序退出时要关闭ros2.然后看subscriber的（subscriber_member_function.cpp）：</p>
<p>#include <memory></p>
<p>#include “rclcpp&#x2F;rclcpp.hpp”<br>#include “std_msgs&#x2F;msg&#x2F;string.hpp”<br>using std::placeholders::_1;</p>
<p>class MinimalSubscriber : public rclcpp::Node<br>{<br>  public:<br>    MinimalSubscriber()<br>    : Node(“minimal_subscriber”)<br>    {<br>      subscription_ &#x3D; this-&gt;create_subscription&lt;std_msgs::msg::String&gt;(<br>      “topic”, 10, std::bind(&amp;MinimalSubscriber::topic_callback, this, _1));<br>    }</p>
<p>  private:<br>    void topic_callback(const std_msgs::msg::String::SharedPtr msg) const<br>    {<br>      RCLCPP_INFO(this-&gt;get_logger(), “I heard: ‘%s’”, msg-&gt;data.c_str());<br>    }<br>    rclcpp::Subscription&lt;std_msgs::msg::String&gt;::SharedPtr subscription_;<br>};</p>
<p>int main(int argc, char * argv[])<br>{<br>  rclcpp::init(argc, argv);<br>  rclcpp::spin(std::make_shared<MinimalSubscriber>());<br>  rclcpp::shutdown();<br>  return 0;<br>}</p>
<p>subscriber更简单，因为不需要定时发送消息了，只要把topic上所有的消息都摘下来就行。然后编写CMakeLists，放在dev_ws下：</p>
<p>cmake_minimum_required(VERSION 3.5)<br>project(cpp_pubsub)</p>
<p>Default to C++14<br>if(NOT CMAKE_CXX_STANDARD)<br>  set(CMAKE_CXX_STANDARD 14)<br>endif()</p>
<p>if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES “Clang”)<br>  add_compile_options(-Wall -Wextra -Wpedantic)<br>endif()</p>
<p>find_package(ament_cmake REQUIRED)<br>find_package(rclcpp REQUIRED)<br>find_package(std_msgs REQUIRED)</p>
<p>add_executable(talker src&#x2F;publisher_member_function.cpp)<br>ament_target_dependencies(talker rclcpp std_msgs)<br>add_executable(listener src&#x2F;subscriber_member_function.cpp)<br>ament_target_dependencies(listener rclcpp std_msgs)</p>
<p>install(TARGETS<br>  talker<br>  listener<br>  DESTINATION lib&#x2F;${PROJECT_NAME})</p>
<p>ament_package()</p>
<p>然后进入build文件夹，编译：</p>
<p>cmake ..&#x2F;<br>make</p>
<p>会得到两个可执行文件，一个叫talker，另一个叫listener。分别运行，就可以看到消息传输了，在ros2 topic list中也可以看到&#x2F;topic 话题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/05/12/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9A%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/12/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9A%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">Gazebo入门（七）：插件的使用（二）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-12 09:58:16" itemprop="dateCreated datePublished" datetime="2021-05-12T09:58:16+08:00">2021-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/Robotics/" itemprop="url" rel="index"><span itemprop="name">Robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/Iginition/" itemprop="url" rel="index"><span itemprop="name">Iginition</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Gazebo的可拓展性基本上是插件带来的。插件所做的实际上无非两件事：</p>
<ol>
<li>从模型中读取数据，修改模型的数据；</li>
<li>订阅话题消息，发布消息</li>
</ol>
<p>实际上两件事的效果是一样的，但是如果使用后者就可以连接到ROS。</p>
<p>本节学习如何从零开始写一个插件，最后能够实现在外部操控Gazebo世界中的模型表现。使用的模型是Velodyne，<a target="_blank" rel="noopener" href="http://82.156.1.75/tech/ros/2021/05/02/gazebo%e5%85%a5%e9%97%a8%ef%bc%88%e4%ba%8c%ef%bc%89%ef%bc%9a%e8%87%aa%e5%ae%9a%e4%b9%89%e6%a8%a1%e5%9e%8b/">教程在这里</a>。</p>
<h2 id="最简单的HelloWorld插件"><a href="#最简单的HelloWorld插件" class="headerlink" title="最简单的HelloWorld插件"></a>最简单的HelloWorld插件</h2><p>在一个新文件夹里新建一个velodyne_plugin.cc文件：</p>
<p>#ifndef _VELODYNE_PLUGIN_HH_<br>#define _VELODYNE_PLUGIN_HH_</p>
<p>#include &lt;gazebo&#x2F;gazebo.hh&gt;<br>#include &lt;gazebo&#x2F;physics&#x2F;physics.hh&gt;</p>
<p>namespace gazebo<br>{<br>  &#x2F;&#x2F;&#x2F; \brief A plugin to control a Velodyne sensor.<br>  class VelodynePlugin : public ModelPlugin<br>  {<br>    &#x2F;&#x2F;&#x2F; \brief Constructor<br>    public: VelodynePlugin() {}</p>
<pre><code>/// \\brief The load function is called by Gazebo when the plugin is
/// inserted into simulation
/// \\param\[in\] \_model A pointer to the model that this plugin is
/// attached to.
/// \\param\[in\] \_sdf A pointer to the plugin&#39;s SDF element.
public: virtual void Load(physics::ModelPtr \_model, sdf::ElementPtr \_sdf)
&#123;
  // Just output a message for now
  std::cerr &lt;&lt; &quot;\\nThe velodyne plugin is attach to model\[&quot; &lt;&lt;
    \_model-&gt;GetName() &lt;&lt; &quot;\]\\n&quot;;
&#125;
</code></pre>
<p>  };</p>
<p>  &#x2F;&#x2F; Tell Gazebo about this plugin, so that Gazebo can call Load on this plugin.<br>  GZ_REGISTER_MODEL_PLUGIN(VelodynePlugin)<br>}<br>#endif</p>
<p>#ifndef _VELODYNE_PLUGIN_HH_<br>#define _VELODYNE_PLUGIN_HH_<br>&#x2F;&#x2F;your codes here<br>#endif</p>
<p>这里是防止被重复定义导致编译错误。</p>
<p>#include &lt;gazebo&#x2F;gazebo.hh&gt;<br>#include &lt;gazebo&#x2F;physics&#x2F;physics.hh&gt;</p>
<p>这是我们使用的两个头文件，gazebo.hh包括一些核心组件，physics.hh包括与物理世界交互的一些功能。其他常用的头文件还有common.hh, transport.hh等。</p>
<p>所有的插件的命名空间都是gazebo。根据插件种类的不同，其继承的类也不同，一共有六种类，参照上一节。</p>
<p>一个最简单的插件包括两个方法：与类同名的方法，在这里是VelodynePlugin()，还有Load方法。可以把Load方法看作是主函数。由于这是一个ModelPlugin，Load方法主要会读取model和sdf的参数，这里的model实际上就是sdf文件里的model块，之后会验证这一点。</p>
<p>然后创建一个CMakeLists.txt:</p>
<p>cmake_minimum_required(VERSION 2.8 FATAL_ERROR)</p>
<h1 id="Find-Gazebo"><a href="#Find-Gazebo" class="headerlink" title="Find Gazebo"></a>Find Gazebo</h1><p>find_package(gazebo REQUIRED)<br>include_directories(${GAZEBO_INCLUDE_DIRS})<br>link_directories(${GAZEBO_LIBRARY_DIRS})<br>set(CMAKE_CXX_FLAGS “${CMAKE_CXX_FLAGS} ${GAZEBO_CXX_FLAGS}”)</p>
<h1 id="Build-our-plugin"><a href="#Build-our-plugin" class="headerlink" title="Build our plugin"></a>Build our plugin</h1><p>add_library(velodyne_plugin SHARED velodyne_plugin.cc)<br>target_link_libraries(velodyne_plugin ${GAZEBO_LIBRARIES})</p>
<p>编译过程上一节里有，就不再重复了。然后新建一个velodyne.world：</p>
<?xml version="1.0" ?>
<sdf version="1.5">
  <world name="default">
    <!-- A global light source -->
    <include>
      <uri>model://sun</uri>
    </include>
    <!-- A ground plane -->
    <include>
      <uri>model://ground\_plane</uri>
    </include>

<pre><code>&lt;!-- A testing model that includes the Velodyne sensor model --&gt;
&lt;model name=&quot;my\_velodyne&quot;&gt;
  &lt;include&gt;
    &lt;uri&gt;model://velodyne\_hdl32&lt;/uri&gt;
  &lt;/include&gt;

  &lt;!-- Attach the plugin to this model --&gt;
  &lt;plugin name=&quot;velodyne\_control&quot; filename=&quot;libvelodyne\_plugin.so&quot;/&gt;
&lt;/model&gt;
</code></pre>
  </world>
</sdf>

<p>这是一个model plugin，所以插入在model中，名字可以随便取，但是文件名不要搞错了。文件名就是编译得到的文件，在build文件夹下。</p>
<p>在运行这个世界文件前，还要把插件所在目录，也就是build加入到Gazebo的插件环境路径下，参照上一节。运行世界时加上参数–verbose，就可以看到输出：</p>
<p>The velodyne plugin is attached to model[my_velodyne]</p>
<h2 id="使用插件改变模型的属性"><a href="#使用插件改变模型的属性" class="headerlink" title="使用插件改变模型的属性"></a>使用插件改变模型的属性</h2><p>插件是通过修改SDF文件来改变模型的属性的。回到刚刚的插件源文件velodyne_plugin.cc，修改Load函数：</p>
<p>public: virtual void Load(physics::ModelPtr _model, sdf::ElementPtr _sdf)<br>{<br>  &#x2F;&#x2F; Safety check<br>  if (_model-&gt;GetJointCount() &#x3D;&#x3D; 0)<br>  {<br>    std::cerr &lt;&lt; “Invalid joint count, Velodyne plugin not loaded\n”;<br>    return;<br>  }</p>
<p>  &#x2F;&#x2F; Store the model pointer for convenience.<br>  this-&gt;model &#x3D; _model;</p>
<p>  &#x2F;&#x2F; Get the first joint. We are making an assumption about the model<br>  &#x2F;&#x2F; having one joint that is the rotational joint.<br>  this-&gt;joint &#x3D; _model-&gt;GetJoints()[0];</p>
<p>  &#x2F;&#x2F; Setup a P-controller, with a gain of 0.1.<br>  this-&gt;pid &#x3D; common::PID(0.1, 0, 0);</p>
<p>  &#x2F;&#x2F; Apply the P-controller to the joint.<br>  this-&gt;model-&gt;GetJointController()-&gt;SetVelocityPID(<br>      this-&gt;joint-&gt;GetScopedName(), this-&gt;pid);</p>
<p>  &#x2F;&#x2F; Set the joint’s target velocity. This target velocity is just<br>  &#x2F;&#x2F; for demonstration purposes.<br>  this-&gt;model-&gt;GetJointController()-&gt;SetVelocityTarget(<br>      this-&gt;joint-&gt;GetScopedName(), 10.0);<br>}</p>
<p>Load函数接收model和sdf作为输入。在阅读代码的过程中，查阅<a target="_blank" rel="noopener" href="http://osrf-distributions.s3.amazonaws.com/gazebo/api/11.0.0/index.html">Gazebo’s Document</a>是很必要的。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-40-1024x622.png"></p>
<p>if (_model-&gt;GetJointCount() &#x3D;&#x3D; 0)比如这一句，这个_model属于physics::ModelPtr，因此在physics modules中找到Model。我指针学的不太好，为什么_model是ModelPtr类却可以使用Model的方法，我不太清楚。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-41-1024x238.png"></p>
<p>然后可以找到这个方法：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-42-1024x199.png"></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-43-1024x460.png"></p>
<p>这样就可以理解了。同理，其他的方法：</p>
<ul>
<li>GetJoints()</li>
</ul>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-44-1024x250.png"></p>
<p>返回关节的向量（？）</p>
<ul>
<li>GetJointController()</li>
</ul>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-45-1024x226.png"></p>
<p>返回Controller的handle。handle是什么？参考一下他人的解释：</p>
<blockquote>
<p>知道了HANDLE的本质(一个32位的整数,用16进制表示),再来说说HANDLE的作用.看我前面第二段的例子,你可以了解到为了控制一个物体,你需要找到它的”手柄”.HANDLE就是充当win32下各种”物体”的”手柄”.事实上,很多windows API都需要一个HANDLE作为输入参数,这是因为API需要和一些你看不见的对象打交道,这些对象是不能被你所移动或修改的,所以不能给你一个指针来对它进行操作.oh,指针的确是个好东西,它所拥有的能力实在太强大了,但所谓能力越大,责任越大,使用指针的时候千万要小心,不然会造成毁灭性的错误.所以,为了安全,还是给你一个HANDLE吧,通过这个HANDLE,你就可以对那些对象进行一些处理.HANDLE在这里充当什么角色呢?应该算是一个中间人吧,HANDLE是固定的,它不会变,但是对象的地址会变,当对象在内存中的位置发生改变后,我们不能通过之前的对象指针找到对象,怎么办呢?嗯,这时候HANDLE的用处就出来了,HANDLE就是用来记录对象的最新地址的.有点明白了吧?换一种说法吧,嗯,其实就是你知道HANDLE在哪里,但你不知道对象在哪里,而HANDLE知道对象在哪里,所以,只要你知道了HANDLE在哪里,你就能找到对象(尽管你还是不知那个对象住在内存的哪个地方,不过找到它就行了,不是吗?).嗯,是不是有点像索引的作用呢?为什么不给我们知道对象在内存中的位置呢?呵呵,<a target="_blank" rel="noopener" href="http://lib.csdn.net/base/operatingsystem">操作系统</a>怕你对它进行一些不利的操作啊.反正你通过HANDLE能让对象做它应该做的事,这就足够了.这就是封装吧,MS最喜欢做的事情,呵呵.</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq/_39584315/article/details/81909135">https://blog.csdn.net/qq\_39584315/article/details/81909135</a></p>
</blockquote>
<p>简单地说，有了handle就可以操控我们的对象了。</p>
<ul>
<li>SetVelocityPID()</li>
</ul>
<p>这个方法属于JointController类：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-46-1024x285.png"></p>
<p>它接受关节名称和common::PID作为输入。</p>
<ul>
<li>GetScopedName()</li>
</ul>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-47-1024x275.png"></p>
<p>这个方法会返回一个SDF中某个element的名称，以一种类似“绝对路径”的方式。</p>
<ul>
<li>SetVelocityTarget()</li>
</ul>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-48-1024x299.png"></p>
<p>这个方法也属于JointController，接受jointname和一个double数值作为输入，用来控制PID。</p>
<p>这样看下来，是不是其实很明了了？重新编译后运行，再打开世界文件就可以看到模型旋转了。</p>
<h2 id="Plugin与SDF交互"><a href="#Plugin与SDF交互" class="headerlink" title="Plugin与SDF交互"></a>Plugin与SDF交互</h2><p>我们通过Plugin实现了对模型关节的操控，这很好，但是如果我们想改变转速，就要重新编译。更进一步的做法是，让Plugin从SDF中读取数据，这样通过修改SDF就可以改变模型的转速了。</p>
<p>首先修改world文件中的<plugin>：</p>
<plugin name="velodyne\_control" filename="libvelodyne\_plugin.so">
  <velocity>25</velocity>
</plugin>

<p>然后修改plugin文件：</p>
<p>&#x2F;&#x2F; Default to zero velocity<br>double velocity &#x3D; 0;</p>
<p>&#x2F;&#x2F; Check that the velocity element exists, then read the value<br>if (_sdf-&gt;HasElement(“velocity”))<br>  velocity &#x3D; _sdf-&gt;Get<double>(“velocity”);</p>
<p>&#x2F;&#x2F; Set the joint’s target velocity. This target velocity is just<br>&#x2F;&#x2F; for demonstration purposes.<br>this-&gt;model-&gt;GetJointController()-&gt;SetVelocityTarget(<br>    this-&gt;joint-&gt;GetScopedName(), velocity);</p>
<p>来看看这些引入的新方法，他们都是属于SDF这个类的。这些方法得到<a target="_blank" rel="noopener" href="http://osrf-distributions.s3.amazonaws.com/sdformat/api/11.0.0/index.html">SDF的API文档里找</a>：</p>
<ul>
<li>HasElement()</li>
</ul>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-49-1024x323.png"></p>
<p>Element类的方法，返回布尔值。</p>
<ul>
<li>Get()</li>
</ul>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-50-1024x339.png"></p>
<p>根据标签名称（Key）返回所属值。</p>
<p>重新编译后，更改world文件里的值，旋转速度也会变化。</p>
<h2 id="创建API"><a href="#创建API" class="headerlink" title="创建API"></a>创建API</h2><p>我们只需要修改SDF文件就可以改变模型的转速，这很好，但是我们想再进一步，通过外部命令来改变模型的转速。这又该如何去做呢？我们有两种方法做到这一点：</p>
<ul>
<li>第一种方式是通过message传递。Gazebo与ROS有相似的message传递机制，包括topic、publisher、subscriber。Plugin可以充当一个Node的角色，接受topic传来的消息，并向topic发布消息来实现这一点。这种方式适合进程间通信。</li>
<li>第二种方式是通过function。我们将会在原Plugin里创建一个新的function来调整参数，然后再新建一个Plugin，让他继承原来的Plugin。我们让Gazebo读取这个子插件，然后就可以通过调用function来改变参数了。这种方式在Gazebo-ROS中比较常见。</li>
</ul>
<p>我们需要引入新的包了。这是最终的plugin源文件：</p>
<p>#ifndef _VELODYNE_PLUGIN_HH_<br>#define _VELODYNE_PLUGIN_HH_</p>
<p>#include &lt;gazebo&#x2F;gazebo.hh&gt;<br>#include &lt;gazebo&#x2F;physics&#x2F;physics.hh&gt;<br>#include &lt;gazebo&#x2F;transport&#x2F;transport.hh&gt;<br>#include &lt;gazebo&#x2F;msgs&#x2F;msgs.hh&gt;</p>
<p>namespace gazebo<br>{<br>  &#x2F;&#x2F;&#x2F; \brief A plugin to control a Velodyne sensor.<br>  class VelodynePlugin : public ModelPlugin<br>  {<br>    &#x2F;&#x2F;&#x2F; \brief Constructor<br>    public: VelodynePlugin() {}</p>
<pre><code>/// \\brief The load function is called by Gazebo when the plugin is
/// inserted into simulation
/// \\param\[in\] \_model A pointer to the model that this plugin is
/// attached to.
/// \\param\[in\] \_sdf A pointer to the plugin&#39;s SDF element.
public: virtual void Load(physics::ModelPtr \_model, sdf::ElementPtr \_sdf)
&#123;
  // Safety check
  if (\_model-&gt;GetJointCount() == 0)
  &#123;
    std::cerr &lt;&lt; &quot;Invalid joint count, Velodyne plugin not loaded\\n&quot;;
    return;
  &#125;

  // Store the model pointer for convenience.
  this-&gt;model = \_model;

  // Get the first joint. We are making an assumption about the model
  // having one joint that is the rotational joint.
  this-&gt;joint = \_model-&gt;GetJoints()\[0\];

  // Setup a P-controller, with a gain of 0.1.
  this-&gt;pid = common::PID(0.1, 0, 0);

  // Apply the P-controller to the joint.
  this-&gt;model-&gt;GetJointController()-&gt;SetVelocityPID(
      this-&gt;joint-&gt;GetScopedName(), this-&gt;pid);

  // Default to zero velocity
  double velocity = 0;

  // Check that the velocity element exists, then read the value
  if (\_sdf-&gt;HasElement(&quot;velocity&quot;))
    velocity = \_sdf-&gt;Get&lt;double&gt;(&quot;velocity&quot;);

  this-&gt;SetVelocity(velocity);

  // Create the node
  this-&gt;node = transport::NodePtr(new transport::Node());
  #if GAZEBO\_MAJOR\_VERSION &lt; 8
  this-&gt;node-&gt;Init(this-&gt;model-&gt;GetWorld()-&gt;GetName());
  #else
  this-&gt;node-&gt;Init(this-&gt;model-&gt;GetWorld()-&gt;Name());
  #endif

  // Create a topic name
  std::string topicName = &quot;~/&quot; + this-&gt;model-&gt;GetName() + &quot;/vel\_cmd&quot;;

  // Subscribe to the topic, and register a callback
  this-&gt;sub = this-&gt;node-&gt;Subscribe(topicName,
     &amp;VelodynePlugin::OnMsg, this);
&#125;

/// \\brief Set the velocity of the Velodyne
/// \\param\[in\] \_vel New target velocity
public: void SetVelocity(const double &amp;\_vel)
&#123;
  // Set the joint&#39;s target velocity.
  this-&gt;model-&gt;GetJointController()-&gt;SetVelocityTarget(
      this-&gt;joint-&gt;GetScopedName(), \_vel);
&#125;

/// \\brief Handle incoming message
/// \\param\[in\] \_msg Repurpose a vector3 message. This function will
/// only use the x component.
private: void OnMsg(ConstVector3dPtr &amp;\_msg)
&#123;
  this-&gt;SetVelocity(\_msg-&gt;x());
&#125;

/// \\brief A node used for transport
private: transport::NodePtr node;

/// \\brief A subscriber to a named topic.
private: transport::SubscriberPtr sub;

/// \\brief Pointer to the model.
private: physics::ModelPtr model;

/// \\brief Pointer to the joint.
private: physics::JointPtr joint;

/// \\brief A PID controller for the joint.
private: common::PID pid;
</code></pre>
<p>  };</p>
<p>  &#x2F;&#x2F; Tell Gazebo about this plugin, so that Gazebo can call Load on this plugin.<br>  GZ_REGISTER_MODEL_PLUGIN(VelodynePlugin)<br>}<br>#endif</p>
<p>多了很多新方法，我们一个一个来看，先看下面这个新区块：</p>
<pre><code>  // Create the node
  this-&gt;node = transport::NodePtr(new transport::Node());
  #if GAZEBO\_MAJOR\_VERSION &lt; 8
  this-&gt;node-&gt;Init(this-&gt;model-&gt;GetWorld()-&gt;GetName());
  #else
  this-&gt;node-&gt;Init(this-&gt;model-&gt;GetWorld()-&gt;Name());
  #endif
</code></pre>
<ul>
<li>NodePtr</li>
</ul>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-51-1024x312.png"></p>
<p>Node和ROS中概念是一样的。</p>
<ul>
<li>Init()</li>
</ul>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-52-1024x245.png"></p>
<p>初始化节点，这里设置的其实是话题的命名空间。代码里使用了世界的名称来命名它。</p>
<pre><code>  // Subscribe to the topic, and register a callback
  this-&gt;sub = this-&gt;node-&gt;Subscribe(topicName,
     &amp;VelodynePlugin::OnMsg, this);
</code></pre>
<ul>
<li>Subscribe()</li>
</ul>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-53-1024x364.png"></p>
<p>Subscribe()有好几种使用方法，这里使用的应该是这一种：输入参数为话题名称、接受话题所使用的方法，以及一个latching参数（这个参数在任何一种subscribe里都有）。返回的是一个指针，指向一个Subscribe object。所以将其赋予this-&gt;sub。</p>
<p>接下来需要向”~&#x2F;“ + this-&gt;model-&gt;GetName() + “&#x2F;vel_cmd”这个话题发布消息。新建一个vel.cc：</p>
<p>#include &lt;gazebo&#x2F;gazebo_config.h&gt;<br>#include &lt;gazebo&#x2F;transport&#x2F;transport.hh&gt;<br>#include &lt;gazebo&#x2F;msgs&#x2F;msgs.hh&gt;</p>
<p>&#x2F;&#x2F; Gazebo’s API has changed between major releases. These changes are<br>&#x2F;&#x2F; accounted for with #if..#endif blocks in this file.<br>#if GAZEBO_MAJOR_VERSION &lt; 6<br>#include &lt;gazebo&#x2F;gazebo.hh&gt;<br>#else<br>#include &lt;gazebo&#x2F;gazebo_client.hh&gt;<br>#endif</p>
<p>&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;<br>int main(int _argc, char **_argv)<br>{<br>  &#x2F;&#x2F; Load gazebo as a client<br>#if GAZEBO_MAJOR_VERSION &lt; 6<br>  gazebo::setupClient(_argc, _argv);<br>#else<br>  gazebo::client::setup(_argc, _argv);<br>#endif</p>
<p>  &#x2F;&#x2F; Create our node for communication<br>  gazebo::transport::NodePtr node(new gazebo::transport::Node());<br>  node-&gt;Init();</p>
<p>  &#x2F;&#x2F; Publish to the  velodyne topic<br>  gazebo::transport::PublisherPtr pub &#x3D;<br>    node-&gt;Advertise<a href="gazebo::msgs::Vector3d">gazebo::msgs::Vector3d</a>(“~&#x2F;my_velodyne&#x2F;vel_cmd”);</p>
<p>  &#x2F;&#x2F; Wait for a subscriber to connect to this publisher<br>  pub-&gt;WaitForConnection();</p>
<p>  &#x2F;&#x2F; Create a a vector3 message<br>  gazebo::msgs::Vector3d msg;</p>
<p>  &#x2F;&#x2F; Set the velocity in the x-component<br>#if GAZEBO_MAJOR_VERSION &lt; 6<br>  gazebo::msgs::Set(&amp;msg, gazebo::math::Vector3(std::atof(_argv[1]), 0, 0));<br>#else<br>  gazebo::msgs::Set(&amp;msg, ignition::math::Vector3d(std::atof(_argv[1]), 0, 0));<br>#endif</p>
<p>  &#x2F;&#x2F; Send the message<br>  pub-&gt;Publish(msg);</p>
<p>  &#x2F;&#x2F; Make sure to shut everything down.<br>#if GAZEBO_MAJOR_VERSION &lt; 6<br>  gazebo::shutdown();<br>#else<br>  gazebo::client::shutdown();<br>#endif<br>}</p>
<p>  gazebo::transport::NodePtr node(new gazebo::transport::Node());<br>  node-&gt;Init();</p>
<p>首先创建了一个Node作为发送节点。</p>
<p>  &#x2F;&#x2F; Publish to the  velodyne topic<br>  gazebo::transport::PublisherPtr pub &#x3D;<br>    node-&gt;Advertise<a href="gazebo::msgs::Vector3d">gazebo::msgs::Vector3d</a>(“~&#x2F;my_velodyne&#x2F;vel_cmd”);</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-54-1024x488.png"></p>
<p>输入话题的名称，返回Publisher的指针。然后向该话题发布消息即可。</p>
<p>修改CMakeLists.txt，加入：</p>
<p># Build the stand-alone test program<br>add_executable(vel vel.cc)</p>
<p>if (${gazebo_VERSION_MAJOR} LESS 6)</p>
<h1 id="These-two"><a href="#These-two" class="headerlink" title="These two"></a>These two</h1><p>  include(FindBoost)<br>  find_package(Boost ${MIN_BOOST_VERSION} REQUIRED system filesystem regex)<br>  target_link_libraries(vel ${GAZEBO_LIBRARIES} ${Boost_LIBRARIES})<br>else()<br>  target_link_libraries(vel ${GAZEBO_LIBRARIES})<br>endif()</p>
<p>将vel.cc编译成vel可执行文件。编译之后重新执行world文件，然后用vel控制转速：</p>
<p>cd ~&#x2F;velodyne_plugin&#x2F;build<br>.&#x2F;vel 2</p>
<p>可以看到转速改变了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/05/08/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9A%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/08/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9A%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">Gazebo入门（六）：插件的使用（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-08 21:27:15" itemprop="dateCreated datePublished" datetime="2021-05-08T21:27:15+08:00">2021-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>插件，Plugin，实际上类似于Python中的包。简单地说，插件通过调用Gazebo的接口来完成对Gazebo仿真各个方面的操控，并且可以分享给其他使用者，其他使用者可以方便地在系统中插入插件。插件使用C++语言。</p>
<p>插件有六类，代表着它们能够影响的六种组成Gazebo仿真世界的部分：</p>
<ul>
<li>world</li>
<li>model</li>
<li>sensor</li>
<li>system</li>
<li>visual</li>
<li>GUI</li>
</ul>
<p>如果想要调整世界的一些参数，比如物理效果、光照等，就需要world plugin；如果要调整模型的参数，比如模型运动状态、关节的运动状态，就需要model plugin；如果要获取传感器数据或者改变传感器的参数，就需要sensor plugin。</p>
<h2 id="第一个Plugin"><a href="#第一个Plugin" class="headerlink" title="第一个Plugin"></a>第一个Plugin</h2><p>创建一个hello_world.cc文件：</p>
<p>#include &lt;gazebo&#x2F;gazebo.hh&gt;</p>
<p>namespace gazebo<br>{<br>    class WorldPluginTutorial : public WorldPlugin<br>    {<br>        public: WorldPluginTutorial() : WorldPlugin()<br>        {<br>            printf(“Hello World!\n”);<br>        }</p>
<pre><code>    public: void Load(physics::WorldPtr \_world, sdf::ElementPtr \_sdf)
    &#123;
    &#125;
&#125;;
GZ\_REGISTER\_WORLD\_PLUGIN(WorldPluginTutorial)
</code></pre>
<p>}</p>
<p>首先导入了gazebo&#x2F;gazebo.hh包，这个包包含了gazebo的核心功能，不过不包括具体的物理、传感器功能，后者需要根据情况额外导入<code>gazebo/physics/physics.hh</code>, <code>gazebo/rendering/rendering.hh</code>, or <code>gazebo/sensors/sensors.hh</code>。所有的插件都必须是以gazebo作为namespace的。</p>
<p>所有的插件都必须从上面说的六种插件类型中选择一个集成，这个例子中是WorldPlugin。</p>
<p>Load函数的功能：插件要实现的功能写在里面，需要与sdf进行交互。这个插件没有任何功能，也不load任何sdf，只是打印一条hello world。</p>
<p>最后要将这个插件注册，变量名称就是插件名。一共有六种注册类型：<code>GZ_REGISTER_WORLD_PLUGIN</code>,<code>GZ_REGISTER_MODEL_PLUGIN</code>, <code>GZ_REGISTER_SENSOR_PLUGIN</code>, <code>GZ_REGISTER_GUI_PLUGIN</code>, <code>GZ_REGISTER_SYSTEM_PLUGIN</code> and <code>GZ_REGISTER_VISUAL_PLUGIN</code>.</p>
<h3 id="编译插件"><a href="#编译插件" class="headerlink" title="编译插件"></a>编译插件</h3><p>新建一个CMakeLists.txt:</p>
<p>cmake_minimum_required(VERSION 2.8 FATAL_ERROR)</p>
<p>find_package(gazebo REQUIRED)<br>include_directories(${GAZEBO_INCLUDE_DIRS})<br>link_directories(${GAZEBO_LIBRARY_DIRS})<br>list(APPEND CMAKE_CXX_FLAGS “${GAZEBO_CXX_FLAGS}”)</p>
<p>add_library(hello_world SHARED hello_world.cc)<br>target_link_libraries(hello_world ${GAZEBO_LIBRARIES})</p>
<p>这个脚本里只有命名需要改变。</p>
<p>然后在当前目录新建一个build文件夹，进入，编译：</p>
<p>cmake ..&#x2F;<br>make</p>
<p>在build下生成了libhello_world.so这个库。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-36-1024x628.png"></p>
<p>将当前路径设为<code>GAZEBO_PLUGIN_PATH</code>环境变量，这样Gazebo能够根据插件名找到这个插件。这个命令只在当前shell下有效。</p>
<p>export GAZEBO_PLUGIN_PATH&#x3D;${GAZEBO_PLUGIN_PATH}:~&#x2F;gazebo_plugin_tutorial&#x2F;build</p>
<h3 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件"></a>使用插件</h3><p>新建一个world：</p>
<?xml version="1.0"?>
<sdf version="1.4">
  <world name="default">
    <plugin name="hello\_world" filename="libhello\_world.so"/>
  </world>
</sdf>

<p>用gzserver运行：</p>
<p>gzserver hello.world –verbose</p>
<p>输出：</p>
<p>[Msg] Waiting for master.<br>[Msg] Connected to gazebo master @ <a target="_blank" rel="noopener" href="http://127.0.0.1:11345/">http://127.0.0.1:11345</a><br>[Msg] Publicized address: 183.172.23.231<br>[Msg] Loading world file [&#x2F;home&#x2F;shaw&#x2F;Desktop&#x2F;gazebo&#x2F;gazebo_plugin&#x2F;hello.world]<br>Hello World!</p>
<h2 id="模型插件Model-Plugin"><a href="#模型插件Model-Plugin" class="headerlink" title="模型插件Model Plugin"></a>模型插件Model Plugin</h2><p>Model Plugin可以用来控制模型，比如小车的运行、碰撞体积等。下面来做一个控制速度的插件，将这个插件插入一个model后，就可以用来控制model的速度。</p>
<h3 id="插件编写"><a href="#插件编写" class="headerlink" title="插件编写"></a>插件编写</h3><p>#include <functional><br>#include &lt;gazebo&#x2F;gazebo.hh&gt;<br>#include &lt;gazebo&#x2F;physics&#x2F;physics.hh&gt;<br>#include &lt;gazebo&#x2F;common&#x2F;common.hh&gt;<br>#include &lt;ignition&#x2F;math&#x2F;Vector3.hh&gt;</p>
<p>namespace gazebo<br>{<br>    class ModelPush : public ModelPlugin<br>    {<br>        public: void Load(physics::ModelPtr _parent, sdf::ElementPtr)<br>        {<br>            this-&gt;model &#x3D; _parent;<br>            this-&gt;updateConnection &#x3D; event::Events::ConnectWorldUpdateBegin(<br>                std::bind(&amp;ModelPush::OnUpdate, this)<br>            );<br>        }</p>
<pre><code>    public: void OnUpdate()
    &#123;
        this-&gt;model-&gt;SetLinearVel(ignition::math::Vector3d(.3, 0, 0));
    &#125;

    private: physics::ModelPtr model;
    private: event::ConnectionPtr updateConnection;
&#125;;
GZ\_REGISTER\_MODEL\_PLUGIN(ModelPush)
</code></pre>
<p>}</p>
<p>CMakeLists.txt和前面一样，直接加在后面。</p>
<p>add_library(model_push SHARED model_push.cc)<br>target_link_libraries(model_push ${GAZEBO_LIBRARIES})</p>
<p>在world文件里加入一个盒子：</p>
<?xml version="1.0"?><sdf version="1.4">
  <world name="default">

<pre><code>&lt;!-- Ground Plane --&gt;
&lt;include&gt;
  &lt;uri&gt;model://ground\_plane&lt;/uri&gt;
&lt;/include&gt;

&lt;include&gt;
  &lt;uri&gt;model://sun&lt;/uri&gt;
&lt;/include&gt;

&lt;model name=&quot;box&quot;&gt;
  &lt;pose&gt;0 0 0.5 0 0 0&lt;/pose&gt;
  &lt;link name=&quot;link&quot;&gt;
    &lt;collision name=&quot;collision&quot;&gt;
      &lt;geometry&gt;
        &lt;box&gt;
          &lt;size&gt;1 1 1&lt;/size&gt;
        &lt;/box&gt;
      &lt;/geometry&gt;
    &lt;/collision&gt;

    &lt;visual name=&quot;visual&quot;&gt;
      &lt;geometry&gt;
        &lt;box&gt;
          &lt;size&gt;1 1 1&lt;/size&gt;
        &lt;/box&gt;
      &lt;/geometry&gt;
    &lt;/visual&gt;
  &lt;/link&gt;

  &lt;plugin name=&quot;model\_push&quot; filename=&quot;libmodel\_push.so&quot;/&gt;
&lt;/model&gt;        
</code></pre>
  </world>
</sdf>

<p>插件加在model里，比如</model>的前面一行。用Gazebo运行这个world文件，能看到一个运动的盒子：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-37-1024x543.png"></p>
<p>在下一节继续学习Plugin。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/05/05/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9A%E8%BD%BD%E5%85%A5revit%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/05/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9A%E8%BD%BD%E5%85%A5revit%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">Gazebo入门（五）：载入Revit模型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-05 16:03:42" itemprop="dateCreated datePublished" datetime="2021-05-05T16:03:42+08:00">2021-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/" itemprop="url" rel="index"><span itemprop="name">bolgs</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bolgs/BIM/" itemprop="url" rel="index"><span itemprop="name">BIM</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Revit可以用于建筑建模，将Revit中的建筑模型导入Gazebo，即可以创造较为精细的模拟环境。这也是BIM-ROS仿真的必须工作。</p>
<h2 id="从Revit导出-dae模型"><a href="#从Revit导出-dae模型" class="headerlink" title="从Revit导出.dae模型"></a>从Revit导出.dae模型</h2><p>下载lumion-revit插件：<a target="_blank" rel="noopener" href="https://lumion3d.com/revit-to-lumion-bridge/">https://lumion3d.com/revit-to-lumion-bridge/</a>，基本上支持所有的Revit版本。安装完成后，在lumion插件页点击export即可导出dae模型：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-27-1024x499.png"></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-26-1024x179.png"></p>
<p>可以用Blender打开dae模型查看是否导出成功，选择import-collada：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-28-1024x523.png"></p>
<p>因为我对Blender也不太熟，不太清楚为什么不显示材质。实际上应该是有显示的，只是现在没有光照。切换成Texture Paint页面就能看到材质了。(但是在Ubuntu下还是无法显示）。</p>
<h2 id="将建筑模型插入到Gazebo"><a href="#将建筑模型插入到Gazebo" class="headerlink" title="将建筑模型插入到Gazebo"></a>将建筑模型插入到Gazebo</h2><p>在Blender中将模型导出为STL格式，经过验证，obj或者dae格式的模型导入都会存在错误。这个过程中会丢失材质，暂时没有找到解决办法。</p>
<p>随后新建一个xxx.world文件，输入：</p>
<?xml version="1.0"?>
<sdf version="1.4">
  <world name="sample\_world">
    <include>
      <uri>model://sun</uri>
    </include>
    <include>
      <uri>model://ground\_plane</uri>
    </include>
    <model name="building">
      <pose>0 0 0 0 0 0</pose>
      <static>true</static>
      <link name="link">
        <visual name="visual">
          <geometry>
            <mesh><uri>file://building.stl</uri></mesh>
          </geometry>
        </visual>
        <collision name="collision">
          <geometry>
            <mesh><uri>file://building.stl</uri></mesh>
          </geometry>
        </collision>
      </link>
    </model>
  </world>
</sdf>

<p>将visual和collision的几何形状都指向stl文件，将stl文件与world文件放在一个文件夹下。还需要指定<static>true</static>.在当前文件下运行：</p>
<p>gazebo sample.world</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-29-1024x340.png"></p>
<p>模型显示正常。美中不足的地方是，建筑物变成封闭的了，因为门窗都是关闭的。一种解决办法是，在Blender中删除所有的门窗，然后再导出，效果如图：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-30-1024x331.png"></p>
<p>就完成了BIM模型在Gazebo中的导入工作。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/05/05/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E8%BF%9E%E6%8E%A5%E5%88%B0ros2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/05/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E8%BF%9E%E6%8E%A5%E5%88%B0ros2/" class="post-title-link" itemprop="url">Gazebo入门（四）：连接到ROS2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-05 15:58:29" itemprop="dateCreated datePublished" datetime="2021-05-05T15:58:29+08:00">2021-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>为什么要将Gazebo连接到ROS？实际上是为了自动化脚本的实现。Gazebo虽然是独立于ROS的，但是其功能组成是遵循ROS的设计理念的，比如之前我们就有用过Topic的功能，而Topic是ROS中的消息收发机制。</p>
<p>ROS有ROS1与ROS2之分，两个都有LTS版本，所以理论上说选择任何一个都是可以的。ROS提供了C++脚本作为API与Gazebo沟通（可能是出于处理效率的考虑），但我们可以可以选择python或者c++写ROS脚本。但是要说明的是，并不是所有的ROS1功能都已经被ROS2支持了。造成这一点的原因是ROS2改进了ROS1的设计架构，一些古老的功能反而不再支持了。我是用的是ROS2 foxy。</p>
<p>回顾一下ROS中Package的概念，实际上它类似于Python的module，也就是一些提前写好的脚本，可以直接使用而不需要自己输入大量的命令。ROS2提供了<code>gazebo_ros_pkgs</code>作为API，这个metapackage包括：</p>
<ul>
<li><code>gazebo_dev</code>: Provides a cmake configuration for the default version of Gazebo for the ROS distribution. So downstream packages can just depend on <code>gazebo_dev</code> instead of needing to find Gazebo by themselves.</li>
<li><code>gazebo_msgs</code>: Message and service data structures for interacting with Gazebo from ROS 2. gazebo和ros2之间互相传输信息的包</li>
<li><code>gazebo_ros</code>: Provides convenient C++ classes and functions which can be used by other plugins, such as <code>gazebo_ros::Node</code>, conversion and testing utilities. It also provides some generally useful plugins.</li>
<li><code>gazebo_plugins</code>: A series of Gazebo plugins exposing sensors and other features to ROS 2. For example, <code>gazebo_ros_camera</code> publishes ROS 2 images, and <code>gazebo_ros_diff_drive</code> provides an interface for controlling and instrospecting differential drive robots through ROS 2.</li>
</ul>
<p>这些包也有Python的版本，不熟悉C++也不用慌。</p>
<h2 id="ROS与Gazebo版本之间的对应"><a href="#ROS与Gazebo版本之间的对应" class="headerlink" title="ROS与Gazebo版本之间的对应"></a>ROS与Gazebo版本之间的对应</h2><p>开始之前，确保Gazebo和ROS之间版本是对应的，参照官网：</p>
<p><a target="_blank" rel="noopener" href="http://gazebosim.org/tutorials?tut=ros_wrapper_versions&cat=connect_ros">http://gazebosim.org/tutorials?tut=ros_wrapper_versions&amp;cat&#x3D;connect_ros</a></p>
<p>ROS2 foxy对应Gazebo11.</p>
<h2 id="安装Package"><a href="#安装Package" class="headerlink" title="安装Package"></a>安装Package</h2><p>Ubuntu下，运行：</p>
<p>sudo apt install ros-foxy-gazebo-ros-pkgs</p>
<p>完成后，在Python中可以导入<code>gazebo_msgs</code>这个包了。不过这片教程中，还是先跟着Gazebo官方教程用c++。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>sudo apt install ros-foxy-ros-core ros-foxy-geometry2</p>
<p>保证必要的包都已经安装完成。打开ROS自带的测试样例：</p>
<p>gazebo –verbose &#x2F;opt&#x2F;ros&#x2F;foxy&#x2F;share&#x2F;gazebo_plugins&#x2F;worlds&#x2F;gazebo_ros_diff_drive_demo.world</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-31-1024x546.png"></p>
<p>看起来好像没有什么不同…不急，打开第二个终端，输入：</p>
<p>gedit &#x2F;opt&#x2F;ros&#x2F;foxy&#x2F;share&#x2F;gazebo_plugins&#x2F;worlds&#x2F;gazebo_ros_diff_drive_demo.world</p>
<p>文件上面有这些指示：</p>
<?xml version="1.0"?>
<!--
  Gazebo ROS differential drive plugin demo

  Try sending commands:

    ros2 topic pub /demo/cmd\_demo geometry\_msgs/Twist '{linear: {x: 1.0}}' -1

    ros2 topic pub /demo/cmd\_demo geometry\_msgs/Twist '{angular: {z: 0.1}}' -1

  Try listening to odometry:

    ros2 topic echo /demo/odom\_demo

  Try listening to TF:

    ros2 run tf2\_ros tf2\_echo odom\_demo chassis

    ros2 run tf2\_ros tf2\_echo chassis right\_wheel

    ros2 run tf2\_ros tf2\_echo chassis left\_wheel
-->

<p>我们试一下输入第一行命令：</p>
<p>ros2 topic pub &#x2F;demo&#x2F;cmd_demo geometry_msgs&#x2F;Twist ‘{linear: {x: 1.0}}’ -1</p>
<p>这会让小车向前走！</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-32-1024x651.png"></p>
<p>这说明Gazebo已经成功与ROS2建立联络。</p>
<h2 id="用ROS2-launch来启动Gazebo"><a href="#用ROS2-launch来启动Gazebo" class="headerlink" title="用ROS2 launch来启动Gazebo"></a>用ROS2 launch来启动Gazebo</h2><p>有很多方式都可以启动Gazebo，比如打开一个world之后手动添加模型。在这一节我们来用ros2 launch来启动Gazebo，以及我们设定的模型、场景等内容。</p>
<p>和官方教程不同的是，我使用的是ROS2，所以与官方教程相比有比较大的变化。官方使用的是ROS1，launch命令为：</p>
<p>roslaunch gazebo_ros empty_world.launch</p>
<p>此外，launch文件的格式也完全不同，ROS1使用的是xml，ROS2使用Python或者C++。</p>
<p>(由于缺少教程，这一章暂缓更新）</p>
<h2 id="在ROS中查看传感器的输出"><a href="#在ROS中查看传感器的输出" class="headerlink" title="在ROS中查看传感器的输出"></a>在ROS中查看传感器的输出</h2><p>Rviz是ROS的一个强大的可视化调试工具，在ROS2中更名为Rviz2.</p>
<p>首先启动一个样例世界：</p>
<p>gazebo –verbose &#x2F;opt&#x2F;ros&#x2F;foxy&#x2F;share&#x2F;gazebo_plugins&#x2F;worlds&#x2F;gazebo_ros_camera_demo.world</p>
<p>看一眼这个世界包括什么：</p>
<?xml version="1.0" ?>
<!--
  Gazebo ROS camera plugin demo

  Try for example:

  \* Launch RViz and visualize Images from \`/demo\_cam/camera1/image\_raw/raw\`
  \* Get camera info at /demo\_cam/camera1/camera\_info

  To change update rate of the camera:

    ros2 param set /demo\_cam/camera\_controller update\_rate 1.0

  To get the current update rate of the camera:

    ros2 param get /demo\_cam/camera\_controller update\_rate
-->
<sdf version="1.6">
  <world name="default">

<pre><code>&lt;include&gt;
  &lt;uri&gt;model://sun&lt;/uri&gt;
&lt;/include&gt;

&lt;model name=&quot;ground\_plane&quot;&gt;
  &lt;static&gt;true&lt;/static&gt;
  &lt;link name=&quot;link&quot;&gt;
    &lt;collision name=&quot;collision&quot;&gt;
      &lt;geometry&gt;
        &lt;plane&gt;
          &lt;normal&gt;0 0 1&lt;/normal&gt;
          &lt;size&gt;100 100&lt;/size&gt;
        &lt;/plane&gt;
      &lt;/geometry&gt;
      &lt;surface&gt;
        &lt;friction&gt;
          &lt;ode&gt;
            &lt;mu&gt;100&lt;/mu&gt;
            &lt;mu2&gt;50&lt;/mu2&gt;
          &lt;/ode&gt;
        &lt;/friction&gt;
          &lt;bounce&gt;
            &lt;restitution\_coefficient&gt;1.0&lt;/restitution\_coefficient&gt;
            &lt;threshold&gt;0&lt;/threshold&gt;
          &lt;/bounce&gt;
          &lt;contact&gt;
            &lt;ode&gt;
              &lt;max\_vel&gt;10000&lt;/max\_vel&gt;
              &lt;min\_depth&gt;0.001&lt;/min\_depth&gt;
            &lt;/ode&gt;
          &lt;/contact&gt;
      &lt;/surface&gt;
    &lt;/collision&gt;
    &lt;visual name=&quot;visual&quot;&gt;
      &lt;cast\_shadows&gt;false&lt;/cast\_shadows&gt;
      &lt;geometry&gt;
        &lt;plane&gt;
          &lt;normal&gt;0 0 1&lt;/normal&gt;
          &lt;size&gt;100 100&lt;/size&gt;
        &lt;/plane&gt;
      &lt;/geometry&gt;
      &lt;material&gt;
        &lt;script&gt;
          &lt;uri&gt;file://media/materials/scripts/gazebo.material&lt;/uri&gt;
          &lt;name&gt;Gazebo/Grey&lt;/name&gt;
        &lt;/script&gt;
      &lt;/material&gt;
    &lt;/visual&gt;
  &lt;/link&gt;
&lt;/model&gt;

&lt;model name=&quot;ball&quot;&gt;
  &lt;allow\_auto\_disable&gt;false&lt;/allow\_auto\_disable&gt;
  &lt;pose&gt;-1 0 1 0 0 0&lt;/pose&gt;
  &lt;static&gt;false&lt;/static&gt;
  &lt;link name=&quot;link&quot;&gt;
    &lt;inertial&gt;
      &lt;mass&gt;0.026&lt;/mass&gt;
      &lt;!-- inertia based on solid sphere 2/5 mr^2 --&gt;
      &lt;inertia&gt;
        &lt;ixx&gt;1.664e-5&lt;/ixx&gt;
        &lt;iyy&gt;1.664e-5&lt;/iyy&gt;
        &lt;izz&gt;1.664e-5&lt;/izz&gt;
        &lt;ixy&gt;0&lt;/ixy&gt;
        &lt;ixz&gt;0&lt;/ixz&gt;
        &lt;iyz&gt;0&lt;/iyz&gt;
      &lt;/inertia&gt;
    &lt;/inertial&gt;
    &lt;collision name=&quot;collision&quot;&gt;
      &lt;geometry&gt;
        &lt;sphere&gt;
          &lt;radius&gt;0.04&lt;/radius&gt;
        &lt;/sphere&gt;
      &lt;/geometry&gt;
      &lt;surface&gt;
        &lt;bounce&gt;
          &lt;restitution\_coefficient&gt;1.0&lt;/restitution\_coefficient&gt;
          &lt;threshold&gt;0&lt;/threshold&gt;
        &lt;/bounce&gt;
        &lt;contact&gt;
          &lt;ode&gt;
            &lt;max\_vel&gt;10000&lt;/max\_vel&gt;
            &lt;min\_depth&gt;0.001&lt;/min\_depth&gt;
          &lt;/ode&gt;
        &lt;/contact&gt;
      &lt;/surface&gt;
    &lt;/collision&gt;
    &lt;visual name=&quot;visual&quot;&gt;
      &lt;geometry&gt;
        &lt;sphere&gt;
          &lt;radius&gt;0.04&lt;/radius&gt;
        &lt;/sphere&gt;
      &lt;/geometry&gt;
    &lt;/visual&gt;
  &lt;/link&gt;
&lt;/model&gt;

&lt;model name=&quot;camera\_model&quot;&gt;
  &lt;pose&gt;0 0 0.5 0 0 3.14&lt;/pose&gt;
  &lt;static&gt;true&lt;/static&gt;
  &lt;link name=&quot;camera\_link&quot;&gt;
    &lt;sensor type=&quot;camera&quot; name=&quot;camera1&quot;&gt;
      &lt;update\_rate&gt;60&lt;/update\_rate&gt;
      &lt;visualize&gt;true&lt;/visualize&gt;
      &lt;camera name=&quot;head&quot;&gt;
        &lt;horizontal\_fov&gt;1.3962634&lt;/horizontal\_fov&gt;
        &lt;image&gt;
          &lt;width&gt;640&lt;/width&gt;
          &lt;height&gt;480&lt;/height&gt;
          &lt;format&gt;R8G8B8&lt;/format&gt;
        &lt;/image&gt;
        &lt;clip&gt;
          &lt;near&gt;0.02&lt;/near&gt;
          &lt;far&gt;300&lt;/far&gt;
        &lt;/clip&gt;
        &lt;noise&gt;
          &lt;type&gt;gaussian&lt;/type&gt;
          &lt;!-- Noise is sampled independently per pixel on each frame.
               That pixel&#39;s noise value is added to each of its color
               channels, which at that point lie in the range \[0,1\]. --&gt;
          &lt;mean&gt;0.0&lt;/mean&gt;
          &lt;stddev&gt;0.007&lt;/stddev&gt;
        &lt;/noise&gt;
      &lt;/camera&gt;
      &lt;plugin name=&quot;camera\_controller&quot; filename=&quot;libgazebo\_ros\_camera.so&quot;&gt;
        &lt;ros&gt;
          &lt;namespace&gt;demo\_cam&lt;/namespace&gt;
          &lt;!-- TODO(louise) Remapping not working due to https://github.com/ros-perception/image\_common/issues/93 --&gt;
          &lt;remapping&gt;image\_raw:=image\_demo&lt;/remapping&gt;
          &lt;remapping&gt;camera\_info:=camera\_info\_demo&lt;/remapping&gt;
        &lt;/ros&gt;
        &lt;!-- camera\_name&gt;omit so it defaults to sensor name&lt;/camera\_name--&gt;
        &lt;!-- frame\_name&gt;omit so it defaults to link name&lt;/frame\_name--&gt;
      &lt;/plugin&gt;
    &lt;/sensor&gt;
  &lt;/link&gt;
&lt;/model&gt;
</code></pre>
  </world>
</sdf>

<p>一个恢复系数为1的弹性球，一个照相机（只有传感器，还有噪声），以及一个控制插件，这个插件就是用来与ROS沟通的了。注意一下frame_name，我们之后会用到。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-33.png"></p>
<p>打开以后看到一个不停弹跳的小球。新开一个终端，查看ros2 topic：</p>
<p>shaw@shaw-Inspiron-7590:~$ ros2 topic list<br>&#x2F;clock<br>&#x2F;demo_cam&#x2F;camera1&#x2F;camera_info<br>&#x2F;demo_cam&#x2F;camera1&#x2F;image_raw<br>&#x2F;parameter_events<br>&#x2F;rosout</p>
<p>再打开一个终端，输入rviz2。左侧栏中，将Fixed Frame设为camera_link（也就是frame_name），然后点击Add，选择Camera。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-34.png"></p>
<p>然后在Topic中输入&#x2F;demo_cam&#x2F;camera1&#x2F;image_raw，rviz将会开始输出这个topic的信息：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-35.png"></p>
<p>这一章先到这里，等我补完Plugin的使用，再继续研究ROS2-Gazebo。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/05/04/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E9%80%A0%E4%B8%AA%E6%9C%BA%E5%99%A8%E4%BA%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/04/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E9%80%A0%E4%B8%AA%E6%9C%BA%E5%99%A8%E4%BA%BA/" class="post-title-link" itemprop="url">Gazebo入门（三）：造个机器人</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-04 17:36:33" itemprop="dateCreated datePublished" datetime="2021-05-04T17:36:33+08:00">2021-05-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本节将会学习如何制作一个机器人模型，许多知识在（二）中已经有提及了，这里就不在继续赘述。直接进入正题：</p>
<h2 id="模型的文件构成"><a href="#模型的文件构成" class="headerlink" title="模型的文件构成"></a>模型的文件构成</h2><p>模型是以何种形式组织起来的？换句话说，哪些文件组成了Gazebo中表示的模型？一个模型库中含有数个模型，他们如下组织：</p>
<ul>
<li><em>Database</em><ul>
<li><em>database.config</em> : Meta data about the database. This is now populated automatically from CMakeLists.txt</li>
<li><em>model_1</em> : A directory for model_1 单个模型<ul>
<li><em>model.config</em> : Meta-data about model_1 模型的描述</li>
<li><em>model.sdf</em> : SDF description of the model 模型文件</li>
<li><em>model.sdf.erb</em> : Ruby embedded SDF model description 含有Ruby脚本的模型文件（用于重复生成部件等）</li>
<li><em>meshes</em> : A directory for all COLLADA and STL files 外部3D文件</li>
<li><em>materials</em> : A directory which should only contain the <code>textures</code> and <code>scripts</code> subdirectories 材质，图像或者用脚本生成<ul>
<li><em>textures</em> : A directory for image files (jpg, png, etc).</li>
<li><em>scripts</em> : A directory for OGRE material scripts</li>
</ul>
</li>
<li><em>plugins</em>: A directory for plugin source and header files 插件</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="第一个机器人"><a href="#第一个机器人" class="headerlink" title="第一个机器人"></a>第一个机器人</h2><p>下面就要做第一个机器人了，会用到以下概念：Links、Collision、Visual、Inertial、Sensor、Light、Joints、Plugin。如果对这些概念不熟悉，再去看一遍（二）。</p>
<ol>
<li>创建model.config</li>
</ol>
<h2 id="mkdir-p-gazebo-models-my-robotgedit-gazebo-models-my-robot-model-config"><a href="#mkdir-p-gazebo-models-my-robotgedit-gazebo-models-my-robot-model-config" class="headerlink" title="mkdir -p ~&#x2F;.gazebo&#x2F;models&#x2F;my_robotgedit ~&#x2F;.gazebo&#x2F;models&#x2F;my_robot&#x2F;model.config"></a>mkdir -p ~&#x2F;.gazebo&#x2F;models&#x2F;my_robot<br>gedit ~&#x2F;.gazebo&#x2F;models&#x2F;my_robot&#x2F;model.config</h2><?xml version="1.0"?>
<model>
  <name>My Robot</name>
  <version>1.0</version>
  <sdf version='1.4'>model.sdf</sdf>

  <author>
   <name>My Name</name>
   <email>me@my.email</email>
  </author>

  <description>
    My awesome robot.
  </description>
</model>

<p>2. 创建model.sdf</p>
<p>gedit ~&#x2F;.gazebo&#x2F;models&#x2F;my_robot&#x2F;model.sdf</p>
<?xml version='1.0'?>
<sdf version='1.4'>
    <model name="my\_robot">
        <static>false</static>
        <static>true</static>
        <link name='chassis'>
            <pose>0 0 .1 0 0 0</pose>

<pre><code>        &lt;collision name=&#39;collision&#39;&gt;
            &lt;geometry&gt;
                &lt;box&gt;
                    &lt;size&gt;.4 .2 .1&lt;/size&gt;
                &lt;/box&gt;
            &lt;/geometry&gt;
        &lt;/collision&gt;

        &lt;visual name=&#39;visual&#39;&gt;
            &lt;geometry&gt;
                &lt;box&gt;
                    &lt;size&gt;.4 .2 .1&lt;/size&gt;
                &lt;/box&gt;
            &lt;/geometry&gt;
        &lt;/visual&gt;
        &lt;collision name=&#39;caster\_collision&#39;&gt;
            &lt;pose&gt;-0.15 0 -0.05 0 0 0&lt;/pose&gt;
            &lt;geometry&gt;
                &lt;sphere&gt;
                    &lt;radius&gt;.05&lt;/radius&gt;
                &lt;/sphere&gt;
            &lt;/geometry&gt;

            &lt;surface&gt;
                &lt;friction&gt;
                    &lt;ode&gt;
                        &lt;mu&gt;0&lt;/mu&gt;
                        &lt;mu2&gt;0&lt;/mu2&gt;
                        &lt;slip1&gt;1.0&lt;/slip1&gt;
                        &lt;slip2&gt;1.0&lt;/slip2&gt;
                    &lt;/ode&gt;
                &lt;/friction&gt;
            &lt;/surface&gt;
        &lt;/collision&gt;

        &lt;visual name=&#39;caster\_visual&#39;&gt;
            &lt;pose&gt;-0.15 0 -0.05 0 0 0&lt;/pose&gt;
            &lt;geometry&gt;
                &lt;sphere&gt;
                    &lt;radius&gt;.05&lt;/radius&gt;
                &lt;/sphere&gt;
            &lt;/geometry&gt;
        &lt;/visual&gt;
    &lt;/link&gt;
    &lt;link name=&quot;left\_wheel&quot;&gt;
        &lt;pose&gt;0.1 0.13 0.1 0 1.5707 1.5707&lt;/pose&gt;
        &lt;collision name=&quot;collision&quot;&gt;
            &lt;geometry&gt;
                &lt;cylinder&gt;
                    &lt;radius&gt;.1&lt;/radius&gt;
                    &lt;length&gt;.05&lt;/length&gt;
                &lt;/cylinder&gt;
            &lt;/geometry&gt;
        &lt;/collision&gt;
        &lt;visual name=&quot;visual&quot;&gt;
            &lt;geometry&gt;
                &lt;cylinder&gt;
                    &lt;radius&gt;.1&lt;/radius&gt;
                    &lt;length&gt;.05&lt;/length&gt;
                &lt;/cylinder&gt;
            &lt;/geometry&gt;
        &lt;/visual&gt;
    &lt;/link&gt;
    &lt;link name=&quot;right\_wheel&quot;&gt;
        &lt;pose&gt;0.1 -0.13 0.1 0 1.5707 1.5707&lt;/pose&gt;
        &lt;collision name=&quot;collision&quot;&gt;
            &lt;geometry&gt;
                &lt;cylinder&gt;
                    &lt;radius&gt;.1&lt;/radius&gt;
                    &lt;length&gt;.05&lt;/length&gt;
                &lt;/cylinder&gt;
            &lt;/geometry&gt;
        &lt;/collision&gt;
        &lt;visual name=&quot;visual&quot;&gt;
            &lt;geometry&gt;
                &lt;cylinder&gt;
                    &lt;radius&gt;.1&lt;/radius&gt;
                    &lt;length&gt;.05&lt;/length&gt;
                &lt;/cylinder&gt;
            &lt;/geometry&gt;
        &lt;/visual&gt;
    &lt;/link&gt;
    &lt;joint type=&quot;revolute&quot; name=&quot;left\_wheel\_hinge&quot;&gt;
        &lt;pose&gt;0 0 -0.03 0 0 0&lt;/pose&gt;
        &lt;child&gt;left\_wheel&lt;/child&gt;
        &lt;parent&gt;chassis&lt;/parent&gt;
        &lt;axis&gt;
            &lt;xyz&gt;0 1 0&lt;/xyz&gt;
        &lt;/axis&gt;
    &lt;/joint&gt;

    &lt;joint type=&quot;revolute&quot; name=&quot;right\_wheel\_hinge&quot;&gt;
        &lt;pose&gt;0 0 0.03 0 0 0&lt;/pose&gt;
        &lt;child&gt;right\_wheel&lt;/child&gt;
        &lt;parent&gt;chassis&lt;/parent&gt;
        &lt;axis&gt;
            &lt;xyz&gt;0 1 0&lt;/xyz&gt;
        &lt;/axis&gt;
    &lt;/joint&gt;
&lt;/model&gt;
</code></pre>
</sdf>

<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-18.png"></p>
<p>这是与教程（一）中一样的一个小车。</p>
<h2 id="链接外部模型"><a href="#链接外部模型" class="headerlink" title="链接外部模型"></a>链接外部模型</h2><p>首先下载外部模型：</p>
<p>cd ~&#x2F;.gazebo&#x2F;models<br>wget -q -R *index.html*,*.tar.gz –no-parent -r -x -nH <a target="_blank" rel="noopener" href="http://models.gazebosim.org/pioneer2dx/">http://models.gazebosim.org/pioneer2dx/</a></p>
<p>这一步其实下载了一个完整的Gazebo模型，不过我们只用到它包含的mesh。</p>
<pre><code>&lt;visual name=&#39;visual&#39;&gt;
  &lt;geometry&gt;
    &lt;box&gt;
      &lt;size&gt;.4 .2 .1&lt;/size&gt;
    &lt;/box&gt;
  &lt;/geometry&gt;
&lt;/visual&gt;
</code></pre>
<p>——————-修改<br>        <visual name='visual'><br>            <pose>0 0 0.05 0 0 0</pose><br>            <geometry><br>                <mesh><br>                    <uri>model:&#x2F;&#x2F;pioneer2dx&#x2F;meshes&#x2F;chassis.dae</uri><br>                    <scale>0.9 0.5 0.5</scale><br>                </mesh><br>            </geometry><br>        </visual></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-19-1024x468.png"></p>
<p>我们有了一个怪异的小车车身，但是碰撞体积不变。</p>
<h2 id="插入传感器"><a href="#插入传感器" class="headerlink" title="插入传感器"></a>插入传感器</h2><p>这一步需要<strong>插入一个模型</strong>到当前模型。首先下载hokuyo激光雷达的模型：</p>
<p>cd ~&#x2F;.gazebo&#x2F;models<br>wget -q -R *index.html*,*.tar.gz –no-parent -r -x -nH <a target="_blank" rel="noopener" href="http://models.gazebosim.org/hokuyo/">http://models.gazebosim.org/hokuyo/</a></p>
<p>在SDF文件中<code>&lt;/model&gt;</code>前面插入：</p>
<pre><code>&lt;include&gt;
  &lt;uri&gt;model://hokuyo&lt;/uri&gt;
  &lt;pose&gt;0.2 0 0.2 0 0 0&lt;/pose&gt;
&lt;/include&gt;
&lt;joint name=&quot;hokuyo\_joint&quot; type=&quot;fixed&quot;&gt;
  &lt;child&gt;hokuyo::link&lt;/child&gt;
  &lt;parent&gt;chassis&lt;/parent&gt;
&lt;/joint&gt;
</code></pre>
<p>有一点需要注意。joint只能在link之间建立，所以虽然我们插入了一个完整的模型，但是需要在两个模型分别得link之间建立joint。由于当前SDF文件的主模型是小车，对于parent chassis不需要加入namespace。但是对于hokuyo，需要加入。加入方式就是模型名称+”::”。看看hokuyo的sdf文件是什么样的：</p>
<?xml version="1.0" ?>
<sdf version="1.5">
  <model name="hokuyo">
    <pose>0 0 0.035 0 0 0</pose>
    <link name="link">
      <inertial>
        <mass>0.1</mass>
      </inertial>
      <visual name="visual">
        <geometry>
          <mesh>
            <uri>model://hokuyo/meshes/hokuyo.dae</uri>
          </mesh>
        </geometry>
      </visual>
      <collision name="collision-base">
        <pose>0 0 -0.0145 0 0 0</pose>
        <geometry>
          <box>
            <size>0.05 0.05 0.041</size>
          </box>
        </geometry>
      </collision>
      <collision name="collision-top">
        <pose>0 0 0.0205 0 0 0</pose>
        <geometry>
          <cylinder>
            <radius>0.021</radius>
            <length>0.029</length>
          </cylinder>
        </geometry>
      </collision>
      <sensor name="laser" type="ray">
        <pose>0.01 0 0.0175 0 -0 0</pose>
        <ray>
          <scan>
            <horizontal>
              <samples>640</samples>
              <resolution>1</resolution>
              <min\_angle>-2.26889</min\_angle>
              <max\_angle>2.268899</max\_angle>
            </horizontal>
          </scan>
          <range>
            <min>0.08</min>
            <max>10</max>
            <resolution>0.01</resolution>
          </range>
        </ray>
        <plugin name="laser" filename="libRayPlugin.so" />
        <always\_on>1</always\_on>
        <update\_rate>30</update\_rate>
        <visualize>true</visualize>
      </sensor>
    </link>
  </model>
</sdf>

<p>只有一个link，其名称也恰好是“link”。所以child link的名称就是hokuyo::link。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-20-1024x358.png"></p>
<p>试着换一个传感器，比如照相机。下载模型：</p>
<p>cd ~&#x2F;.gazebo&#x2F;models<br>wget -q -R *index.html*,*.tar.gz –no-parent -r -x -nH <a target="_blank" rel="noopener" href="http://models.gazebosim.org/camera/">http://models.gazebosim.org/camera/</a></p>
<p>SDF中要改动的地方很少：</p>
<pre><code>&lt;include&gt;
    &lt;uri&gt;model://camera&lt;/uri&gt;
    &lt;pose&gt;0.2 0 0.2 0 0 0&lt;/pose&gt;
&lt;/include&gt;
&lt;joint name=&quot;camera\_joint&quot; type=&quot;fixed&quot;&gt;
    &lt;child&gt;camera::link&lt;/child&gt;
    &lt;parent&gt;chassis&lt;/parent&gt;
&lt;/joint&gt;
</code></pre>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-21-1024x835.png"></p>
<p>是不是变得有意思起来了？</p>
<h2 id="第一个机械臂"><a href="#第一个机械臂" class="headerlink" title="第一个机械臂"></a>第一个机械臂</h2><p>我们做一个二自由度的机械臂，它只有两个自由度：抓取和抓手上下移动。</p>
<p>model.config:</p>
<?xml version="1.0"?>

<model>
  <name>My Gripper</name>
  <version>1.0</version>
  <sdf version='1.4'>simple\_gripper.sdf</sdf>

  <author>
    <name>My Name</name>
    <email>me@my.email</email>
  </author>

  <description>
    My awesome robot.
  </description>
</model>

<p>model.sdf:</p>
<?xml version="1.0"?>
<sdf version="1.4">
    <model name="simple\_gripper">
        <link name="riser">
            <pose>-0.15 0.0 0.5 0 0 0</pose>
            <inertial>
                <pose>0 0 -0.5 0 0 0</pose>
                <inertia>
                    <ixx>0.01</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.01</iyy>
                    <iyz>0</iyz>
                    <izz>0.01</izz>
                </inertia>
                <mass>10.0</mass>
            </inertial>
            <collision name="collision">
                <geometry>
                    <box>
                        <size>0.2 0.2 1.0</size>
                    </box>
                </geometry>
            </collision>
            <visual name="visual">
                <geometry>
                    <box>
                        <size>0.2 0.2 1.0</size>
                    </box>
                </geometry>
                <material>
                    <script>Gazebo/Purple</script>
                </material>
            </visual>
        </link>
        <link name="palm">
            <pose>0.0 0.0 0.05 0 0 0</pose>
            <inertial>
                <inertia>
                    <ixx>0.01</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.01</iyy>
                    <iyz>0</iyz>
                    <izz>0.01</izz>
                </inertia>
                <mass>0.5</mass>
            </inertial>
            <collision name="collision">
                <geometry>
                    <box>
                        <size>0.1 0.2 0.1</size>
                    </box>
                </geometry>
            </collision>
            <visual name="visual">
                <geometry>
                    <box>
                        <size>0.1 0.2 0.1</size>
                    </box>
                </geometry>
                <material>
                    <script>Gazebo/Red</script>
                </material>
            </visual>
        </link>
        <link name="left\_finger">
            <pose>0.1 0.2 0.05 0 0 -0.78539</pose>
            <inertial>
                <inertia>
                    <ixx>0.01</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.01</iyy>
                    <iyz>0</iyz>
                    <izz>0.01</izz>
                </inertia>
                <mass>0.1</mass>
            </inertial>
            <collision name="collision">
                <geometry>
                    <box>
                        <size>0.1 0.3 0.1</size>
                    </box>
                </geometry>
            </collision>
            <visual name="visual">
                <geometry>
                    <box>
                        <size>0.1 0.3 0.1</size>
                    </box>
                </geometry>
                <material>
                    <script>Gazebo/Blue</script>
                </material>
            </visual>
        </link>
        <link name="left\_finger\_tip">
            <pose>0.336 0.3 0.05 0 0 1.5707</pose>
            <inertial>
                <inertia>
                    <ixx>0.01</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.01</iyy>
                    <iyz>0</iyz>
                    <izz>0.01</izz>
                </inertia>
                <mass>0.1</mass>
            </inertial>
            <collision name="collision">
                <geometry>
                    <box>
                        <size>0.1 0.2 0.1</size>
                    </box>
                </geometry>
            </collision>
            <visual name="visual">
                <geometry>
                    <box>
                        <size>0.1 0.2 0.1</size>
                    </box>
                </geometry>
                <material>
                    <script>Gazebo/Blue</script>
                </material>
            </visual>
        </link>
        <link name="right\_finger">
            <pose>0.1 -0.2 0.05 0 0 .78539</pose>
            <inertial>
                <inertia>
                    <ixx>0.01</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.01</iyy>
                    <iyz>0</iyz>
                    <izz>0.01</izz>
                </inertia>
                <mass>0.1</mass>
            </inertial>
            <collision name="collision">
                <geometry>
                    <box>
                        <size>0.1 0.3 0.1</size>
                    </box>
                </geometry>
            </collision>
            <visual name="visual">
                <geometry>
                    <box>
                        <size>0.1 0.3 0.1</size>
                    </box>
                </geometry>
                <material>
                    <script>Gazebo/Green</script>
                </material>
            </visual>
        </link>
        <link name="right\_finger\_tip">
            <pose>0.336 -0.3 0.05 0 0 1.5707</pose>
            <inertial>
                <inertia>
                    <ixx>0.01</ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy>0.01</iyy>
                    <iyz>0</iyz>
                    <izz>0.01</izz>
                </inertia>
                <mass>0.1</mass>
            </inertial>
            <collision name="collision">
                <geometry>
                    <box>
                        <size>0.1 0.2 0.1</size>
                    </box>
                </geometry>
            </collision>
            <visual name="visual">
                <geometry>
                    <box>
                        <size>0.1 0.2 0.1</size>
                    </box>
                </geometry>
                <material>
                    <script>Gazebo/Green</script>
                </material>
            </visual>
        </link>
        <static>false</static>
        <joint name="palm\_left\_finger" type="revolute">
            <pose>0 -0.15 0 0 0 0</pose>
            <child>left\_finger</child>
            <parent>palm</parent>
            <axis>
                <limit>
                    <lower>-0.4</lower>
                    <upper>0.4</upper>
                </limit>
                <xyz>0 0 1</xyz>
            </axis>
        </joint>
        <joint name="left\_finger\_tip" type="revolute">
            <pose>0 0.1 0 0 0 0</pose>
            <child>left\_finger\_tip</child>
            <parent>left\_finger</parent>
            <axis>
                <limit>
                    <lower>-0.4</lower>
                    <upper>0.4</upper>
                </limit>
                <xyz>0 0 1</xyz>
            </axis>
        </joint>
        <joint name="palm\_right\_finger" type="revolute">
            <pose>0 0.15 0 0 0 0</pose>
            <child>right\_finger</child>
            <parent>palm</parent>
            <axis>
                <limit>
                    <lower>-0.4</lower>
                    <upper>0.4</upper>
                </limit>
                <xyz>0 0 1</xyz>
            </axis>
        </joint>
        <joint name="right\_finger\_tip" type="revolute">
            <pose>0 0.1 0 0 0 0</pose>
            <child>right\_finger\_tip</child>
            <parent>right\_finger</parent>
            <axis>
                <limit>
                    <lower>-0.4</lower>
                    <upper>0.4</upper>
                </limit>
                <xyz>0 0 1</xyz>
            </axis>
        </joint>
        <joint name="palm\_riser" type="prismatic">
            <child>palm</child>
            <parent>riser</parent>
            <axis>
                <limit>
                    <lower>0</lower>
                    <upper>0.9</upper>
                </limit>
                <xyz>0 0 1</xyz>
            </axis>
        </joint>
    </model>
</sdf>

<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-22.png"></p>
<p>这个抓手一共有五个关节：上下运动，爪子每两个方块之间有一个旋转关节。</p>
<h2 id="把机械臂安装到小车上"><a href="#把机械臂安装到小车上" class="headerlink" title="把机械臂安装到小车上"></a>把机械臂安装到小车上</h2><p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-23.png"></p>
<p>首先我们调整一下小车的大小，否则就是把小车安装到机械臂上了。把小车的sdf文件改为以下内容：</p>
<?xml version='1.0'?>
<sdf version='1.5'>
    <model name="mobile\_base">
        <link name='chassis'>
            <pose>0 0 .25 0 0 0</pose>

<pre><code>        &lt;inertial&gt;
            &lt;mass&gt;20.0&lt;/mass&gt;
            &lt;pose&gt;-0.1 0 -0.1 0 0 0&lt;/pose&gt;
            &lt;inertia&gt;
                &lt;ixx&gt;0.5&lt;/ixx&gt;
                &lt;iyy&gt;1.0&lt;/iyy&gt;
                &lt;izz&gt;0.1&lt;/izz&gt;
            &lt;/inertia&gt;
        &lt;/inertial&gt;

        &lt;collision name=&#39;collision&#39;&gt;
            &lt;geometry&gt;
                &lt;box&gt;
                    &lt;size&gt;2 1 0.3&lt;/size&gt;
                &lt;/box&gt;
            &lt;/geometry&gt;
        &lt;/collision&gt;

        &lt;visual name=&#39;visual&#39;&gt;
            &lt;geometry&gt;
                &lt;box&gt;
                    &lt;size&gt;2 1 0.3&lt;/size&gt;
                &lt;/box&gt;
            &lt;/geometry&gt;
        &lt;/visual&gt;

        &lt;collision name=&#39;caster\_collision&#39;&gt;
            &lt;pose&gt;-0.8 0 -0.125 0 0 0&lt;/pose&gt;
            &lt;geometry&gt;
                &lt;sphere&gt;
                    &lt;radius&gt;.125&lt;/radius&gt;
                &lt;/sphere&gt;
            &lt;/geometry&gt;

            &lt;surface&gt;
                &lt;friction&gt;
                    &lt;ode&gt;
                        &lt;mu&gt;0&lt;/mu&gt;
                        &lt;mu2&gt;0&lt;/mu2&gt;
                    &lt;/ode&gt;
                &lt;/friction&gt;
            &lt;/surface&gt;
        &lt;/collision&gt;

        &lt;visual name=&#39;caster\_visual&#39;&gt;
            &lt;pose&gt;-0.8 0 -0.125 0 0 0&lt;/pose&gt;
            &lt;geometry&gt;
                &lt;sphere&gt;
                    &lt;radius&gt;.125&lt;/radius&gt;
                &lt;/sphere&gt;
            &lt;/geometry&gt;
        &lt;/visual&gt;
    &lt;/link&gt;
    &lt;link name=&quot;left\_wheel&quot;&gt;
        &lt;pose&gt;0.8 0.6 0.125 0 1.5707 1.5707&lt;/pose&gt;
        &lt;collision name=&quot;collision&quot;&gt;
            &lt;geometry&gt;
                &lt;cylinder&gt;
                    &lt;radius&gt;.125&lt;/radius&gt;
                    &lt;length&gt;.05&lt;/length&gt;
                &lt;/cylinder&gt;
            &lt;/geometry&gt;
        &lt;/collision&gt;
        &lt;visual name=&quot;visual&quot;&gt;
            &lt;geometry&gt;
                &lt;cylinder&gt;
                    &lt;radius&gt;.125&lt;/radius&gt;
                    &lt;length&gt;.05&lt;/length&gt;
                &lt;/cylinder&gt;
            &lt;/geometry&gt;
        &lt;/visual&gt;
    &lt;/link&gt;

    &lt;link name=&quot;right\_wheel&quot;&gt;
        &lt;pose&gt;0.8 -0.6 0.125 0 1.5707 1.5707&lt;/pose&gt;
        &lt;collision name=&quot;collision&quot;&gt;
            &lt;geometry&gt;
                &lt;cylinder&gt;
                    &lt;radius&gt;.125&lt;/radius&gt;
                    &lt;length&gt;.05&lt;/length&gt;
                &lt;/cylinder&gt;
            &lt;/geometry&gt;
        &lt;/collision&gt;
        &lt;visual name=&quot;visual&quot;&gt;
            &lt;geometry&gt;
                &lt;cylinder&gt;
                    &lt;radius&gt;.125&lt;/radius&gt;
                    &lt;length&gt;.05&lt;/length&gt;
                &lt;/cylinder&gt;
            &lt;/geometry&gt;
        &lt;/visual&gt;
    &lt;/link&gt;

    &lt;joint type=&quot;revolute&quot; name=&quot;left\_wheel\_hinge&quot;&gt;
        &lt;pose&gt;0 0 -0.03 0 0 0&lt;/pose&gt;
        &lt;child&gt;left\_wheel&lt;/child&gt;
        &lt;parent&gt;chassis&lt;/parent&gt;
        &lt;axis&gt;
            &lt;use\_parent\_model\_frame&gt;true&lt;/use\_parent\_model\_frame&gt;
            &lt;xyz&gt;0 1 0&lt;/xyz&gt;
        &lt;/axis&gt;
    &lt;/joint&gt;

    &lt;joint type=&quot;revolute&quot; name=&quot;right\_wheel\_hinge&quot;&gt;
        &lt;pose&gt;0 0 0.03 0 0 0&lt;/pose&gt;
        &lt;child&gt;right\_wheel&lt;/child&gt;
        &lt;parent&gt;chassis&lt;/parent&gt;
        &lt;axis&gt;
            &lt;use\_parent\_model\_frame&gt;true&lt;/use\_parent\_model\_frame&gt;
            &lt;xyz&gt;0 1 0&lt;/xyz&gt;
        &lt;/axis&gt;
    &lt;/joint&gt;

&lt;/model&gt;
</code></pre>
</sdf>

<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-24-1024x463.png"></p>
<p>然后新建一个名为simple_mobile_manipulator的模型文件夹：</p>
<p>model.config:</p>
<?xml version="1.0"?>
<model>
  <name>Simple Mobile Manipulator</name>
  <version>1.0</version>
  <sdf version='1.5'>model.sdf</sdf>

  <author>
    <name>My Name</name>
    <email>me@my.email</email>
  </author>

  <description>
    My simple mobile manipulator
  </description>
</model>

<p>model.sdf:</p>
<?xml version="1.0" ?>
<sdf version="1.5">
  <model name="simple\_mobile\_manipulator">

<pre><code>&lt;include&gt;
  &lt;uri&gt;model://my\_gripper&lt;/uri&gt;
  &lt;pose&gt;1.3 0 0.1 0 0 0&lt;/pose&gt;
&lt;/include&gt;

&lt;include&gt;
  &lt;uri&gt;model://my\_robot&lt;/uri&gt;
  &lt;pose&gt;0 0 0 0 0 0&lt;/pose&gt;
&lt;/include&gt;

&lt;joint name=&quot;arm\_gripper\_joint&quot; type=&quot;fixed&quot;&gt;
  &lt;parent&gt;mobile\_base::chassis&lt;/parent&gt;
  &lt;child&gt;simple\_gripper::riser&lt;/child&gt;
&lt;/joint&gt;

&lt;!-- attach sensor to the gripper --&gt;
&lt;include&gt;
  &lt;uri&gt;model://hokuyo&lt;/uri&gt;
  &lt;pose&gt;1.3 0 0.3 0 0 0&lt;/pose&gt;
&lt;/include&gt;

&lt;joint name=&quot;hokuyo\_joint&quot; type=&quot;fixed&quot;&gt;
  &lt;child&gt;hokuyo::link&lt;/child&gt;
  &lt;parent&gt;simple\_gripper::palm&lt;/parent&gt;
&lt;/joint&gt;
</code></pre>
  </model>
</sdf>

<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-25-1024x581.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wonderful-sea-04900b000.6.azurestaticapps.net/2021/05/02/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xiao Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn Lin's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/02/gazebo%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">Gazebo入门（二）：自定义模型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-02 14:37:53" itemprop="dateCreated datePublished" datetime="2021-05-02T14:37:53+08:00">2021-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-27 15:52:33" itemprop="dateModified" datetime="2025-03-27T15:52:33+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本节会学习：</p>
<ol>
<li>创建SDF模型</li>
<li>将SDF连接到三维模型</li>
</ol>
<p>会使用到以下软件：</p>
<ol>
<li>Gazebo</li>
<li>FreeCAD</li>
<li>blender</li>
</ol>
<h2 id="创建一个SDF模型"><a href="#创建一个SDF模型" class="headerlink" title="创建一个SDF模型"></a>创建一个SDF模型</h2><p>本节创建一个LiDAR传感器，型号为Velodyne HDL-32 LiDAR，如图：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/velodyne_drawing.png"></p>
<p>之前我们通过可视化GUI的方式创建了简单的模型，实际上，我们也可以通过纯文本的方式来做到这一点。我们需要创建一个SDF模型，它是由xml语言组织的。</p>
<h3 id="创建一个SDF世界模型"><a href="#创建一个SDF世界模型" class="headerlink" title="创建一个SDF世界模型"></a>创建一个SDF世界模型</h3><p>SDF既可以表示Gazebo世界，也可以表示单个模型。下面我们先创建一个世界，创建一个新.world文件，并输入以下内容：</p>
<p>gedit velodyne.world</p>
<?xml version="1.0" ?>
<sdf version="1.5">
  <world name="default">

<pre><code>&lt;!-- A global light source --&gt;
&lt;include&gt;
  &lt;uri&gt;model://sun&lt;/uri&gt;
&lt;/include&gt;

&lt;!-- A ground plane --&gt;
&lt;include&gt;
  &lt;uri&gt;model://ground\_plane&lt;/uri&gt;
&lt;/include&gt;
</code></pre>
  </world>
</sdf>

<p>在这个文件中，我们指定了xml和sdf文件的版本，给世界加入了光照和地表（均为默认）。</p>
<h3 id="插入传感器模型"><a href="#插入传感器模型" class="headerlink" title="插入传感器模型"></a>插入传感器模型</h3><p>接下来我们加入模型，将它放在<world>tag中（比如在&#x2F;world之前），代码如下：</p>
<model name="velodyne\_hdl-32">
  <!-- Give the base link a unique name -->
  <link name="base">

<pre><code>&lt;!-- Offset the base by half the lenght of the cylinder --&gt;
&lt;pose&gt;0 0 0.029335 0 0 0&lt;/pose&gt;
&lt;collision name=&quot;base\_collision&quot;&gt;
  &lt;geometry&gt;
    &lt;cylinder&gt;
      &lt;!-- Radius and length provided by Velodyne --&gt;
      &lt;radius&gt;.04267&lt;/radius&gt;
      &lt;length&gt;.05867&lt;/length&gt;
    &lt;/cylinder&gt;
  &lt;/geometry&gt;
&lt;/collision&gt;

&lt;!-- The visual is mostly a copy of the collision --&gt;
&lt;visual name=&quot;base\_visual&quot;&gt;
  &lt;geometry&gt;
    &lt;cylinder&gt;
      &lt;radius&gt;.04267&lt;/radius&gt;
      &lt;length&gt;.05867&lt;/length&gt;
    &lt;/cylinder&gt;
  &lt;/geometry&gt;
&lt;/visual&gt;
</code></pre>
  </link>

  <!-- Give the base link a unique name -->
  <link name="top">

<pre><code>&lt;!-- Vertically offset the top cylinder by the length of the bottom
    cylinder and half the length of this cylinder. --&gt;
&lt;pose&gt;0 0 0.095455 0 0 0&lt;/pose&gt;
&lt;collision name=&quot;top\_collision&quot;&gt;
  &lt;geometry&gt;
    &lt;cylinder&gt;
      &lt;!-- Radius and length provided by Velodyne --&gt;
      &lt;radius&gt;0.04267&lt;/radius&gt;
      &lt;length&gt;0.07357&lt;/length&gt;
    &lt;/cylinder&gt;
  &lt;/geometry&gt;
&lt;/collision&gt;

&lt;!-- The visual is mostly a copy of the collision --&gt;
&lt;visual name=&quot;top\_visual&quot;&gt;
  &lt;geometry&gt;
    &lt;cylinder&gt;
      &lt;radius&gt;0.04267&lt;/radius&gt;
      &lt;length&gt;0.07357&lt;/length&gt;
    &lt;/cylinder&gt;
  &lt;/geometry&gt;
&lt;/visual&gt;
</code></pre>
  </link>
</model>

<p>这段代码表示了添加的模型，它由两个link组成，一个为“base”，另一个为“top”。就像在GUI中的操作那样，我们使用pose、collision、visual三个同级的标签来表示模型的位置与外形。这里collision和visual都是简单的几何体（cylinder，圆柱），指定了半径与长度。你可能发现了，link之间需要有joint，但这里没有。我们接下来会添加。我们在gazebo中打开这个世界：</p>
<p>gazebo velodyne.world -u</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-1024x716.png"></p>
<p>应当能看到模型，它由上下两部分组成：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-1.png"></p>
<h3 id="添加惯性质量"><a href="#添加惯性质量" class="headerlink" title="添加惯性质量"></a>添加惯性质量</h3><p>惯性（Inertia）决定了物体对外力的反应，这对仿真是至关重要的。我们都知道，质量越大，惯性越大，所以实际上我们是直接通过修改物体质量来改变其惯性的。</p>
<p>在名为base的link中，添加inertia标签，最终会像下面这样：</p>
<model name="velodyne\_hdl-32">
  <link name="base">
    <pose>0 0 0.029335 0 0 0</pose>
    <inertial>
      <mass>1.2</mass>
      <inertia>
        <ixx>0.001087473</ixx>
        <iyy>0.001087473</iyy>
        <izz>0.001092437</izz>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyz>0</iyz>
      </inertia>
    </inertial>

<p>简单地说，把inertial标签加在pose的下面一行。对于top link，也做同样的操作：</p>
   <inertial>
     <mass>0.1</mass>
     <inertia>
       <ixx>0.000090623</ixx>
       <iyy>0.000090623</iyy>
       <izz>0.000091036</izz>
       <ixy>0</ixy>
       <ixz>0</ixz>
       <iyz>0</iyz>
     </inertia>
   </inertial>

<p>完成后再次打开世界，在模型上右键-view-inertia，应当能看到如下图的情况：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-2.png"></p>
<p>我们假设质量是在一个立方体里均匀分布的。这当然不符合模型的形状，但是对于这个简单的传感器模型来说，这么做也可以。</p>
<h3 id="添加关节Joints"><a href="#添加关节Joints" class="headerlink" title="添加关节Joints"></a>添加关节Joints</h3><p>激光雷达的原理是通过旋转扫描测绘来构建周边环境的三维点云图像。这意味着传感器工作中，上部分需要不停地旋转来进行测绘。因此我们要做的是在两个link：top和base之间创建一个revolute joint。在</model>标签前加入下面这串代码：</p>
<!-- Each joint must have a unique name -->
<joint type="revolute" name="joint">

  <!-- Position the joint at the bottom of the top link -->
<p>  <pose>0 0 -0.036785 0 0 0</pose></p>
  <!-- Use the base link as the parent of the joint -->
<p>  <parent>base</parent></p>
  <!-- Use the top link as the child of the joint -->
<p>  <child>top</child></p>
  <!-- The axis defines the joint's degree of freedom -->
  <axis>

<pre><code>&lt;!-- Revolve around the z-axis --&gt;
&lt;xyz&gt;0 0 1&lt;/xyz&gt;

&lt;!-- Limit refers to the range of motion of the joint --&gt;
&lt;limit&gt;

  &lt;!-- Use a very large number to indicate a continuous revolution --&gt;
  &lt;lower&gt;-10000000000000000&lt;/lower&gt;
  &lt;upper&gt;10000000000000000&lt;/upper&gt;
&lt;/limit&gt;
</code></pre>
  </axis>
</joint>

<p>这串代码中我们定义了joint的类型、名称，joint的位置，joint的parent和child，旋转的轴，旋转的最大值与最小值。我们用一个很夸张的值让它能够以最大速度不停地旋转。此时再打开world，右键模型-view-transparent&amp;joints，可以透过模型看到joint的样子：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-3-1009x1024.png"></p>
<h3 id="添加传感器"><a href="#添加传感器" class="headerlink" title="添加传感器"></a>添加传感器</h3><p>最后我们添加一个激光传感器来完成这个传感器模型。Gazebo内建了许多高度可定制化的传感器，我们在这里使用ray传感器。我们的传感器名称叫做“HDL-32”，这意味着它有32个激光束，并且可以通过资料查到这些激光束均匀在10.67°到-30.67°之间垂直分布。</p>
<p>这个传感器需要被添加在模型的上部，因此在<link name="top">标签中加入以下内容，推荐加在</link>标签前一行：</p>
<!-- Add a ray sensor, and give it a name -->
<sensor type="ray" name="sensor">

  <!-- Position the ray sensor based on the specification. Also rotate
       it by 90 degrees around the X-axis so that the <horizontal> rays
       become vertical -->
<p>  <pose>0 0 -0.004645 1.5707 0 0</pose></p>
  <!-- Enable visualization to see the rays in the GUI -->
<p>  <visualize>true</visualize></p>
  <!-- Set the update rate of the sensor -->
<p>  &lt;update_rate&gt;30&lt;&#x2F;update_rate&gt;<br><ray></p>
  <!-- The scan element contains the horizontal and vertical beams.
       We are leaving out the vertical beams for this tutorial. -->
  <scan>

<pre><code>&lt;!-- The horizontal beams --&gt;
&lt;horizontal&gt;
  &lt;!-- The velodyne has 32 beams(samples) --&gt;
  &lt;samples&gt;32&lt;/samples&gt;

  &lt;!-- Resolution is multiplied by samples to determine number of
       simulated beams vs interpolated beams. See:
       http://sdformat.org/spec?ver=1.6&amp;elem=sensor#horizontal\_resolution
       --&gt;
  &lt;resolution&gt;1&lt;/resolution&gt;

  &lt;!-- Minimum angle in radians --&gt;
  &lt;min\_angle&gt;-0.53529248&lt;/min\_angle&gt;

  &lt;!-- Maximum angle in radians --&gt;
  &lt;max\_angle&gt;0.18622663&lt;/max\_angle&gt;
&lt;/horizontal&gt;
</code></pre>
  </scan>

  <!-- Range defines characteristics of an individual beam -->
  <range>

<pre><code>&lt;!-- Minimum distance of the beam --&gt;
&lt;min&gt;0.05&lt;/min&gt;

&lt;!-- Maximum distance of the beam --&gt;
&lt;max&gt;70&lt;/max&gt;

&lt;!-- Linear resolution of the beam --&gt;
&lt;resolution&gt;0.02&lt;/resolution&gt;
</code></pre>
  </range>
</ray>
</sensor>

<p>我们指定了传感器的类型、名称、位置（x轴上旋转了1.5707rad，使得射线能够垂直分布）、刷新率、激光束数量、采样倍率、分布最小最大角度值、激光束发散最小最大距离等属性。</p>
<p>再次打开世界模型，似乎没有发生任何变化。此时需要点击界面下方的开始模拟按钮，就能够看到激光束了：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-4-1024x472.png"></p>
<p>不仅如此，我们还能让他旋转起来。把右边栏拖出来，然后点击模型，在Force标签页给关节加上一个力，例如0.0001，点击开始按钮，就能看到传感器开始螺旋升天：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/IMG_4739_recompress-1024x768.jpg"></p>
<p>到这里我们已经做出了一个能用的传感器了，如果对外貌没有什么追求，可以跳过下面的内容了。下面将会介绍如何将SDF文件与外界模型结合起来。</p>
<h2 id="优化模型外形"><a href="#优化模型外形" class="headerlink" title="优化模型外形"></a>优化模型外形</h2><p>简单地说，我们将用一个外界3D模型来替换SDF文件中link的visual标签，当然也可以用来替换collision标签。Gazebo只支持三种类型的3D模型文件：STL、OBJ与Collada（后缀为.dae）。</p>
<p>首先下载STEP格式的3D文件：</p>
<p><a target="_blank" rel="noopener" href="http://82.156.1.75/wp-content/uploads/2021/05/HDL32E_Outline_Model.zip">HDL32E_Outline_Model</a><a target="_blank" rel="noopener" href="http://82.156.1.75/wp-content/uploads/2021/05/HDL32E_Outline_Model.zip">下载</a></p>
<p>然后安装FreeCad，这是一款开源的三维模型编辑软件。ubuntu系统可以通过apt-get install freecad下载。在FreeCad中打开STEP文件：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-5-1024x562.png"></p>
<p>在左侧栏中选择模型，会产生绿色高亮。然后File-Export，保存为.dae格式文件。</p>
<h3 id="在Blender中编辑模型"><a href="#在Blender中编辑模型" class="headerlink" title="在Blender中编辑模型"></a>在Blender中编辑模型</h3><p>Blender是一款非常强大的三维模型编辑软件，更多地用于艺术创作上。而FreeCad更多用于严谨的工程制图。同样也可以通过apt-get install blender来安装。</p>
<p>打开blender，用delete删掉预设的模型，通过File-Import-Collada来导入之前导出的.dae文件。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-6-1024x707.png"></p>
<p>此时模型是“平躺”在x轴上的，我们需要让其的轴线与Z轴重合。点击界面右侧的小三角弹出Transform界面，令模型绕X轴旋转90°：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-8-1024x538.png"></p>
<p>然后单击Tab键进入编辑模式。在空白地方右键-Separate-By loose part，零件分离。再按一下Tab切换回Object Mode，这样可以删除不同的部分。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-9-1024x403.png"></p>
<p>首先我们导出模型的上部分也就是top部分。框选上半部分，按Delete键删除，只保留下半部分：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-10-1024x396.png"></p>
<p>File-Export-COLLADA，命名为base：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-11-1024x56.png"></p>
<p>按Ctrl+z撤销删除操作，接下来删除下半部分。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-12-1024x390.png"></p>
<p>此时我们需要将top部分的底部移到与X轴重合，否则地下空白部分也会被Gazebo认为是visual的一部分。但是由于我们分离了零件，需要一个一个挪动。也可以再次框选所有模型，右键-joint，重新组合零件。然后在Transform面板中输入location z &#x3D; -0.06096m。</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-13-1024x398.png"></p>
<p>导出为top.dae。下一步在SDF文件中连接到这两个模型。</p>
<h3 id="编辑模型SDF文件"><a href="#编辑模型SDF文件" class="headerlink" title="编辑模型SDF文件"></a>编辑模型SDF文件</h3><p>前面我们创建了world的SDF文件，实际上大部分内容是可以复用的。首先，我们要创建一个config文件来描述模型。在gazebo的默认模型存放文件夹新建一个路径：</p>
<p>mkdir ~&#x2F;.gazebo&#x2F;models&#x2F;velodyne_hdl32</p>
<p>这样Gazebo可以自动导入模型。然后创建config文件，输入：</p>
<h2 id="cd-gazebo-models-velodyne-hdl32gedit-model-config"><a href="#cd-gazebo-models-velodyne-hdl32gedit-model-config" class="headerlink" title="cd ~&#x2F;.gazebo&#x2F;models&#x2F;velodyne_hdl32gedit model.config"></a>cd ~&#x2F;.gazebo&#x2F;models&#x2F;velodyne_hdl32<br>gedit model.config</h2><?xml version="1.0"?>

<model>
  <name>Velodyne HDL-32</name>
  <version>1.0</version>
  <sdf version="1.5">model.sdf</sdf>

  <author>
    <name>Optional: YOUR NAME</name>
    <email>Optional: YOUR EMAIL</email>
  </author>

  <description>
    A model of a Velodyne HDL-32 LiDAR sensor.
  </description>

</model>

<p>config文件描述了模型的基本信息，比如名称、版本、作者信息、描述等。最重要的是它直接指向模型sdf文件的位置，所以保证模型文件的名称无误。然后创建一个sdf模型文件：</p>
<p>gedit model.sdf</p>
<p>world文件中的大部分内容都可以直接复制过来，除了：</p>
<ol>
<li><world>标签</li>
<li>描述光照和地表的<include>标签</li>
</ol>
<p>复制过来的sdf文件应当是这样的：</p>
<?xml version="1.0" ?>
<sdf version="1.5">
    <model name="velodyne\_hdl-32">
  <!-- Give the base link a unique name -->
  <link name="base">

<pre><code>&lt;!-- Offset the base by half the lenght of the cylinder --&gt;
&lt;pose&gt;0 0 0.029335 0 0 0&lt;/pose&gt;
    &lt;inertial&gt;
  &lt;mass&gt;1.2&lt;/mass&gt;
  &lt;inertia&gt;
    &lt;ixx&gt;0.001087473&lt;/ixx&gt;
    &lt;iyy&gt;0.001087473&lt;/iyy&gt;
    &lt;izz&gt;0.001092437&lt;/izz&gt;
    &lt;ixy&gt;0&lt;/ixy&gt;
    &lt;ixz&gt;0&lt;/ixz&gt;
    &lt;iyz&gt;0&lt;/iyz&gt;
  &lt;/inertia&gt;
&lt;/inertial&gt;
&lt;collision name=&quot;base\_collision&quot;&gt;
  &lt;geometry&gt;
    &lt;cylinder&gt;
      &lt;!-- Radius and length provided by Velodyne --&gt;
      &lt;radius&gt;.04267&lt;/radius&gt;
      &lt;length&gt;.05867&lt;/length&gt;
    &lt;/cylinder&gt;
  &lt;/geometry&gt;
&lt;/collision&gt;

&lt;!-- The visual is mostly a copy of the collision --&gt;
&lt;visual name=&quot;base\_visual&quot;&gt;
  &lt;geometry&gt;
    &lt;cylinder&gt;
      &lt;radius&gt;.04267&lt;/radius&gt;
      &lt;length&gt;.05867&lt;/length&gt;
    &lt;/cylinder&gt;
  &lt;/geometry&gt;
&lt;/visual&gt;
</code></pre>
  </link>

  <!-- Give the base link a unique name -->
  <link name="top">

<pre><code>&lt;!-- Vertically offset the top cylinder by the length of the bottom
    cylinder and half the length of this cylinder. --&gt;
&lt;pose&gt;0 0 0.095455 0 0 0&lt;/pose&gt;
   &lt;inertial&gt;
 &lt;mass&gt;0.1&lt;/mass&gt;
 &lt;inertia&gt;
   &lt;ixx&gt;0.000090623&lt;/ixx&gt;
   &lt;iyy&gt;0.000090623&lt;/iyy&gt;
   &lt;izz&gt;0.000091036&lt;/izz&gt;
   &lt;ixy&gt;0&lt;/ixy&gt;
   &lt;ixz&gt;0&lt;/ixz&gt;
   &lt;iyz&gt;0&lt;/iyz&gt;
 &lt;/inertia&gt;
</code></pre>
   </inertial>
    <collision name="top\_collision">
      <geometry>
        <cylinder>
          <!-- Radius and length provided by Velodyne -->
          <radius>0.04267</radius>
          <length>0.07357</length>
        </cylinder>
      </geometry>
    </collision>

<pre><code>&lt;!-- The visual is mostly a copy of the collision --&gt;
&lt;visual name=&quot;top\_visual&quot;&gt;
  &lt;geometry&gt;
    &lt;cylinder&gt;
      &lt;radius&gt;0.04267&lt;/radius&gt;
      &lt;length&gt;0.07357&lt;/length&gt;
    &lt;/cylinder&gt;
  &lt;/geometry&gt;
&lt;/visual&gt;
&lt;!-- Add a ray sensor, and give it a name --&gt;
</code></pre>
<sensor type="ray" name="sensor">

  <!-- Position the ray sensor based on the specification. Also rotate
       it by 90 degrees around the X-axis so that the <horizontal> rays
       become vertical -->
<p>  <pose>0 0 -0.004645 1.5707 0 0</pose></p>
  <!-- Enable visualization to see the rays in the GUI -->
<p>  <visualize>true</visualize></p>
  <!-- Set the update rate of the sensor -->
<p>  &lt;update_rate&gt;30&lt;&#x2F;update_rate&gt;<br><ray></p>
  <!-- The scan element contains the horizontal and vertical beams.
       We are leaving out the vertical beams for this tutorial. -->
  <scan>

<pre><code>&lt;!-- The horizontal beams --&gt;
&lt;horizontal&gt;
  &lt;!-- The velodyne has 32 beams(samples) --&gt;
  &lt;samples&gt;32&lt;/samples&gt;

  &lt;!-- Resolution is multiplied by samples to determine number of
       simulated beams vs interpolated beams. See:
       http://sdformat.org/spec?ver=1.6&amp;elem=sensor#horizontal\_resolution
       --&gt;
  &lt;resolution&gt;1&lt;/resolution&gt;

  &lt;!-- Minimum angle in radians --&gt;
  &lt;min\_angle&gt;-0.53529248&lt;/min\_angle&gt;

  &lt;!-- Maximum angle in radians --&gt;
  &lt;max\_angle&gt;0.18622663&lt;/max\_angle&gt;
&lt;/horizontal&gt;
</code></pre>
  </scan>

  <!-- Range defines characteristics of an individual beam -->
  <range>

<pre><code>&lt;!-- Minimum distance of the beam --&gt;
&lt;min&gt;0.05&lt;/min&gt;

&lt;!-- Maximum distance of the beam --&gt;
&lt;max&gt;70&lt;/max&gt;

&lt;!-- Linear resolution of the beam --&gt;
&lt;resolution&gt;0.02&lt;/resolution&gt;
</code></pre>
  </range>
</ray>
</sensor>
  </link>
  <!-- Each joint must have a unique name -->
<joint type="revolute" name="joint">

  <!-- Position the joint at the bottom of the top link -->
<p>  <pose>0 0 -0.036785 0 0 0</pose></p>
  <!-- Use the base link as the parent of the joint -->
<p>  <parent>base</parent></p>
  <!-- Use the top link as the child of the joint -->
<p>  <child>top</child></p>
  <!-- The axis defines the joint's degree of freedom -->
  <axis>

<pre><code>&lt;!-- Revolve around the z-axis --&gt;
&lt;xyz&gt;0 0 1&lt;/xyz&gt;

&lt;!-- Limit refers to the range of motion of the joint --&gt;
&lt;limit&gt;

  &lt;!-- Use a very large number to indicate a continuous revolution --&gt;
  &lt;lower&gt;-10000000000000000&lt;/lower&gt;
  &lt;upper&gt;10000000000000000&lt;/upper&gt;
&lt;/limit&gt;
</code></pre>
  </axis>
</joint>
</model>
</sdf>

<p>打开Gazebo，应当在Insert标签页能够看到我们的自定义模型：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-14.png"></p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-15-1024x398.png"></p>
<p>可以直接插入，说明没有问题。下一步把模型的visual属性替换为3D模型。首先，再在模型存放的文件夹下创建一个meshes文件夹：</p>
<p>mkdir meshes</p>
<p>把top.dae和base.dae都放进去。然后打开model.sdf，继续编辑。在<visual>下的<geomerty>中把内容替换成：</p>
 <visual name="top\_visual">
   <geometry>
     <!-- The mesh tag indicates that we will use a 3D mesh as
          a visual -->
     <mesh>
       <!-- The URI should refer to the 3D mesh. The "model:"
           URI scheme indicates that the we are referencing a Gazebo
           model. -->
       <uri>model://velodyne\_hdl32/meshes/velodyne\_top.dae</uri>
     </mesh>
   </geometry>
 </visual>

<p>由于SDF的默认坐标系和Blender有所不同，所以此时模型的朝向是有问题的（差90°），并且有悬空。可以在Blender中调整模型，也可以在SDF文件中直接调整，像这样：</p>
<pre><code>&lt;visual name=&quot;top\_visual&quot;&gt;
  &lt;pose&gt;0 0 -0.0376785 0 0 1.5707&lt;/pose&gt;
  &lt;geometry&gt;
 &lt;!-- The mesh tag indicates that we will use a 3D mesh as
      a visual --&gt;
 &lt;mesh&gt;
   &lt;!-- The URI should refer to the 3D mesh. The &quot;model:&quot;
       URI scheme indicates that the we are referencing a Gazebo
       model. --&gt;
   &lt;uri&gt;model://velodyne\_hdl32/meshes/top.dae&lt;/uri&gt;
 &lt;/mesh&gt;
  &lt;/geometry&gt;
&lt;/visual&gt;
</code></pre>
<p>对于base link，也做类似操作：</p>
<visual name="base\_visual">
  <!-- Offset the visual by have the base's height. We are not rotating
       mesh since symmetrical -->
  <pose>0 0 -0.029335 0 0 0</pose>
  <geometry>
    <mesh>
      <uri>model://velodyne\_hdl32/meshes/base.dae</uri>
    </mesh>
  </geometry>
</visual>

<p>需要注意的是mesh标签中url必须指向正确的模型名称，否则无法导入。保存后打开Gazebo，插入模型：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-16-1024x529.png"></p>
<p>看起来不错！但是我们并没有改变其碰撞体积：</p>
<p><img src="http://82.156.1.75/wp-content/uploads/2021/05/image-17-1024x559.png"></p>
<p>所以在仿真中，外貌上的改变并不会对仿真效果有什么影响，但至少这让模型看起来专业了一些。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/12/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/14/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Xiao Lin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">162</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">分类</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/linxiaoshaw@foxmail.com" title="E-Mail → linxiaoshaw@foxmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xiao Lin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
